<!DOCTYPE html>
<html lang="zh-cn">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>编译器设计及实现</title>
    <style>
        table {
            border-collapse: collapse;
        }

        th,
        td {
            border: 1px solid;
            padding: 0 1rem;
            text-align: center;
        }

        .emphasize,
        em {
            color: tomato;
        }

        .stress {
            color: red;
        }

        .legend {
            display: inline-block;
            font-size: small;
        }

        #lr_0_table * {
            text-align: start;
        }
    </style>
</head>

<body>
    <p>小心,这是一堆抽象的东西</p>
    <p>目前已经实现了编程语言ty,可以上<a href="https://github.com/yangzhenzhuozz/ty">github</a>看看</p>
    <h1>乔姆斯基体系(chomsky hierarchy)</h1>
    <p>提起编译原理,就不得不先说说文法。</p>
    <blockquote>
        <p>文法自然地描述了大多数程序设计语言构造的层次化语法结构</p>
        <footer> <cite>-编译原理(龙书)-p26</cite></footer>
    </blockquote>
    <p>假设我们要描述这样一个东西:"一个加法的数学表达式由两个数字和加号运算符组成",我们可以用如下的一条文法规则描述:</p>
    <math>
        <mi>EXP</mi>
        <mo>→</mo>
        <mi>num</mi>
        <mo>+</mo>
        <mi>num</mi>
    </math>
    <p>上面式子中的EXP表示一个表达式,num表示一个数字,所以"1+2"、"5+6"这些内容都符合EXP的展开规则,如果我们再扩展一下:</p>
    <ol>
        <li>
            <math>
                <mi>EXP</mi>
                <mo>→</mo>
                <mi>EXP</mi>
                <mo>+</mo>
                <mi>EXP</mi>
            </math>
        </li>
        <li>
            <math>
                <mi>EXP</mi>
                <mo>→</mo>
                <mo>(</mo>
                <mi>EXP</mi>
                <mo>)</mo>
            </math>
        </li>
        <li>
            <math>
                <mi>EXP</mi>
                <mo>→</mo>
                <mi>NUM</mi>
            </math>
        </li>
    </ol>
    <p>那么对于"1+(2+3)"这样的内容也完全符合上述文法规则,这个内容会被解析成如下的一颗语法树:</p>
    <svg style="height: 200PX;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 121.59 122.12"><text
            transform="translate(43.51 118.23)"
            style="isolation:isolate;font-size:12px;fill:#231815;font-family:ArialMT, Arial">2</text><text
            transform="translate(35.26 99.02)"
            style="isolation:isolate;font-size:12px;fill:#231815;font-family:ArialMT, Arial">NUM</text>
        <line x1="75.58" y1="71.34" x2="75.58" y2="63.34" style="fill:none;stroke:#231815;stroke-miterlimit:10" />
        <line x1="75.58" y1="46.05" x2="75.58" y2="38.05" style="fill:none;stroke:#231815;stroke-miterlimit:10" /><text
            transform="translate(103.51 118.09)"
            style="isolation:isolate;font-size:12px;fill:#231815;font-family:ArialMT, Arial">3</text>
        <line x1="39.98" y1="21.78" x2="39.98" y2="12.78" style="fill:none;stroke:#231815;stroke-miterlimit:10" />
        <line x1="106.28" y1="90.04" x2="106.28" y2="85.04" style="fill:none;stroke:#231815;stroke-miterlimit:10" />
        <line x1="46.93" y1="90.04" x2="46.93" y2="85.04" style="fill:none;stroke:#231815;stroke-miterlimit:10" />
        <line x1="46.28" y1="107.07" x2="46.28" y2="102.07" style="fill:none;stroke:#231815;stroke-miterlimit:10" />
        <line x1="106.28" y1="107.07" x2="106.28" y2="102.07" style="fill:none;stroke:#231815;stroke-miterlimit:10" />
        <text transform="translate(94.26 99.02)"
            style="isolation:isolate;font-size:12px;fill:#231815;font-family:ArialMT, Arial">NUM</text><text
            transform="translate(65.75 59.69)"
            style="isolation:isolate;font-size:12px;fill:#231815;font-family:ArialMT, Arial">EXP</text><text
            transform="translate(95.75 82.02)"
            style="isolation:isolate;font-size:12px;fill:#231815;font-family:ArialMT, Arial">EXP</text><text
            transform="translate(35.75 82.02)"
            style="isolation:isolate;font-size:12px;fill:#231815;font-family:ArialMT, Arial">EXP</text><text
            transform="translate(8.25 71.06)"
            style="isolation:isolate;font-size:12px;fill:#231815;font-family:ArialMT, Arial">1</text><text
            transform="translate(0 51.85)"
            style="isolation:isolate;font-size:12px;fill:#231815;font-family:ArialMT, Arial">NUM</text>
        <line x1="11.02" y1="42.87" x2="11.02" y2="37.87" style="fill:none;stroke:#231815;stroke-miterlimit:10" />
        <line x1="11.02" y1="59.9" x2="11.02" y2="54.9" style="fill:none;stroke:#231815;stroke-miterlimit:10" /><text
            transform="translate(0.5 34.85)"
            style="isolation:isolate;font-size:12px;fill:#231815;font-family:ArialMT, Arial">EXP</text><text
            transform="translate(65.75 34.85)"
            style="isolation:isolate;font-size:12px;fill:#231815;font-family:ArialMT, Arial">EXP</text><text
            transform="translate(30.5 10.3)"
            style="isolation:isolate;font-size:12px;fill:#231815;font-family:ArialMT, Arial">EXP</text>
        <line x1="65.01" y1="38.05" x2="54.15" y2="46.09" style="fill:none;stroke:#231815;stroke-miterlimit:10" />
        <line x1="25.07" y1="12.78" x2="14.21" y2="20.81" style="fill:none;stroke:#231815;stroke-miterlimit:10" />
        <line x1="86.15" y1="38.05" x2="97.01" y2="46.09" style="fill:none;stroke:#231815;stroke-miterlimit:10" />
        <line x1="54.9" y1="12.78" x2="65.75" y2="20.81" style="fill:none;stroke:#231815;stroke-miterlimit:10" />
        <line x1="65.01" y1="63.33" x2="54.15" y2="71.36" style="fill:none;stroke:#231815;stroke-miterlimit:10" />
        <line x1="86.15" y1="63.33" x2="97.01" y2="71.36" style="fill:none;stroke:#231815;stroke-miterlimit:10" /><text
            transform="translate(44.03 59.69)"
            style="isolation:isolate;font-size:12px;fill:#231815;font-family:ArialMT, Arial">(</text><text
            transform="translate(104.03 59.69)"
            style="isolation:isolate;font-size:12px;fill:#231815;font-family:ArialMT, Arial">)</text><text
            transform="translate(72.65 82.02)"
            style="isolation:isolate;font-size:12px;fill:#231815;font-family:ArialMT, Arial">+</text><text
            transform="translate(36.35 34.85)"
            style="isolation:isolate;font-size:12px;fill:#231815;font-family:ArialMT, Arial">+</text>
    </svg>
    <p>接着上面用到的文法,再介绍几个名词:(以下内容参考wikiPedia的<q cite="https://en.wikipedia.org/wiki/Chomsky_hierarchy"><a
                href="https://en.wikipedia.org/wiki/Chomsky_hierarchy">Chomsky
                hierarchy</a></q>和<q><a href="https://en.wikipedia.org/wiki/Terminal_and_nonterminal_symbols">Terminal
                and nonterminal symbols</a></q>)</p>
    <ol>
        <li>开始符号(start symbol):一个特意指定的符号,表示整个文法结构。在上面的例子中没有特意指定S符号,但是可以理解,我们最终会把整颗语法树规约成EXP,所以EXP就是上述文法的开始符号</li>
        <li>非终结符(non-terminal symbol):一个可以被推导(repalce)的符号。比如上面我们在解析"1+(2+3)"的时候把NUM推导成了2,把EXP推导成了(EXP+EXP)</li>
        <li>终结符(terminal symbol):一个不允许被推导的符号。如上面解析过程中的'+'、'('、')'都是不允许推导的。<em>在后面的内容中,将会用ε表示一个特殊的空终结符,这个符号表示什么内容都没有</em>
        </li>
        <li>产生式(production rule):指定了符号的推导规则。上面的两个文法定义,共4条规则都是产生式</li>
    </ol>
    <p>有了上述概念,我们可以模仿着写出java语言的if语句规则:(按照一些习惯,我用大写字母表示非终结符,小写字母表示终结符,希腊字母表示一个串,实际上这不是强制的)</p>
    <ol>
        <li>
            <math>
                <mi>STMT</mi>
                <mo>→</mo>
                <mi>if</mi>
                <mo>(</mo>
                <mi>EXP</mi>
                <mo>)</mo>
                <mi>STMT</mi>
            </math>
        </li>
    </ol>
    <p>上述规则可以描述这样的语句:</p>
    <code>
        <div>
            if ( condition ) stmt
        </div>
    </code>
    <p>甚至还可以表示if的嵌套:</p>
    <code>
        <div>
            if ( condition )
        </div>
        <div>
            &nbsp;&nbsp;if ( condition ) stmt
        </div>
    </code>
    <p>因为if语句本身又是一个STMT</p>
    <p>乔姆斯基体系将文法分为四个层级:0-型文法、1-型文法、2-型文法、3-型文法。对于0-型和1-型文法,我也没什么研究,简单了解一下即可,计算机编程语言主要使用的就是2-型文法(上下文无关文法)和3-型文法(正规文法)</p>
    <ol>
        <li>
            <span>0-型文法:</span>
            <p>Type-0 文法包括所有的形式文法。描述了所有可以被图灵机识别的语言。这些语言同时也被称为递归可枚举或图灵可识别的语言--
                <q cite="https://en.wikipedia.org/wiki/Recursively_enumerable_language">
                    <a href="https://en.wikipedia.org/wiki/Recursively_enumerable_language">
                        recursively enumerable or Turing-recognizable languages
                    </a>
                </q>
            </p>
        </li>
        <li>
            <span>1-型文法</span>
            <p>Type-1文法可以生成上下文相关语言,这种文法描述的语言可以使用线性有界自动机描述。--
                <q cite="https://en.wikipedia.org/wiki/Context-sensitive_grammar">
                    <a href="https://en.wikipedia.org/wiki/Context-sensitive_grammar">
                        Context-sensitive grammar
                    </a>
                </q>
            </p>
            <ol>
                <li>
                    <math>
                        <mi>α</mi>
                        <mi>A</mi>
                        <mi>β</mi>
                        <mo>→</mo>
                        <mi>α</mi>
                        <mi>γ</mi>
                        <mi>β</mi>
                    </math>
                </li>
                <li>
                    <math>
                        <mi>θ</mi>
                        <mi>A</mi>
                        <mi>λ</mi>
                        <mo>→</mo>
                        <mi>α</mi>
                        <mi>ξ</mi>
                        <mi>β</mi>
                    </math>
                </li>
            </ol>
            <p>同样的一个符号A,当他前面是α且后面是β时,才把A替换成γ,要是A的前面是θ后面是λ,则将其替换成ξ(即非终结符的替换需要考虑这个非终结符所在的上下文)</p>
        </li>
        <li>
            <span>2-型文法</span>
            <p>Type-2文法可生成上下无关语言,他的非终结符替换不需要考虑。--
                <q cite="https://en.wikipedia.org/wiki/Context-free_grammar">
                    <a href="https://en.wikipedia.org/wiki/Context-free_grammar">
                        Context-free_grammar
                    </a>
                </q>
            </p>
            <p>上下文无关文法的产生式规则如下:</p>
            <math>
                <mi>A</mi>
                <mo>→</mo>
                <mi>α</mi>
            </math>
            <p>一条即产生式规则的左侧有且仅有一个非终结符。我们可以发现这里不需要考虑这个非终结符的上下文,这为我们设计计算机编程语言提供了非常大的方便,比如C#中有这样一行代码</p>
            <div>a * b</div>
            <p>编译器可以立马识别到这是一个对象a和一个对象b进行了*操作,简单理解就是看到了符号*,那么他可以立即理解为*操作符。而这种语法在C/C++上,还需要考虑a是否为一种自定义类型,如果a是自定义类型的话,这行语句应当是声明一个指针。当然针对C/C++这种程度的上下文相关,我们可以对编译器做一些针对性调整,使其在输入阶段变为上下文无关。
            </p>
        </li>
        <li>
            <span>3-型文法</span>
            <p>Type-3文法也叫做正规文法(regular grammar),正规文法也分为左正规文法和右正规文法,他们之间没有多大差异。参考--<q
                    cite="https://en.wikipedia.org/wiki/Regular_grammar">
                    <a href="https://en.wikipedia.org/wiki/Regular_grammar">
                        Regular_grammar
                    </a>
                </q>
            </p>
            <p>一个右正规文法的产生式必须是如下的形式:</p>
            <ol>
                <li>
                    <math>
                        <mi>A</mi>
                        <mo>→</mo>
                        <mi>a</mi>
                    </math>
                </li>
                <li>
                    <math>
                        <mi>A</mi>
                        <mo>→</mo>
                        <mi>aB</mi>
                    </math>
                </li>
                <li>
                    <math>
                        <mi>A</mi>
                        <mo>→</mo>
                        <mi>ε</mi>
                    </math>
                </li>
            </ol>
            <p>如果把第二条规则定义成
                <math>
                    <mi>A</mi>
                    <mo>→</mo>
                    <mi>Ba</mi>
                </math>
                ,那么这个文法就是左正规文法。正规文法要求一个非终结符①要么能替换成一个终结符,②要么能替换成一个终结符和右侧的一个非终结符(如果这个非终结符在左侧,就是左正规文法),③或者这个非终结符能推导出一个空终结符。3-型文法的表达能力和正则表达式(regular
                expression)完全一致。比如我们写这样一个正则表达式"a*b",我们可以构造如下的3-型文法表示:
            </p>
            <ol>
                <li><math>
                        <mi>S</mi>
                        <mo>→</mo>
                        <mi>A</mi>
                        <mi>b</mi>
                    </math></li>
                <li><math>
                        <mi>A</mi>
                        <mo>→</mo>
                        <mi>a</mi>
                    </math></li>
                <li><math>
                        <mi>A</mi>
                        <mo>→</mo>
                        <mi>a</mi>
                        <mi>A</mi>
                    </math></li>
                <li><math>
                        <mi>A</mi>
                        <mo>→</mo>
                        <mi>ε</mi>
                    </math></li>
            </ol>
            <p>这也是3-型文法叫做正规文法的原因</p>
        </li>
    </ol>
    <p>乔姆斯基体系的每一层文法表达能力都涵盖了下一层,也就是随着数字的增加,文法的表达能力逐渐减小:</p>
    <svg style="height: 300PX;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 438.5 407.07">
        <ellipse cx="219.25" cy="218.02" rx="218.75" ry="188.54"
            style="fill:none;stroke:#231815;stroke-miterlimit:10" />
        <ellipse cx="219.25" cy="265.94" rx="157.29" ry="140.63"
            style="fill:none;stroke:#231815;stroke-miterlimit:10" />
        <ellipse cx="219.25" cy="310.38" rx="110.76" ry="96.18" style="fill:none;stroke:#231815;stroke-miterlimit:10" />
        <ellipse cx="219.25" cy="344.76" rx="56.6" ry="61.81" style="fill:none;stroke:#231815;stroke-miterlimit:10" />
        <g style="isolation:isolate"><text transform="translate(164.21 78.37)"
                style="isolation:isolate;font-size:24px;fill:#231815;font-family:ArialMT, Arial">Recursively
            </text><text transform="translate(164.21 107.17)"
                style="isolation:isolate;font-size:24px;fill:#231815;font-family:ArialMT, Arial">enumerable</text></g>
        <text transform="translate(137.72 191.55)"
            style="isolation:isolate;font-size:24px;fill:#231815;font-family:ArialMT, Arial">Context-sensitive</text><text
            transform="translate(159.4 255.99)"
            style="isolation:isolate;font-size:24px;fill:#231815;font-family:ArialMT, Arial">Context-free</text><text
            transform="translate(183.41 346.44)"
            style="isolation:isolate;font-size:24px;fill:#231815;font-family:ArialMT, Arial">Regular</text><text
            transform="translate(126.65 20.6)"
            style="isolation:isolate;font-size:24px;fill:#231815;font-family:ArialMT, Arial">Chomsky hierarchy</text>
    </svg>
    <p>通过上面的说明,我们可以知道一件有趣的事:<em>永远不可能用正则表达式判断一个字符串是否为一个合法的正则表达式</em></p>
    <h1>编译器结构</h1>
    <p>前面说了这么多铺垫,都是为了打一下基础。一般可以把编译器的分析-综合模型粗略的分为前端和后端(参考龙书第六章和第八章的开头)</p>
    <div style="width: 600px;text-align: center;">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 600.89 70.71"><text transform="translate(31.58 16.55)"
                style="font-size:12px;fill:#231815;font-family:AdobeSongStd-Light-GBpc-EUC-H, Adobe Song Std">词法分析</text>
            <rect x="25.43" y="0.5" width="60.3" height="24.6" style="fill:none;stroke:#231815;stroke-miterlimit:10" />
            <text transform="translate(120.31 16.55)"
                style="font-size:12px;fill:#231815;font-family:AdobeSongStd-Light-GBpc-EUC-H, Adobe Song Std">文法分析</text>
            <rect x="114.16" y="0.5" width="60.3" height="24.6" style="fill:none;stroke:#231815;stroke-miterlimit:10" />
            <text transform="translate(209.04 16.55)"
                style="font-size:12px;fill:#231815;font-family:AdobeSongStd-Light-GBpc-EUC-H, Adobe Song Std">语义检查</text>
            <rect x="202.89" y="0.5" width="60.3" height="24.6" style="fill:none;stroke:#231815;stroke-miterlimit:10" />
            <text transform="translate(297.6 16.55)"
                style="font-size:12px;fill:#231815;font-family:AdobeSongStd-Light-GBpc-EUC-H, Adobe Song Std">中间代码生成</text>
            <rect x="291.62" y="0.5" width="83.97" height="24.6"
                style="fill:none;stroke:#231815;stroke-miterlimit:10" /><text transform="translate(522.41 16.55)"
                style="font-size:12px;fill:#231815;font-family:AdobeSongStd-Light-GBpc-EUC-H, Adobe Song Std">目标代码生成</text>
            <rect x="516.42" y="0.5" width="83.97" height="24.6"
                style="fill:none;stroke:#231815;stroke-miterlimit:10" /><text transform="translate(410.01 16.55)"
                style="font-size:12px;fill:#231815;font-family:AdobeSongStd-Light-GBpc-EUC-H, Adobe Song Std">中间代码优化</text>
            <rect x="404.02" y="0.5" width="83.97" height="24.6"
                style="fill:none;stroke:#231815;stroke-miterlimit:10" />
            <line x1="88.73" y1="12.8" x2="102.3" y2="12.8" style="fill:none;stroke:#231815;stroke-miterlimit:10" />
            <polygon points="100.32 15.7 111.16 12.8 100.32 9.89 100.32 15.7" style="fill:#231815" />
            <line y1="12.8" x2="13.57" y2="12.8" style="fill:none;stroke:#231815;stroke-miterlimit:10" />
            <polygon points="11.59 15.7 22.43 12.8 11.59 9.89 11.59 15.7" style="fill:#231815" />
            <line x1="177.46" y1="12.8" x2="191.03" y2="12.8" style="fill:none;stroke:#231815;stroke-miterlimit:10" />
            <polygon points="189.05 15.7 199.89 12.8 189.05 9.89 189.05 15.7" style="fill:#231815" />
            <line x1="266.19" y1="12.8" x2="279.76" y2="12.8" style="fill:none;stroke:#231815;stroke-miterlimit:10" />
            <polygon points="277.78 15.7 288.62 12.8 277.78 9.89 277.78 15.7" style="fill:#231815" />
            <line x1="378.59" y1="12.8" x2="392.16" y2="12.8" style="fill:none;stroke:#231815;stroke-miterlimit:10" />
            <polygon points="390.18 15.7 401.02 12.8 390.18 9.89 390.18 15.7" style="fill:#231815" />
            <line x1="490.99" y1="12.8" x2="504.56" y2="12.8" style="fill:none;stroke:#231815;stroke-miterlimit:10" />
            <polygon points="502.58 15.7 513.42 12.8 502.58 9.89 502.58 15.7" style="fill:#231815" />
            <line x1="389.81" y1="33.43" x2="389.81" y2="70.71" style="fill:none;stroke:#231815;stroke-miterlimit:10" />
            <line x1="4.33" y1="64.76" x2="377.95" y2="64.76" style="fill:none;stroke:#231815;stroke-miterlimit:10" />
            <polygon points="375.96 67.67 386.81 64.76 375.96 61.86 375.96 67.67" style="fill:#231815" />
            <line x1="598.87" y1="64.76" x2="401.67" y2="64.76" style="fill:none;stroke:#231815;stroke-miterlimit:10" />
            <polygon points="403.65 61.86 392.81 64.76 403.65 67.67 403.65 61.86" style="fill:#231815" /><text
                transform="translate(193.81 61.72)"
                style="font-size:12px;fill:#231815;font-family:AdobeSongStd-Light-GBpc-EUC-H, Adobe Song Std">前端</text><text
                transform="translate(483.84 61.72)"
                style="font-size:12px;fill:#231815;font-family:AdobeSongStd-Light-GBpc-EUC-H, Adobe Song Std">后端</text>
        </svg>
        <span class="legend">编译器模型</span>
    </div>
    <p>所以我们可以一步一步的剖析这些流程。</p>
    <h1>词法分析</h1>
    <p>编译器的词法分析阶段可以用很多技术,当然很多编译器都是使用正规语言作为一个词法分析器,因为正则表达式比较容易编写。考虑一下开始我们说的加法,如果我们要解析"1+(2+3)"这个源码,那么我们需要把这个输入依次转换为:</p>
    <table>
        <tbody>
            <tr>
                <td>num</td>
                <td>+</td>
                <td>(</td>
                <td>num</td>
                <td>+</td>
                <td>num</td>
                <td>)</td>
            </tr>
        </tbody>
    </table>
    <p>那么我们可以编写如下的正则规则:</p>
    <table>
        <tbody>
            <tr>
                <td>num</td>
                <td>[0-9]+</td>
            </tr>
            <tr>
                <td>left bracket</td>
                <td>'('</td>
            </tr>
            <tr>
                <td>right bracket</td>
                <td>')'</td>
            </tr>
            <tr>
                <td>add operator</td>
                <td>'+'</td>
            </tr>
        </tbody>
    </table>
    <p>所以首先需要做的就是实现我们自己的正则解析器。为了实现正则解析,可以借助两个工具NFA(non-deterministic finite automaton)和DFA(deterministic finite
        automaton)</p>
    <h2>NFA</h2>
    <p>NFA的定义很简单,满足如下几个条件即可</p>
    <ol>
        <li>有限的状态集合(finite的由来)</li>
        <li>输入字母表</li>
        <li>状态转换函数,定义了每一个状态对于字母表中字母的后继状态</li>
        <li>一个开始和结束状态</li>
    </ol>
    <p>这么说是不是很抽象,举个例子其实就很简单明了了,假设我们有如下一个nfa,我们说明一下NFA的工作机制。</p>
    <ol>
        <li>在最开始的时候,状态机总是处于start状态</li>
        <li>状态机总是记录着当前处于那些状态(一个状态集)</li>
        <li>如果当前状态集任意一条边(状态转移函数)能接受某个输入字母a,则将所有这些边的目标状态到一个集合中,并且使这个集合作为当前集合对于输入字母a的后继集合</li>
        <li>如果最终状态机停止的时候,当前状态集中包含了end状态,则说明这个NFA接受的输入的字符串</li>
    </ol>
    <p>需要特别注意的是:<em>ε表示一个空符号,如果ε出现在状态机的某条边上,表示可以无条件从前一个状态沿这条边到达后继状态</em></p>
    <p>在下面我做了动画演示,处理字母序列'aab'和'b'的情况</p>
    <div id="NFA-1">
        <svg style="width: 600pt;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 625 189.81">
            <g id="p_0_1" data-name="p 0 1">
                <line x1="105" y1="102.24" x2="141.14" y2="102.24"
                    style="fill: none; stroke: #000; stroke-miterlimit: 10;" pathLength="100" />
                <polygon points="139.16 105.14 150 102.24 139.16 99.33 139.16 105.14"
                    style="fill: #000; stroke-width: 0px;" />
            </g>
            <g id="p_1_2" data-name="p 1 2">
                <line x1="210" y1="102.24" x2="246.14" y2="102.24"
                    style="fill: none; stroke: #000; stroke-miterlimit: 10;" pathLength="100" />
                <polygon points="244.16 105.14 255 102.24 244.16 99.33 244.16 105.14"
                    style="fill: #000; stroke-width: 0px;" />
            </g>
            <g id="p_2_3" data-name="p 2 3">
                <line x1="315" y1="102.24" x2="351.14" y2="102.24"
                    style="fill: none; stroke: #000; stroke-miterlimit: 10;" pathLength="100" />
                <polygon points="349.16 105.14 360 102.24 349.16 99.33 349.16 105.14"
                    style="fill: #000; stroke-width: 0px;" />
            </g>
            <g id="p_3_4" data-name="p 3 4">
                <line x1="420" y1="102.24" x2="456.14" y2="102.24"
                    style="fill: none; stroke: #000; stroke-miterlimit: 10;" pathLength="100" />
                <polygon points="454.16 105.14 465 102.24 454.16 99.33 454.16 105.14"
                    style="fill: #000; stroke-width: 0px;" />
            </g>
            <g id="p_4_5" data-name="p 4 5">
                <line x1="525" y1="102.24" x2="561.14" y2="102.24"
                    style="fill: none; stroke: #000; stroke-miterlimit: 10;" pathLength="100" />
                <polygon points="559.16 105.14 570 102.24 559.16 99.33 559.16 105.14"
                    style="fill: #000; stroke-width: 0px;" />
            </g>
            <g id="p_2_1" data-name="p 2 1">
                <path d="M285,72.24c0-68.77-96.19-71.72-104.44-8.85"
                    style="fill: none; stroke: #000; stroke-miterlimit: 10;" pathLength="100" />
                <polygon points="177.87 61.22 180 72.24 183.66 61.63 177.87 61.22"
                    style="fill: #000; stroke-width: 0px;" />
            </g>
            <g id="p_0_3" data-name="p 0 3">
                <path d="M75,132.24c102.33,49.53,204.67,50.79,307,3.78"
                    style="fill: none; stroke: #000; stroke-miterlimit: 10;" pathLength="100" />
                <polygon points="381.33 139.36 390 132.24 378.93 134.07 381.33 139.36"
                    style="fill: #000; stroke-width: 0px;" />
            </g>
            <text transform="translate(230 94.19)"
                style="fill: #000; font-family: ArialMT, Arial; font-size: 12px; isolation: isolate;">
                <tspan x="0" y="0">a</tspan>
            </text>
            <text transform="translate(544.48 94.19)"
                style="fill: #000; font-family: ArialMT, Arial; font-size: 12px; isolation: isolate;">
                <tspan x="0" y="0">b</tspan>
            </text>
            <text transform="translate(226.5 10.3)"
                style="fill: #000; font-family: ArialMT, Arial; font-size: 12px; isolation: isolate;">
                <tspan x="0" y="0">ε</tspan>
            </text>
            <text transform="translate(331.5 94.19)"
                style="fill: #000; font-family: ArialMT, Arial; font-size: 12px; isolation: isolate;">
                <tspan x="0" y="0">ε</tspan>
            </text>
            <text transform="translate(436.5 94.19)"
                style="fill: #000; font-family: ArialMT, Arial; font-size: 12px; isolation: isolate;">
                <tspan x="0" y="0">ε</tspan>
            </text>
            <text transform="translate(121.5 94.19)"
                style="fill: #000; font-family: ArialMT, Arial; font-size: 12px; isolation: isolate;">
                <tspan x="0" y="0">ε</tspan>
            </text>
            <text transform="translate(226.5 185.92)"
                style="fill: #000; font-family: ArialMT, Arial; font-size: 12px; isolation: isolate;">
                <tspan x="0" y="0">ε</tspan>
            </text>
            <g id="state0">
                <circle cx="75" cy="102.24" r="25" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                <text transform="translate(60.16 107.87)"
                    style="fill: #000; font-family: ArialMT, Arial; font-size: 18px; isolation: isolate;">
                    <tspan x="0" y="0">start</tspan>
                </text>
            </g>
            <g id="state1">
                <circle cx="180" cy="102.24" r="25" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                <text transform="translate(175.84 107.87)"
                    style="fill: #000; font-family: ArialMT, Arial; font-size: 18px; isolation: isolate;">
                    <tspan x="0" y="0">1</tspan>
                </text>
            </g>
            <g id="state2">
                <circle cx="285" cy="102.24" r="25" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                <text transform="translate(280.84 107.87)"
                    style="fill: #000; font-family: ArialMT, Arial; font-size: 18px; isolation: isolate;">
                    <tspan x="0" y="0">2</tspan>
                </text>
            </g>
            <g id="state3">
                <circle cx="390" cy="102.24" r="25" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                <text transform="translate(385.84 107.87)"
                    style="fill: #000; font-family: ArialMT, Arial; font-size: 18px; isolation: isolate;">
                    <tspan x="0" y="0">3</tspan>
                </text>
            </g>
            <g id="state4">
                <circle cx="495" cy="102.24" r="25" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                <text transform="translate(490.84 107.87)"
                    style="fill: #000; font-family: ArialMT, Arial; font-size: 18px; isolation: isolate;">
                    <tspan x="0" y="0">4</tspan>
                </text>
            </g>
            <g id="state5">
                <path
                    d="M600,80.74c11.87,0,21.5,9.63,21.5,21.5s-9.63,21.5-21.5,21.5-21.5-9.63-21.5-21.5h0c.01-11.87,9.63-21.49,21.5-21.5M600,79.74c-12.43,0-22.5,10.07-22.5,22.5s10.07,22.5,22.5,22.5,22.5-10.07,22.5-22.5h0c0-12.43-10.07-22.5-22.5-22.5Z"
                    style="fill: #000; stroke-width: 0px;" />
                <path
                    d="M600,78.24c13.25,0,24,10.75,24,24s-10.75,24-24,24-24-10.75-24-24,10.75-24,24-24M600,77.24c-13.81,0-25,11.19-25,25s11.19,25,25,25,25-11.19,25-25-11.19-25-25-25Z"
                    style="fill: #000; stroke-width: 0px;" />
                <text transform="translate(586.76 107.87)"
                    style="fill: #000; font-family: ArialMT, Arial; font-size: 18px; isolation: isolate;">
                    <tspan x="0" y="0">end</tspan>
                </text>
            </g>
            <g id="p_0_0" data-name="p 0 0">
                <line y1="102.24" x2="36.14" y2="102.24" style="fill: none; stroke: #000; stroke-miterlimit: 10;"
                    pathLength="100" />
                <polygon points="34.16 105.14 45 102.24 34.16 99.33 34.16 105.14"
                    style="fill: #000; stroke-width: 0px;" />
            </g>
        </svg>
        <div>
            <span>这里有上面NFA处理两个字符串的示意图,可以点击下一步观看</span><br />
            <ul>
                <li>
                    <span>aab</span><button id="aab">下一步</button>
                </li>
                <li>
                    <span>b</span><button id="b">下一步</button>
                </li>
            </ul>
            <span>当前状态集: </span><span id="now"></span><br />
            <span>当前可接受字母: </span><span id="letters"></span><br />
            <span>处理字母: </span><span id="letter" style="color: red;"></span><br />
        </div>
    </div>
    <p>通过上面动画,我们可以发现这个nfa和正则表达式"a*b"是完全等价的,实际上任何基本正则表达式都是能完全转化为NFA的,他们的表达能力一致。基本正则是指没有加上开发者自己的扩展功能,比如匹配到单词"boom"就在屏幕放一个烟花,或者其他特殊语法。实际上一些扩展功能,比如分组匹配在nfa中也是存在的,在NFA转换成DFA的过程中会丢失一些信息使得类似分组匹配这些功能失效。基本正则简称BRE,被扩展过的叫做ERE。参考--
        <q cite="https://en.wikipedia.org/wiki/Regular_expression#Standards">
            <a href="https://en.wikipedia.org/wiki/Regular_expression#Standards">Regular expression</a>
        </q>
    </p>
    <p><em>这里只是我对BRE和ERE的的理解,来不及查阅文献了,应该不会偏差太多 ƪ(˘⌣˘)ʃ</em></p>
    <p>基本正则表达式只包含如下三种结构</p>
    <ol>
        <li>连接,如:abc就表示"a连接b得到的一个表达式再连接c",也就是解析这个式子之后得到的结构应该是这样的(ab)c</li>
        <li>并,如:a|b</li>
        <li>克林闭包,如:a*</li>
    </ol>
    <p>而类似a+这种语法是ERE里面才有的。</p>
    <h2>克林闭包(Kleene closure)</h2>
    <p>
        <a href="https://en.wikipedia.org/wiki/Kleene_star">克林闭包</a>
        在计算机科学中也扮演着重要的角色,不管是做正则引擎还是后面会说的上下文无关文法分析器,以及在关系数据库中计算一个关系R的候选码的时候,都会用到这个概念。
    </p>
    <h3>某个状态集合s的克林闭包的计算方法:</h3>
    closure(s)
    <ol>
        <li>将s中的所有状态添加到待扫描列表(new_state_list)中</li>
        <li>for(new_state_list中的每一个项now)</li>
        <ol>
            <li>for(所有以now为起点的ε边)</li>
            <ol>
                <li>判断该ε边的后继状态t是否已经存在于s中</li>
                <ul>
                    <li>如果t不存在于s中,则将t添加到s和new_state_list</li>
                    <li>否则不需要做任何事</li>
                </ul>
            </ol>
        </ol>
    </ol>
    <h2>正则表达式到NFA的转换</h2>
    <p>为什么要将正则表达式转换为NFA呢?<em>因为直接编写正则表达式的处理程序是比较困难的,借助NFA这种状态机的思想,我们就可以比较简单的通过状态转换实现正则表达式的功能。</em>有的编程语言在用正则表达式的时候会有一个编译步骤,比如java的Pattern.compile,编译过程一般就是将用户输入的正则表达式编译成状态机(这句话我不负法律责任,我凭经验猜的,所以前面加了"一般"两个字)
    </p>
    <p>前面已经提过,正则表达式和NFA的能力一致,所以存在将正则转换为NFA的方法。在本教程里面,我们只考虑基本正则表达式到NFA的转换。需要注意的是:<em>我在下面做的转换可能存在一些冗余,比如两个子表达式连接的时候,前一个子串的end状态和后一个子串的start状态也可以合并,所以我这种转换方法不是唯一解决方案。</em>
    </p>
    <ol>
        <li>
            <p>对于任何一个正则,我们可以构造这样一个NFA</p>
            <svg style="height: 40pt;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 255.5 51">
                <circle cx="70" cy="25.5" r="25" style="fill: none; stroke: #231815; stroke-miterlimit: 10;" />
                <text transform="translate(60.11 29.26)"
                    style="fill: #231815; font-family: ArialMT, Arial; font-size: 12px; isolation: isolate;">
                    <tspan x="0" y="0">start</tspan>
                </text>
                <circle cx="230" cy="25.5" r="25" style="fill: none; stroke: #231815; stroke-miterlimit: 10;" />
                <circle cx="230" cy="25.5" r="23" style="fill: none; stroke: #231815; stroke-miterlimit: 10;" />
                <text transform="translate(221.17 29.26)"
                    style="fill: #231815; font-family: ArialMT, Arial; font-size: 12px; isolation: isolate;">
                    <tspan x="0" y="0">end</tspan>
                </text>
                <line y1="25.5" x2="31.14" y2="25.5" style="fill: none; stroke: #231815; stroke-miterlimit: 10;" />
                <polygon points="29.16 28.41 40 25.5 29.16 22.59 29.16 28.41"
                    style="fill: #231815; stroke-width: 0px;" />
                <line x1="100" y1="25.5" x2="191.14" y2="25.5"
                    style="fill: none; stroke: #231815; stroke-miterlimit: 10;" />
                <polygon points="189.16 28.41 200 25.5 189.16 22.59 189.16 28.41"
                    style="fill: #231815; stroke-width: 0px;" />
                <rect x="120" y="10.5" width="60" height="30" rx="5" ry="5"
                    style="fill: #fff; stroke: #231815; stroke-miterlimit: 10;" />
                <text transform="translate(126 30.69)"
                    style="fill: #231815; font-family:ArialMT, Arial; font-size: 12px; font-weight: 300; isolation: isolate;">
                    <tspan x="0" y="0">子表达式</tspan>
                </text>
            </svg>
        </li>
        <li>
            <p>对于单个字母a,构造这样一个NFA</p>
            <svg style="height: 40pt;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 195.5 51">
                <circle cx="70" cy="25.5" r="25" style="fill: none; stroke: #231815; stroke-miterlimit: 10;" />
                <text transform="translate(60.11 29.26)"
                    style="fill: #231815; font-family: ArialMT, Arial; font-size: 12px; isolation: isolate;">
                    <tspan x="0" y="0">start</tspan>
                </text>
                <circle cx="170" cy="25.5" r="25" style="fill: none; stroke: #231815; stroke-miterlimit: 10;" />
                <circle cx="170" cy="25.5" r="23" style="fill: none; stroke: #231815; stroke-miterlimit: 10;" />
                <text transform="translate(161.17 29.26)"
                    style="fill: #231815; font-family: ArialMT, Arial; font-size: 12px; isolation: isolate;">
                    <tspan x="0" y="0">end</tspan>
                </text>
                <line y1="25.5" x2="31.14" y2="25.5" style="fill: none; stroke: #231815; stroke-miterlimit: 10;" />
                <polygon points="29.16 28.41 40 25.5 29.16 22.59 29.16 28.41"
                    style="fill: #231815; stroke-width: 0px;" />
                <line x1="100" y1="25.5" x2="131.14" y2="25.5"
                    style="fill: none; stroke: #231815; stroke-miterlimit: 10;" />
                <polygon points="129.16 28.41 140 25.5 129.16 22.59 129.16 28.41"
                    style="fill: #231815; stroke-width: 0px;" />
                <text transform="translate(117.5 17.45)"
                    style="fill: #231815; font-family: ArialMT, Arial; font-size: 12px; isolation: isolate;">
                    <tspan x="0" y="0">a</tspan>
                </text>
            </svg>
        </li>
        <li>
            <p>子表达式α连接β时,构造这样一个NFA</p>
            <svg style="height: 40pt;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 515.5 51">
                <circle cx="70" cy="25.5" r="25" style="fill: none; stroke: #231815; stroke-miterlimit: 10;" />
                <text transform="translate(60.11 29.26)"
                    style="fill: #231815; font-family: ArialMT, Arial; font-size: 12px; isolation: isolate;">
                    <tspan x="0" y="0">start</tspan>
                </text>
                <circle cx="230" cy="25.5" r="25" style="fill: none; stroke: #231815; stroke-miterlimit: 10;" />
                <text transform="translate(221.17 29.26)"
                    style="fill: #231815; font-family: ArialMT, Arial; font-size: 12px; isolation: isolate;">
                    <tspan x="0" y="0">end</tspan>
                </text>
                <line y1="25.5" x2="31.14" y2="25.5" style="fill: none; stroke: #231815; stroke-miterlimit: 10;" />
                <polygon points="29.16 28.41 40 25.5 29.16 22.59 29.16 28.41"
                    style="fill: #231815; stroke-width: 0px;" />
                <line x1="100" y1="25.5" x2="191.14" y2="25.5"
                    style="fill: none; stroke: #231815; stroke-miterlimit: 10;" />
                <polygon points="189.16 28.41 200 25.5 189.16 22.59 189.16 28.41"
                    style="fill: #231815; stroke-width: 0px;" />
                <rect x="120" y="10.5" width="60" height="30" rx="5" ry="5"
                    style="fill: #fff; stroke: #231815; stroke-miterlimit: 10;" />
                <text transform="translate(122.42 28.85)"
                    style="fill: #231815; font-family: DengXian, DengXian; font-size: 12px; isolation: isolate;">
                    <tspan x="0" y="0">子表达式α</tspan>
                </text>
                <circle cx="330" cy="25.5" r="25" style="fill: none; stroke: #231815; stroke-miterlimit: 10;" />
                <text transform="translate(320.11 29.26)"
                    style="fill: #231815; font-family: ArialMT, Arial; font-size: 12px; isolation: isolate;">
                    <tspan x="0" y="0">start</tspan>
                </text>
                <circle cx="490" cy="25.5" r="25" style="fill: none; stroke: #231815; stroke-miterlimit: 10;" />
                <circle cx="490" cy="25.5" r="23" style="fill: none; stroke: #231815; stroke-miterlimit: 10;" />
                <text transform="translate(481.17 29.26)"
                    style="fill: #231815; font-family: ArialMT, Arial; font-size: 12px; isolation: isolate;">
                    <tspan x="0" y="0">end</tspan>
                </text>
                <line x1="260" y1="25.5" x2="291.14" y2="25.5"
                    style="fill: none; stroke: #231815; stroke-miterlimit: 10;" />
                <polygon points="289.16 28.41 300 25.5 289.16 22.59 289.16 28.41"
                    style="fill: #231815; stroke-width: 0px;" />
                <line x1="360" y1="25.5" x2="451.14" y2="25.5"
                    style="fill: none; stroke: #231815; stroke-miterlimit: 10;" />
                <polygon points="449.16 28.41 460 25.5 449.16 22.59 449.16 28.41"
                    style="fill: #231815; stroke-width: 0px;" />
                <rect x="380" y="10.5" width="60" height="30" rx="5" ry="5"
                    style="fill: #fff; stroke: #231815; stroke-miterlimit: 10;" />
                <text transform="translate(382.42 28.85)"
                    style="fill: #231815; font-family: DengXian, DengXian; font-size: 12px; isolation: isolate;">
                    <tspan x="0" y="0">子表达式β</tspan>
                </text>
                <text transform="translate(277.37 17.46)"
                    style="fill: #231815; font-family: DengXian, DengXian; font-size: 12px; isolation: isolate;">
                    <tspan x="0" y="0">ε</tspan>
                </text>
            </svg>
            <p>我们把表达式α的结束状态和表达式β的开始状态用一条ε边连接得到一个新的状态机,然后以α的开始状态作为新状态机的开始,以β的结束状态作为新状态机的结束状态。</p>
        </li>
        <li>
            <p>两个子表达式α、β并联的时候(α|β),构造这样一个NFA</p>
            <svg style="height: 100pt;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 486.31 106">
                <circle cx="182.8" cy="25.5" r="25" style="fill: none; stroke: #231815; stroke-miterlimit: 10;" />
                <text transform="translate(172.91 29.26)"
                    style="fill: #231815; font-family: ArialMT, Arial; font-size: 12px; isolation: isolate;">
                    <tspan x="0" y="0">start</tspan>
                </text>
                <circle cx="70" cy="53" r="25" style="fill: none; stroke: #e60012; stroke-miterlimit: 10;" />
                <text transform="translate(60.11 56.76)"
                    style="fill: #e60012; font-family: ArialMT, Arial; font-size: 12px; isolation: isolate;">
                    <tspan x="0" y="0">start</tspan>
                </text>
                <circle cx="342.8" cy="25.5" r="25" style="fill: none; stroke: #231815; stroke-miterlimit: 10;" />
                <text transform="translate(333.98 29.26)"
                    style="fill: #231815; font-family: ArialMT, Arial; font-size: 12px; isolation: isolate;">
                    <tspan x="0" y="0">end</tspan>
                </text>
                <line x1="98.03" y1="48" x2="144.61" y2="28.87"
                    style="fill: none; stroke: #e60012; stroke-miterlimit: 10;" />
                <polygon points="143.88 32.31 152.8 25.5 141.67 26.93 143.88 32.31"
                    style="fill: #e60012; stroke-width: 0px;" />
                <line x1="212.8" y1="25.5" x2="303.94" y2="25.5"
                    style="fill: none; stroke: #231815; stroke-miterlimit: 10;" />
                <polygon points="301.96 28.41 312.8 25.5 301.96 22.59 301.96 28.41"
                    style="fill: #231815; stroke-width: 0px;" />
                <rect x="232.8" y="10.5" width="60" height="30" rx="5" ry="5"
                    style="fill: #fff; stroke: #231815; stroke-miterlimit: 10;" />
                <text transform="translate(235.22 28.85)"
                    style="fill: #231815; font-family: DengXian, DengXian; font-size: 12px; isolation: isolate;">
                    <tspan x="0" y="0">子表达式α</tspan>
                </text>
                <line x1="372.8" y1="25.5" x2="419.29" y2="44.63"
                    style="fill: none; stroke: #e60012; stroke-miterlimit: 10;" />
                <polygon points="416.35 46.56 427.48 48 418.56 41.19 416.35 46.56"
                    style="fill: #e60012; stroke-width: 0px;" />
                <line y1="53" x2="31.14" y2="53" style="fill: none; stroke: #e60012; stroke-miterlimit: 10;" />
                <polygon points="29.16 55.91 40 53 29.16 50.09 29.16 55.91" style="fill: #e60012; stroke-width: 0px;" />
                <text transform="translate(397.51 32.08)"
                    style="fill: #e60012; font-family: DengXian, DengXian; font-size: 12px; isolation: isolate;">
                    <tspan x="0" y="0">ε</tspan>
                </text>
                <text transform="translate(122.79 32.08)"
                    style="fill: #e60012; font-family: DengXian, DengXian; font-size: 12px; isolation: isolate;">
                    <tspan x="0" y="0">ε</tspan>
                </text>
                <text transform="translate(122.79 64.58)"
                    style="fill: #e60012; font-family: DengXian, DengXian; font-size: 12px; isolation: isolate;">
                    <tspan x="0" y="0">ε</tspan>
                </text>
                <circle cx="182.8" cy="80.5" r="25" style="fill: none; stroke: #231815; stroke-miterlimit: 10;" />
                <text transform="translate(172.91 84.26)"
                    style="fill: #231815; font-family: ArialMT, Arial; font-size: 12px; isolation: isolate;">
                    <tspan x="0" y="0">start</tspan>
                </text>
                <circle cx="342.8" cy="80.5" r="25" style="fill: none; stroke: #231815; stroke-miterlimit: 10;" />
                <text transform="translate(333.98 84.26)"
                    style="fill: #231815; font-family: ArialMT, Arial; font-size: 12px; isolation: isolate;">
                    <tspan x="0" y="0">end</tspan>
                </text>
                <circle cx="460.81" cy="53" r="25" style="fill: none; stroke: #e60012; stroke-miterlimit: 10;" />
                <circle cx="460.81" cy="53" r="23" style="fill: none; stroke: #e60012; stroke-miterlimit: 10;" />
                <text transform="translate(451.99 56.76)"
                    style="fill: #e60012; font-family: ArialMT, Arial; font-size: 12px; isolation: isolate;">
                    <tspan x="0" y="0">end</tspan>
                </text>
                <line x1="98.03" y1="58" x2="144.61" y2="77.13"
                    style="fill: none; stroke: #e60012; stroke-miterlimit: 10;" />
                <polygon points="141.67 79.07 152.8 80.5 143.88 73.69 141.67 79.07"
                    style="fill: #e60012; stroke-width: 0px;" />
                <line x1="212.8" y1="80.5" x2="303.94" y2="80.5"
                    style="fill: none; stroke: #231815; stroke-miterlimit: 10;" />
                <polygon points="301.96 83.41 312.8 80.5 301.96 77.59 301.96 83.41"
                    style="fill: #231815; stroke-width: 0px;" />
                <rect x="232.8" y="65.5" width="60" height="30" rx="5" ry="5"
                    style="fill: #fff; stroke: #231815; stroke-miterlimit: 10;" />
                <text transform="translate(235.22 83.85)"
                    style="fill: #231815; font-family: DengXian, DengXian; font-size: 12px; isolation: isolate;">
                    <tspan x="0" y="0">子表达式α</tspan>
                </text>
                <line x1="372.8" y1="80.5" x2="419.29" y2="61.37"
                    style="fill: none; stroke: #e60012; stroke-miterlimit: 10;" />
                <polygon points="418.56 64.81 427.48 58 416.35 59.44 418.56 64.81"
                    style="fill: #e60012; stroke-width: 0px;" />
                <text transform="translate(397.51 64.58)"
                    style="fill: #e60012; font-family: DengXian, DengXian; font-size: 12px; isolation: isolate;">
                    <tspan x="0" y="0">ε</tspan>
                </text>
            </svg>
            <p>我们创建了一个新的start状态和end状态作为新状态机的开始、结束状态(红色),然后从新start创建两条ε边,分别连接到原来子串的start状态。从原来两个子串的end状态各创建一条ε边连接到新end状态
            </p>
        </li>
        <li>
            <p>求子表达式α克林闭包(α*)的时候,构造这样一个NFA</p>
            <svg style="height: 220pt;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 455.5 208.9">
                <circle cx="170" cy="87.97" r="25" style="fill: none; stroke: #231815; stroke-miterlimit: 10;" />
                <text transform="translate(160.11 91.72)"
                    style="fill: #231815; font-family: ArialMT, Arial; font-size: 12px; isolation: isolate;">
                    <tspan x="0" y="0">start</tspan>
                </text>
                <circle cx="70" cy="87.97" r="25" style="fill: none; stroke: #d71718; stroke-miterlimit: 10;" />
                <text transform="translate(60.11 91.72)"
                    style="fill: #d71718; font-family: ArialMT, Arial; font-size: 12px; isolation: isolate;">
                    <tspan x="0" y="0">start</tspan>
                </text>
                <circle cx="330" cy="87.97" r="25" style="fill: none; stroke: #231815; stroke-miterlimit: 10;" />
                <text transform="translate(321.17 91.72)"
                    style="fill: #231815; font-family: ArialMT, Arial; font-size: 12px; isolation: isolate;">
                    <tspan x="0" y="0">end</tspan>
                </text>
                <line x1="200" y1="87.97" x2="291.14" y2="87.97"
                    style="fill: none; stroke: #231815; stroke-miterlimit: 10;" />
                <polygon points="289.16 90.87 300 87.97 289.16 85.06 289.16 90.87"
                    style="fill: #231815; stroke-width: 0px;" />
                <rect x="220" y="72.97" width="60" height="30" rx="5" ry="5"
                    style="fill: #fff; stroke: #231815; stroke-miterlimit: 10;" />
                <text transform="translate(222.42 91.3)"
                    style="fill: #231815; font-family: DengXian, DengXian; font-size: 12px; isolation: isolate;">
                    <tspan x="0" y="0">子表达式α</tspan>
                </text>
                <line y1="87.97" x2="31.14" y2="87.97" style="fill: none; stroke: #d71718; stroke-miterlimit: 10;" />
                <polygon points="29.16 90.87 40 87.97 29.16 85.06 29.16 90.87"
                    style="fill: #d71718; stroke-width: 0px;" />
                <line x1="100" y1="87.97" x2="131.14" y2="87.97"
                    style="fill: none; stroke: #d71718; stroke-miterlimit: 10;" />
                <polygon points="129.16 90.87 140 87.97 129.16 85.06 129.16 90.87"
                    style="fill: #d71718; stroke-width: 0px;" />
                <line x1="360" y1="87.97" x2="391.14" y2="87.97"
                    style="fill: none; stroke: #d71718; stroke-miterlimit: 10;" />
                <polygon points="389.16 90.87 400 87.97 389.16 85.06 389.16 90.87"
                    style="fill: #d71718; stroke-width: 0px;" />
                <text transform="translate(377.37 79.93)"
                    style="fill: #d71718; font-family: DengXian, DengXian; font-size: 12px; isolation: isolate;">
                    <tspan x="0" y="0">ε</tspan>
                </text>
                <text transform="translate(117.37 79.93)"
                    style="fill: #d71718; font-family: DengXian, DengXian; font-size: 12px; isolation: isolate;">
                    <tspan x="0" y="0">ε</tspan>
                </text>
                <text transform="translate(244.66 205.86)"
                    style="fill: #d71718; font-family: DengXian, DengXian; font-size: 12px; isolation: isolate;">
                    <tspan x="0" y="0">ε</tspan>
                </text>
                <text transform="translate(248.14 9.7)"
                    style="fill: #d71718; font-family: DengXian, DengXian; font-size: 12px; isolation: isolate;">
                    <tspan x="0" y="0">ε</tspan>
                </text>
                <circle cx="430" cy="87.97" r="25" style="fill: none; stroke: #d71718; stroke-miterlimit: 10;" />
                <circle cx="430" cy="87.97" r="23" style="fill: none; stroke: #d71718; stroke-miterlimit: 10;" />
                <text transform="translate(421.17 91.72)"
                    style="fill: #d71718; font-family: ArialMT, Arial; font-size: 12px; isolation: isolate;">
                    <tspan x="0" y="0">end</tspan>
                </text>
                <path d="M70,117.97c68.28,95.2,279.29,97.53,354.58,7"
                    style="fill: none; stroke: #d71718; stroke-miterlimit: 10;" />
                <polygon points="425.6 128.29 430 117.97 421.03 124.71 425.6 128.29"
                    style="fill: #d71718; stroke-width: 0px;" />
                <path d="M330,57.97c0-50.56-142.12-53.47-158.47-8.73"
                    style="fill: none; stroke: #d71718; stroke-miterlimit: 10;" />
                <polygon points="169.22 46.77 170 57.97 174.92 47.88 169.22 46.77"
                    style="fill: #d71718; stroke-width: 0px;" />
            </svg>
            <p>
                我们创建了一个新的start状态和end状态作为新状态机的开始、结束状态(红色),然后从新start创建两条ε边,分别连接到原子串的start和新的end状态。从原子串的end状态创建两条ε边,分别连接到原来子串的start状态和新end状态
            </p>
        </li>
    </ol>
    <p>通过上述几种基本的正则规则,我们可以实现一些扩展正则功能,比如"a+bc"这个正则表达式识别的是"以一个或者多个a开头,后面再连接bc两个字母",我们可以用"aa*bc"这个基本正则表达式描述</p>
    <h2>DFA</h2>
    <p>NFA在运行的时候,我们需要不断的计算闭包,这个过程比较消耗内存和CPU,看上面demo中的NFA运行示意图,我们进入start状态或者输入一个字母a之后,还得不断地搜索当前集合能通过ε边达到的新状态。存在一个简化NFA处理机制的方法,我们可以把NFA转换为DFA(deterministic
        finite automaton)。需要注意的是:<em>在NFA转换为DFA的过程中,其实并没有简化运算,但是在转换完成之后,速度将会直接起飞。</em></p>
    <p>当前NFA转换成DFA的过程也很简单,我们只要按照如下步骤循环进行就可以了</p>
    <div id="NFA-2-DFA">
        <ol>
            <li>首先将closure(start)作为DFA的唯一状态,然后将closure(start)添加到待扫描状态集列表(new_stateset_list)中
            </li>
            <li>for(new_stateset_list中的每个状态集now)
                <ol>
                    <li>for(now中所有非ε边,设该边为字母a)
                        <ol>
                            <li>将所有a指向的后继状态添加到next状态集中</li>
                            <li>检查clouser(next)是否已经存在于DFA中
                                <ul>
                                    <li>如果closure(next)没有存在于DFA,则将closure(next)分别添加到DFA和待扫描状态集列表中。并在now创建一条边a指向closure(next)
                                    </li>
                                    <li>如果closure(next)已经存在于DFA,则直接now创建一条边a指向closure(next)</li>
                                </ul>
                            </li>
                        </ol>
                    </li>
                </ol>
            </li>
            <li>直到new_stateset_list没有任何新增状态集,程序结束</li>
        </ol>
        <p>将"a*b"对应的NFA转换成DFA的动画,点击下一步观看:<button id="next">下一步</button></p>
        <svg style="height: 500pt;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 802.07 495.12">
            <g id="p_0_1" data-name="p 0 1">
                <line style="fill: none;stroke: #000;stroke-miterlimit: 10;" x1="105" y1="102.24" x2="141.14"
                    y2="102.24" pathLength="100" />
                <polygon points="139.16 105.14 150 102.24 139.16 99.33 139.16 105.14" />
            </g>
            <g id="p_1_2" data-name="p 1 2">
                <line style="fill: none;stroke: #000;stroke-miterlimit: 10;" x1="210" y1="102.24" x2="246.14"
                    y2="102.24" pathLength="100" />
                <polygon points="244.16 105.14 255 102.24 244.16 99.33 244.16 105.14" />
            </g>
            <g id="p_2_3" data-name="p 2 3">
                <line style="fill: none;stroke: #000;stroke-miterlimit: 10;" x1="315" y1="102.24" x2="351.14"
                    y2="102.24" pathLength="100" />
                <polygon points="349.16 105.14 360 102.24 349.16 99.33 349.16 105.14" />
            </g>
            <g id="p_3_4" data-name="p 3 4">
                <line style="fill: none;stroke: #000;stroke-miterlimit: 10;" x1="420" y1="102.24" x2="456.14"
                    y2="102.24" pathLength="100" />
                <polygon points="454.16 105.14 465 102.24 454.16 99.33 454.16 105.14" />
            </g>
            <g id="p_4_5" data-name="p 4 5">
                <line style="fill: none;stroke: #000;stroke-miterlimit: 10;" x1="525" y1="102.24" x2="561.14"
                    y2="102.24" pathLength="100" />
                <polygon points="559.16 105.14 570 102.24 559.16 99.33 559.16 105.14" />
            </g>
            <g id="p_2_1" data-name="p 2 1">
                <path style="fill: none;stroke: #000;stroke-miterlimit: 10;"
                    d="M306.52,93.57c0-68.77-96.19-71.72-104.44-8.85" transform="translate(-21.52 -21.33)"
                    pathLength="100" />
                <polygon points="177.87 61.22 180 72.24 183.66 61.63 177.87 61.22" />
            </g>
            <g id="p_0_3" data-name="p 0 3">
                <path style="fill: none;stroke: #000;stroke-miterlimit: 10;" d="M96.52,153.57q153.5,74.3,307,3.78"
                    transform="translate(-21.52 -21.33)" pathLength="100" />
                <polygon points="381.33 139.36 390 132.24 378.93 134.07 381.33 139.36" />
            </g>
            <text style="isolation: isolate;font-family: ArialMT, Arial;font-size: 12px;"
                transform="translate(230 94.19)">a</text>
            <text style="isolation: isolate;font-family: ArialMT, Arial;font-size: 12px;"
                transform="translate(544.48 94.19)">b</text>
            <text style="isolation: isolate;font-family: ArialMT, Arial;font-size: 12px;"
                transform="translate(226.5 10.3)">ε</text>
            <text style="isolation: isolate;font-family: ArialMT, Arial;font-size: 12px;"
                transform="translate(331.5 94.19)">ε</text>
            <text style="isolation: isolate;font-family: ArialMT, Arial;font-size: 12px;"
                transform="translate(436.5 94.19)">ε</text>
            <text style="isolation: isolate;font-family: ArialMT, Arial;font-size: 12px;"
                transform="translate(121.5 94.19)">ε</text>
            <text style="isolation: isolate;font-family: ArialMT, Arial;font-size: 12px;"
                transform="translate(226.5 185.92)">ε</text>
            <g id="state0">
                <circle style="fill: none;stroke: #000;stroke-miterlimit: 10;" cx="75" cy="102.24" r="25" />
                <text style="isolation: isolate;font-family: ArialMT, Arial;font-size: 18px;"
                    transform="translate(60.16 107.87)">start</text>
            </g>
            <g id="state1">
                <circle style="fill: none;stroke: #000;stroke-miterlimit: 10;" cx="180" cy="102.24" r="25" />
                <text style="isolation: isolate;font-family: ArialMT, Arial;font-size: 18px;"
                    transform="translate(175.84 107.87)">1</text>
            </g>
            <g id="state2">
                <circle style="fill: none;stroke: #000;stroke-miterlimit: 10;" cx="285" cy="102.24" r="25" />
                <text style="isolation: isolate;font-family: ArialMT, Arial;font-size: 18px;"
                    transform="translate(280.84 107.87)">2</text>
            </g>
            <g id="state3">
                <circle style="fill: none;stroke: #000;stroke-miterlimit: 10;" cx="390" cy="102.24" r="25" />
                <text style="isolation: isolate;font-family: ArialMT, Arial;font-size: 18px;"
                    transform="translate(385.84 107.87)">3</text>
            </g>
            <g id="state4">
                <circle style="fill: none;stroke: #000;stroke-miterlimit: 10;" cx="495" cy="102.24" r="25" />
                <text style="isolation: isolate;font-family: ArialMT, Arial;font-size: 18px;"
                    transform="translate(490.84 107.87)">4</text>
            </g>
            <g id="state5">
                <path style="stroke-width:0;"
                    d="M621.52,102.07a21.5,21.5,0,1,1-21.5,21.5h0a21.52,21.52,0,0,1,21.5-21.5m0-1a22.5,22.5,0,1,0,22.5,22.5h0A22.5,22.5,0,0,0,621.52,101.07Z"
                    transform="translate(-21.52 -21.33)" />
                <path style="stroke-width:0;"
                    d="M621.52,99.57a24,24,0,1,1-24,24,24,24,0,0,1,24-24m0-1a25,25,0,1,0,25,25A25,25,0,0,0,621.52,98.57Z"
                    transform="translate(-21.52 -21.33)" />
                <text style="isolation: isolate;font-family: ArialMT, Arial;font-size: 18px;"
                    transform="translate(586.76 107.87)">end</text>
            </g>
            <g id="p_0_0" data-name="p 0 0">
                <line style="fill: none;stroke: #000;stroke-miterlimit: 10;" y1="102.24" x2="36.14" y2="102.24" />
                <polygon points="34.16 105.14 45 102.24 34.16 99.33 34.16 105.14" />
            </g>
            <g id="closure_s" style="display: none;">
                <ellipse style="fill: none;stroke: #000;stroke-miterlimit: 10;" cx="133.65" cy="370.26" rx="94.2"
                    ry="67.26" />
                <g id="state0-2" data-name="state0">
                    <circle style="fill: none;stroke: #000;stroke-miterlimit: 10;" cx="106.15" cy="342.76" r="25" />
                    <text style="isolation: isolate;font-family: ArialMT, Arial;font-size: 18px;"
                        transform="translate(91.31 348.39)">start</text>
                </g>
                <g id="state1-2" data-name="state1">
                    <circle style="fill: none;stroke: #000;stroke-miterlimit: 10;" cx="161.15" cy="342.76" r="25" />
                    <text style="isolation: isolate;font-family: ArialMT, Arial;font-size: 18px;"
                        transform="translate(156.99 348.39)">1</text>
                </g>
                <g id="state3-2" data-name="state3">
                    <circle style="fill: none;stroke: #000;stroke-miterlimit: 10;" cx="106.15" cy="397.76" r="25" />
                    <text style="isolation: isolate;font-family: ArialMT, Arial;font-size: 18px;"
                        transform="translate(101.99 403.39)">3</text>
                </g>
                <g id="state4-2" data-name="state4">
                    <circle style="fill: none;stroke: #000;stroke-miterlimit: 10;" cx="161.15" cy="397.76" r="25" />
                    <text style="isolation: isolate;font-family: ArialMT, Arial;font-size: 18px;"
                        transform="translate(156.99 403.39)">4</text>
                </g>
            </g>
            <g id="state2-2" data-name="state2" style="display: none;">
                <circle style="fill: none;stroke: #000;stroke-miterlimit: 10;" cx="312.74" cy="305.89" r="25" />
                <text style="isolation: isolate;font-family: ArialMT, Arial;font-size: 18px;"
                    transform="translate(308.58 311.52)">2</text>
            </g>
            <g id="closure_1234" style="display: none;">
                <g id="state1-3" data-name="state1">
                    <circle style="fill: none;stroke: #000;stroke-miterlimit: 10;" cx="312.74" cy="250.89" r="25" />
                    <text style="isolation: isolate;font-family: ArialMT, Arial;font-size: 18px;"
                        transform="translate(308.58 256.52)">1</text>
                </g>
                <g id="state3-3" data-name="state3">
                    <circle style="fill: none;stroke: #000;stroke-miterlimit: 10;" cx="367.74" cy="250.89" r="25" />
                    <text style="isolation: isolate;font-family: ArialMT, Arial;font-size: 18px;"
                        transform="translate(363.58 256.52)">3</text>
                </g>
                <g id="state4-3" data-name="state4">
                    <circle style="fill: none;stroke: #000;stroke-miterlimit: 10;" cx="367.74" cy="305.89" r="25" />
                    <text style="isolation: isolate;font-family: ArialMT, Arial;font-size: 18px;"
                        transform="translate(363.58 311.52)">4</text>
                </g>
                <ellipse style="fill: none;stroke: #000;stroke-miterlimit: 10;" cx="340.24" cy="279.28" rx="74.18"
                    ry="66.56" />
            </g>
            <g id="state5-2" data-name="state5" style="display: none;">
                <path
                    d="M351.28,459.73a21.5,21.5,0,1,1-21.5,21.5h0a21.52,21.52,0,0,1,21.5-21.5m0-1a22.5,22.5,0,1,0,22.5,22.5h0A22.5,22.5,0,0,0,351.28,458.73Z"
                    transform="translate(-21.52 -21.33)" />
                <path
                    d="M351.28,457.23a24,24,0,1,1-24,24,24,24,0,0,1,24-24m0-1a25,25,0,1,0,25,25A25,25,0,0,0,351.28,456.23Z"
                    transform="translate(-21.52 -21.33)" />
                <text style="isolation: isolate;font-family: ArialMT, Arial;font-size: 18px;"
                    transform="translate(316.51 465.53)">end</text>
            </g>
            <g id="closure_e" style="display: none;">
                <ellipse style="fill: none;stroke: #000;stroke-miterlimit: 10;" cx="329.75" cy="459.9" rx="48.39"
                    ry="34.72" />
            </g>
            <g id="DFA_0_1" style="display: none;">
                <line style="fill: none;stroke: #000;stroke-miterlimit: 10;" x1="215.75" y1="324.28" x2="254.37"
                    y2="303.48" />
                <polygon points="254 306.98 262.17 299.28 251.24 301.86 254 306.98" />
                <text style="font-size: 12px;font-family: AdobeSongStd-Light-GBpc-EUC-H, Adobe Song Std;"
                    transform="translate(236.46 303.01)">a</text>
            </g>
            <g id="DFA_0_2" style="display: none;">
                <line style="fill: none;stroke: #000;stroke-miterlimit: 10;" x1="228.5" y1="403.61" x2="273.74"
                    y2="430.39" />
                <polygon points="270.55 431.88 281.36 434.9 273.51 426.88 270.55 431.88" />
                <text style="font-size: 12px;font-family: AdobeSongStd-Light-GBpc-EUC-H, Adobe Song Std;"
                    transform="translate(254.93 411.64)">b</text>
            </g>
            <g id="DFA_1_1" style="display: none;">
                <path style="fill: none;stroke: #000;stroke-miterlimit: 10;"
                    d="M441.52,291.21c79-39.27,18.22-104.89-31.55-63.24" transform="translate(-21.52 -21.33)" />
                <polygon points="388.02 203.25 382 212.72 391.95 207.53 388.02 203.25" />
                <text style="font-size: 12px;font-family: AdobeSongStd-Light-GBpc-EUC-H, Adobe Song Std;"
                    transform="translate(458.05 201.96)">a</text>
            </g>
            <g id="DFA_1_2" style="display: none;">
                <line style="fill: none;stroke: #000;stroke-miterlimit: 10;" x1="336.3" y1="348.39" x2="332.1"
                    y2="410.2" />
                <polygon points="329.34 408.03 331.5 419.04 335.13 408.42 329.34 408.03" />
                <text style="font-size: 12px;font-family: AdobeSongStd-Light-GBpc-EUC-H, Adobe Song Std;"
                    transform="translate(345.22 386.39)">b</text>
            </g>
            <g id="DFA" style="display: none;">
                <g id="DFA_S0">
                    <circle style="fill: none;stroke: #000;stroke-miterlimit: 10;" cx="571.49" cy="325.47" r="25" />
                    <text style="isolation: isolate;font-family: ArialMT, Arial;font-size: 18px;"
                        transform="translate(556.65 331.1)">start</text>
                </g>
                <g id="DFA_S1">
                    <circle style="fill: none;stroke: #000;stroke-miterlimit: 10;" cx="739.89" cy="289.48" r="25" />
                    <text style="isolation: isolate;font-family: ArialMT, Arial;font-size: 18px;"
                        transform="translate(735.73 295.11)">1</text>
                </g>
                <g id="DFA_S2">
                    <path
                        d="M694.53,444.09a21.5,21.5,0,1,1-21.5,21.5h0a21.52,21.52,0,0,1,21.5-21.5m0-1a22.5,22.5,0,1,0,22.5,22.5h0A22.5,22.5,0,0,0,694.53,443.09Z"
                        transform="translate(-21.52 -21.33)" />
                    <path
                        d="M694.53,441.59a24,24,0,1,1-24,24,24,24,0,0,1,24-24m0-1a25,25,0,1,0,25,25A25,25,0,0,0,694.53,440.59Z"
                        transform="translate(-21.52 -21.33)" />
                    <text style="isolation: isolate;font-family: ArialMT, Arial;font-size: 18px;"
                        transform="translate(659.77 449.88)">end</text>
                </g>
                <line style="fill: none;stroke: #000;stroke-miterlimit: 10;" x1="601.63" y1="317.76" x2="697.9"
                    y2="291.79" />
                <polygon points="696.74 295.11 706.45 289.48 695.23 289.5 696.74 295.11" />
                <line style="fill: none;stroke: #000;stroke-miterlimit: 10;" x1="596.39" y1="348.39" x2="650.46"
                    y2="412.48" />
                <polygon points="646.96 412.84 656.17 419.25 651.4 409.09 646.96 412.84" />
                <line style="fill: none;stroke: #000;stroke-miterlimit: 10;" x1="729.96" y1="318.5" x2="686.8"
                    y2="408.08" />
                <polygon points="685.04 405.04 682.95 416.06 690.27 407.56 685.04 405.04" />
                <path style="fill: none;stroke: #000;stroke-miterlimit: 10;"
                    d="M794.94,308.37c31.58-14,23-50.75-10.68-33.06" transform="translate(-21.52 -21.33)" />
                <polygon points="762.98 250.54 755.17 258.6 765.97 255.53 762.98 250.54" />
                <text style="font-size: 12px;font-family: AdobeSongStd-Light-GBpc-EUC-H, Adobe Song Std;"
                    transform="translate(656.07 295.11)">a</text>
                <text style="font-size: 12px;font-family: AdobeSongStd-Light-GBpc-EUC-H, Adobe Song Std;"
                    transform="translate(611.76 390.5)">b</text>
                <text style="font-size: 12px;font-family: AdobeSongStd-Light-GBpc-EUC-H, Adobe Song Std;"
                    transform="translate(714.89 367.28)">b</text>
                <text style="font-size: 12px;font-family: AdobeSongStd-Light-GBpc-EUC-H, Adobe Song Std;"
                    transform="translate(797.06 254.35)">a</text>
            </g>
        </svg>
    </div>
    <p>可以看到,将NFA转换为DFA之后,大幅度的减少了状态数量,而且不再有任何ε边。并且NFA存在这样一种可能,从某个状态s出发,可能有两条一样的字母a边跳转到不同后继状态n1和n2。</p>
    <svg style="height: 120pt;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 156 134.77">
        <text transform="translate(73.85 36.48)"
            style="fill: #000; font-family: ArialMT, Arial; font-size: 12px; isolation: isolate;">
            <tspan x="0" y="0">a</tspan>
        </text>
        <text transform="translate(74.28 86.95)"
            style="fill: #000; font-family: ArialMT, Arial; font-size: 12px; isolation: isolate;">
            <tspan x="0" y="0">a</tspan>
        </text>
        <g>
            <circle cx="25.5" cy="67.39" r="25" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
            <text transform="translate(21.34 73.02)"
                style="fill: #000; font-family: ArialMT, Arial; font-size: 18px; isolation: isolate;">
                <tspan x="0" y="0">1</tspan>
            </text>
        </g>
        <g>
            <circle cx="130.5" cy="25.5" r="25" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
            <text transform="translate(126.34 31.13)"
                style="fill: #000; font-family: ArialMT, Arial; font-size: 18px; isolation: isolate;">
                <tspan x="0" y="0">2</tspan>
            </text>
        </g>
        <g>
            <circle cx="130.5" cy="109.27" r="25" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
            <text transform="translate(126.34 114.9)"
                style="fill: #000; font-family: ArialMT, Arial; font-size: 18px; isolation: isolate;">
                <tspan x="0" y="0">3</tspan>
            </text>
        </g>
        <line x1="51.53" y1="52.02" x2="92.37" y2="34.61" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
        <polygon points="91.69 38.05 100.52 31.13 89.41 32.71 91.69 38.05" style="fill: #000; stroke-width: 0px;" />
        <line x1="52.32" y1="79.79" x2="93.24" y2="98.31" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
        <polygon points="90.24 100.14 101.31 101.96 92.63 94.84 90.24 100.14" style="fill: #000; stroke-width: 0px;" />
    </svg>
    <p>其实之前的例子中也出现过同一个状态有多个不同的ε边指向不同的目标状态,ε边和字母a是类似的,只不过ε多了一个"允许无条件跳转"的语义</p>
    <h2>词法分析小结:</h2>
    <p>一个正则引擎不一定是用NFA或者DFA运行的,因为DFA速度快,消耗内存小,但是会丢弃一些信息(比如分组信息),所以目前主流的正则实现都是采用NFA方法工作。NFA在匹配的时候必须走所有的可能路径(也可以把这个理解为一种回溯),所以很多NFA在实现的时候当遇到了end状态就直接结束,而DFA则没有这种顾虑,所以可以用这种方法大概的测试一下当前工具使用NFA还是DFA。用"nfa|nfa
        not"这个正则表达式去测试串"nfa not",一般的NFA引擎会解析到nfa就结束。
    </p>
    <p>比如在浏览器控制台执行这行代码,输入如下</p>
    > /nfa|nfa not/.exec('nfa not')[0]<br />
    > 'nfa'
    <p>至此我们已经知道正则引擎是怎么工作的了,可以很轻松的根据已有正则编写出一个状态机运行。但是还有一个问题,正则表达式的表达能力是3型文法,但是正则表达本身是一个2型文法才能描述的语言。所以后续我们将会学习编译器前端的灵魂部分:文法分析
    </p>
    <h1>文法分析</h1>
    <p>第二个坑,龙书对first集计算方法没有讲的很清楚。还有LR(1)后面为什么不用求follow集,因为后面一个一定是非终结符</p>
    <p>文法分析是编译器前端最核心的功能,通常会把编译器的词法分析模块叫做lex(Lexical Analyzer
        Generator),文法分析模块叫做parser,lex将源码变成一个个的token,parser把这些token变成一个AST(abstract syntax
        tree)。在这里我们只讲解2-型文法(上下文无关分发)的parser工作原理</p>
    <h2>first集</h2>
    <p>first(α)表示串α的首个非终结符的集合,比如first(abc)={a},一旦给定一个文法G,则我们就能计算出任何一个串的first集(这个串的所有token必须是文法范文内的终结符、非终结符或者ε),first集的规则如下:
    </p>
    <em>这里和龙书的定义稍微有一点点差别,是按照我的理解对龙书的定义进行了一些拙劣的加工</em>
    <p>计算first(α),其中<math>
            <mi>α</mi>
            <mo>=</mo>
            <msub>
                <mi>X</mi>
                <mn>1</mn>
            </msub>
            <msub>
                <mi>X</mi>
                <mn>2</mn>
            </msub>
            <mi>...</mi>
            <msub>
                <mi>X</mi>
                <mn>n</mn>
            </msub>
        </math>,我们先创建一个空集合作为结果集:ret={},然后从n=1开始依次处理每个符号,假设当前处理的符号下标为i</p>
    <ol>
        <li>如果<math>
                <msub>
                    <mi>X</mi>
                    <mi>i</mi>
                </msub>
            </math>是一个非ε终结符,则将<math>
                <msub>
                    <mi>X</mi>
                    <mi>i</mi>
                </msub>
            </math>添加到ret,并终止计算</li>
        <li>如果<math>
                <msub>
                    <mi>X</mi>
                    <mi>i</mi>
                </msub>
            </math>是ε,进行如下检查
            <ul>
                <li>i等于n(也就是最后一个符号还是ε),将ε添加到ret</li>
                <li>i不等于n(还没到最后一个符号),不做任何动作</li>
            </ul>
        </li>
        <li>如果<math>
                <msub>
                    <mi>X</mi>
                    <mi>i</mi>
                </msub>
            </math>是一个终结符,则对所有以<math>
                <msub>
                    <mi>X</mi>
                    <mi>i</mi>
                </msub>
            </math>开头的产生式<math>
                <msub>
                    <mi>X</mi>
                    <mi>i</mi>
                </msub>
                <mo>→</mo>
                <msub>
                    <mi>β</mi>
                    <mi>1</mi>
                </msub>
            </math>一直到<math>
                <msub>
                    <mi>X</mi>
                    <mi>i</mi>
                </msub>
                <mo>→</mo>
                <msub>
                    <mi>β</mi>
                    <mi>h</mi>
                </msub>
            </math>计算<math>
                <mi>first</mi>
                <mo>(</mo>
                <msub>
                    <mi>β</mi>
                    <mi>j</mi>
                </msub>
                <mo>)</mo>
            </math>,我们把所有的计算结果合并到一个临时集合tmp中,然后检查tmp中是否有ε
            <ul>
                <li>没有ε,则将temp合并到ret中,并终止计算</li>
                <li>有ε,则进行如下检查
                    <ul>
                        <li>i等于n(也就是最后一个符号还包含ε),把temp合并到ret中(此时tmp包含了ε)</li>
                        <li>i不等于n(还没到最后一个符号),从tmp移除ε之后再合并到ret中</li>
                    </ul>
                </li>
            </ul>
        </li>
    </ol>
    <p>假设我们有如下的文法:</p>
    <ol>
        <li><math>
                <mi>S</mi>
                <mo>→</mo>
                <mi>E</mi>
            </math></li>
        <li><math>
                <mi>E</mi>
                <mo>→</mo>
                <mi>a</mi>
            </math></li>
        <li><math>
                <mi>E</mi>
                <mo>→</mo>
                <mi>F</mi>
                <mi>b</mi>
            </math></li>
        <li><math>
                <mi>F</mi>
                <mo>→</mo>
                <mi>ε</mi>
            </math></li>
    </ol>
    <p>则first(S)={a,b}</p>
    <p>龙书的算法大致如上,但是有一点没有说的很清楚,所以我特别补充一下:<em class="stress">在计算first的过程中,遇到递归产生式的处理方法。</em>假设我们有如下文法:
    </p>
    <ol>
        <li><math>
                <mi>S</mi>
                <mo>→</mo>
                <mi>A</mi>
                <mi>B</mi>
            </math></li>
        <li><math>
                <mi>A</mi>
                <mo>→</mo>
                <mi>S</mi>
                <mi>a</mi>
            </math></li>
        <li><math>
                <mi>A</mi>
                <mo>→</mo>
                <mi>ε</mi>
            </math></li>
        <li><math>
                <mi>B</mi>
                <mo>→</mo>
                <mi>S</mi>
                <mi>b</mi>
            </math></li>
    </ol>
    <p>我们在计算first(S)的时候,需要求first(AB),因为<math>
            <mi>A</mi>
            <mo>→</mo>
            <mi>S</mi>
            <mi>a</mi>
        </math>,如果我们单纯的继续展开S,就会进入无限展开,永远都得不到结果。实际上龙书默认我们已经懂了,但是可能部分读者并没有懂的一个知识点:</p>
    <P>(PS:这个定理不是龙书说的,是我编出来的)我把这个称为<span
            class="emphasize">直接推导定理</span>。先定义一下直接推导路径:<em>在符号替换流程中,每个产生式只被使用一次的替换路径叫做直接推导路径。</em>如下的两种推导路径:
    </p>
    <ol>
        <li><math>
                <mi>S</mi>
                <mover>
                    <mo>→</mo>
                    <mo>产生式1替换S</mo>
                </mover>
                <mrow>
                    <mi>A</mi>
                    <mi>B</mi>
                </mrow>
                <mover>
                    <mo>→</mo>
                    <mo>产生式2替换A</mo>
                </mover>
                <mrow>
                    <mi>S</mi>
                    <mi>a</mi>
                    <mi>B</mi>
                </mrow>
                <mover>
                    <mo>→</mo>
                    <mo>产生式4替换B</mo>
                </mover>
                <mrow>
                    <mi>S</mi>
                    <mi>a</mi>
                    <mi>S</mi>
                    <mi>b</mi>
                </mrow>
            </math></li>
        <li><math>
                <mi>S</mi>
                <mover>
                    <mo>→</mo>
                    <mo>产生式1替换S</mo>
                </mover>
                <mrow>
                    <mi>A</mi>
                    <mi>B</mi>
                </mrow>
                <mover>
                    <mo>→</mo>
                    <mo>产生式2替换A</mo>
                </mover>
                <mrow>
                    <mi>S</mi>
                    <mi>a</mi>
                    <mi>B</mi>
                </mrow>
                <mover>
                    <mo>→</mo>
                    <mo>产生式1替换S</mo>
                </mover>
                <mrow>
                    <mi>A</mi>
                    <mi>B</mi>
                    <mi>a</mi>
                    <mi>B</mi>
                </mrow>
            </math></li>
    </ol>
    <p>第一种推导叫做直接推导,第二中就叫做递归推导,因为之前已经用过一次产生式1了,后面的替换中,我们又用产生式1替换,这样可以无穷无止地替换下去。</p>
    <p>知道了直接推导和递归推导的概念之后,就可以说一下直接推导定理了:</p>
    <ul>
        <li class="emphasize">递归推导对first(X)不会对结果产生任何影响</li>
    </ul>
    <p>所以为了解决递归求解first的问题,我们需要先定义一个辅助函数have_epsilon(α),这个函数用于判断,串α的first集合是否包含ε,计算步骤和first及其相似,但是为通用的first函数提供了基础。计算流程如下:
    </p>
    <p>计算have_epsilon(α),其中<math>
            <mi>α</mi>
            <mo>=</mo>
            <msub>
                <mi>X</mi>
                <mn>1</mn>
            </msub>
            <msub>
                <mi>X</mi>
                <mn>2</mn>
            </msub>
            <mi>...</mi>
            <msub>
                <mi>X</mi>
                <mn>n</mn>
            </msub>
        </math>,我们从n=1开始依次处理每个符号,假设当前处理的符号下标为i</p>
    <ol>
        <li>如果<math>
                <msub>
                    <mi>X</mi>
                    <mi>i</mi>
                </msub>
            </math>是ε,则进行如下判断:
            <ul>
                <li>i等于n(也就是最后一个符号还是ε),返回true</li>
                <li>i不等于n(没有到最后一个符号),不做任何动作,进行下一个符号的处理</li>
            </ul>
        </li>
        <li>如果<math>
                <msub>
                    <mi>X</mi>
                    <mi>i</mi>
                </msub>
            </math>是一个终结符,不做任何动作,进行下一个符号的处理</li>
        <li>如果<math>
                <msub>
                    <mi>X</mi>
                    <mi>i</mi>
                </msub>
            </math>是一个终结符,则对所有以<math>
                <msub>
                    <mi>X</mi>
                    <mi>i</mi>
                </msub>
            </math>开头的产生式<math>
                <msub>
                    <mi>X</mi>
                    <mi>i</mi>
                </msub>
                <mo>→</mo>
                <msub>
                    <mi>β</mi>
                    <mi>1</mi>
                </msub>
            </math>一直到<math>
                <msub>
                    <mi>X</mi>
                    <mi>i</mi>
                </msub>
                <mo>→</mo>
                <msub>
                    <mi>β</mi>
                    <mi>h</mi>
                </msub>
            </math><em>(如果<math>
                    <msub>
                        <mi>β</mi>
                        <mi>j</mi>
                    </msub>
                </math>对应的产生式已经被展开过,则我们应该跳过<math>
                    <msub>
                        <mi>β</mi>
                        <mi>j</mi>
                    </msub>
                </math>,否则我们要标记<math>
                    <msub>
                        <mi>β</mi>
                        <mi>j</mi>
                    </msub>
                </math>对应的产生式被展开①)</em>,计算<math>
                <mi>have_epsilon</mi>
                <mo>(</mo>
                <msub>
                    <mi>β</mi>
                    <mi>j</mi>
                </msub>
                <mo>)</mo>
            </math>,并且我们对每个
            <math>
                <mi>have_epsilon</mi>
                <mo>(</mo>
                <msub>
                    <mi>β</mi>
                    <mi>j</mi>
                </msub>
                <mo>)</mo>
            </math>的返回值做判断<em>(在递归调用之后,也就是得到<math>
                    <mi>have_epsilon</mi>
                    <mo>(</mo>
                    <msub>
                        <mi>β</mi>
                        <mi>j</mi>
                    </msub>
                    <mo>)</mo>
                </math>的返回值之后,我们要移除①处做的标记)</em>
            <ul>
                <li>如果
                    <math>
                        <mi>have_epsilon</mi>
                        <mo>(</mo>
                        <msub>
                            <mi>β</mi>
                            <mi>j</mi>
                        </msub>
                        <mo>)</mo>
                        <mo>==</mo>
                        <mn>true</mn>
                    </math>
                    ,则又进行如下检查
                    <ul>
                        <li>i等于n(也就是最后一个符号还是ε),返回true</li>
                        <li>i不等于n(没有到最后一个符号),不做任何动作,进行下一个符号的处理(此时已经在内层循环中了,还在处理 <math>
                                <mi>have_epsilon</mi>
                                <mo>(</mo>
                                <msub>
                                    <mi>β</mi>
                                    <mi>j</mi>
                                </msub>
                                <mo>)</mo>
                            </math>呢)</li>
                    </ul>
                </li>
            </ul>
        </li>
        <li>如果处理到i=n还没有得到true,则直接返回false</li>
    </ol>
    <p>有了have_epsilon,我们就可以对first流程做一些轻微的改动,使他能完全处理有递归的文法,改进后的first计算流程如下:</p>
    <ol>
        <li>如果<math>
                <msub>
                    <mi>X</mi>
                    <mi>i</mi>
                </msub>
            </math>是一个非ε终结符,则将<math>
                <msub>
                    <mi>X</mi>
                    <mi>i</mi>
                </msub>
            </math>添加到ret,并终止计算</li>
        <li>如果<math>
                <msub>
                    <mi>X</mi>
                    <mi>i</mi>
                </msub>
            </math>是ε,进行如下检查
            <ul>
                <li>i等于n(也就是最后一个符号还是ε),将ε添加到ret</li>
                <li>i不等于n(还没到最后一个符号),不做任何动作</li>
            </ul>
        </li>
        <li>如果<math>
                <msub>
                    <mi>X</mi>
                    <mi>i</mi>
                </msub>
            </math>是一个终结符,则对所有以<math>
                <msub>
                    <mi>X</mi>
                    <mi>i</mi>
                </msub>
            </math>开头的产生式<math>
                <msub>
                    <mi>X</mi>
                    <mi>i</mi>
                </msub>
                <mo>→</mo>
                <msub>
                    <mi>β</mi>
                    <mi>1</mi>
                </msub>
            </math>一直到<math>
                <msub>
                    <mi>X</mi>
                    <mi>i</mi>
                </msub>
                <mo>→</mo>
                <msub>
                    <mi>β</mi>
                    <mi>h</mi>
                </msub>
            </math><em>(如果<math>
                    <msub>
                        <mi>β</mi>
                        <mi>j</mi>
                    </msub>
                </math>对应的产生式已经被展开过,则我们应该跳过<math>
                    <msub>
                        <mi>β</mi>
                        <mi>j</mi>
                    </msub>
                </math>,否则我们要标记<math>
                    <msub>
                        <mi>β</mi>
                        <mi>j</mi>
                    </msub>
                </math>对应的产生式被展开①<span class="stress"> 特别提醒:这里的标记和have_epsilon是两个不同的标记</span>)</em>,先计算<math>
                <mi>have_epsilon</mi>
                <mo>(</mo>
                <msub>
                    <mi>β</mi>
                    <mi>j</mi>
                </msub>
                <mo>)</mo>
            </math>,然后计算
            <math>
                <mi>first</mi>
                <mo>(</mo>
                <msub>
                    <mi>β</mi>
                    <mi>j</mi>
                </msub>
                <mo>)</mo>
            </math>,我们把所有的计算结果移除掉ε后合并到ret中,<em>(在递归调用之后,也就是得到<math>
                    <mi>first</mi>
                    <mo>(</mo>
                    <msub>
                        <mi>β</mi>
                        <mi>j</mi>
                    </msub>
                    <mo>)</mo>
                </math>的返回值之后,我们要移除①处做的标记)</em>,然后检查<math>
                <mi>have_epsilon</mi>
                <mo>(</mo>
                <msub>
                    <mi>β</mi>
                    <mi>j</mi>
                </msub>
                <mo>)</mo>
            </math>的计算结果
            <ul>
                <li>如果结果为false,则终止计算</li>
                <li>如果结果为true,则进行如下检查
                    <ul>
                        <li>i等于n(也就是最后一个符号还包含ε),把ε添加到ret中</li>
                        <li>i不等于n(还没到最后一个符号),不做任何动作,进行下一个符号的处理(此时已经在内层循环中了,还在处理 <math>
                                <mi>have_epsilon</mi>
                                <mo>(</mo>
                                <msub>
                                    <mi>β</mi>
                                    <mi>j</mi>
                                </msub>
                                <mo>)</mo>
                            </math>呢)</li>
                </li>
            </ul>
        </li>
        </ul>
        </li>
    </ol>
    <p>至此,first集的计算方法已经完整了</p>
    <h2>follow集</h2>
    <p>相对于first集,follow集是指一个<em>非终结符</em>的后继符号,比如下面的文法:</p>
    <ol>
        <li><math>
                <mi>S</mi>
                <mo>→</mo>
                <mi>A</mi>
                <mi>B</mi>
            </math></li>
        <li><math>
                <mi>A</mi>
                <mo>→</mo>
                <mi>S</mi>
                <mi>a</mi>
            </math></li>
        <li><math>
                <mi>A</mi>
                <mo>→</mo>
                <mi>ε</mi>
            </math></li>
        <li><math>
                <mi>B</mi>
                <mo>→</mo>
                <mi>S</mi>
                <mi>b</mi>
            </math></li>
    </ol>
    <p>我们可以计算follow(S),follow(A),follow(B),但是如果计算follow(a)或者follow(ε)是没什么意义的。对于follow集,我们可以应用下面的程序进行计算</p>
    <ol>
        <li>follow(S)={$},这里的S指整个文法的起始符号,$是一个特殊定义的终结符,表示输入源码的结束标志,这里应该很好理解,整个文法已经解析完成,此时应该接受一个结束标记</li>
        <li>如果存在一个产生式A→αBβ,那么FIRST(β)中除ε之外的所有符号都在follow(B)中。也就是我们扫描所有的产生式,如果非终结符B不在产生式的末尾,我们就从B后面截断这个产生式,然后计算裁剪出来符号串的first集并移除ε后添加到follow集。接下来我们检查这个first是否包含了ε
            <ul>
                <li>如果包含ε,则计算follow(A),并且将follow(A)的结果添加到follow(B)中</li>
            </ul>
        </li>
        <li>如果存在一个产生式A→αB,那么follow(A)中的所有符号都在follow(B)中</li>
    </ol>
    <em>如果出现右递归,即<math>
            <mi>A</mi>
            <mo>→</mo>
            <mi>α</mi>
            <mi>A</mi>
        </math>(或者间接右递归),我们采用和计算first集类似的策略,直接避免这个产生式的展开即可</em>
    <P>如果我们仔细观察上述规则2的ε检查和规则3,可以发现他们说的是同一件事情<em>first()={ε} (这里计算的是一个空串first集)</em></P>
    <h2>左递归</h2>
    <p>如果一个文法中有产生式如同
        <math>
            <mi>A</mi>
            <mover>
                <mo>→</mo>
                <mo>+</mo>
            </mover>
            <mi>A</mi>
            <mi>α</mi>
        </math>,则我们称这个文法是左递归的(这个+号表示直接推导或者间接推导),LL(K)文法分析器无法处理左递归文法,所以我们需要消除左递归。
    </p>
    <h3>左递归的消除</h3>
    <p>假设我们有如下产生式导致了左递归(<em>需要注意的是,一个有意义的文法,如果某个非终结符出现了左递归,则这个非终结符一定至少有一条产生式的最左边是非左递归的,否则一个悬空的形如 <math>
                <mi>A</mi>
                <mo>→</mo>
                <mi>A</mi>
                <mi>α</mi>
            </math>的产生式会导致无限展开,永远无法结束,这就是我总结的直接推导定理的依据,也就是这个递归产生式的头部一定是由其他产生式规约而成,不允许自身规约。右递归同理</em>)</p>
    <ol>
        <li>
            <math>
                <mi>A</mi>
                <mo>→</mo>
                <mi>A</mi>
                <mi>α</mi>
            </math>
        </li>
        <li>
            <math>
                <mi>A</mi>
                <mo>→</mo>
                <mi>A</mi>
                <mi>β</mi>
            </math>
        </li>
        <li>
            <math>
                <mi>A</mi>
                <mo>→</mo>
                <mi>γ</mi>
            </math>
        </li>
        <li>
            <math>
                <mi>A</mi>
                <mo>→</mo>
                <mi>θ</mi>
            </math>
        </li>
    </ol>
    <p>基于上面理论,我们进行如下改造:</p>
    <ol>
        <li>
            <math>
                <mi>A</mi>
                <mo>→</mo>
                <mi>γ</mi>
                <mi>A'</mi>
            </math>
        </li>
        <li>
            <math>
                <mi>A</mi>
                <mo>→</mo>
                <mi>θ</mi>
                <mi>A'</mi>
            </math>
        </li>
        <li>
            <math>
                <mi>A'</mi>
                <mo>→</mo>
                <mi>α</mi>
                <mi>A'</mi>
            </math>
        </li>
        <li>
            <math>
                <mi>A'</mi>
                <mo>→</mo>
                <mi>β</mi>
                <mi>A'</mi>
            </math>
        </li>
        <li>
            <math>
                <mi>A'</mi>
                <mo>→</mo>
                <mi>ε</mi>
            </math>
        </li>
    </ol>
    <p>改造之后的文法和之前的文法表达能力相同,并且我们把左递归变成了右递归。</p>
    <h2>二义性</h2>
    <p>如果一个输入串可以根据我们的文法生成两颗不同的语法树,就说明这个文法是二义性的。所以我们在设计文法的时候就应该避免二义性。下面举些例子说明一下二义性文法</p>
    <ol>
        <li>
            <math>
                <mi>E</mi>
                <mo>→</mo>
                <mi>E</mi>
                <mo>+</mo>
                <mi>E</mi>
            </math>
        </li>
        <li>
            <math>
                <mi>E</mi>
                <mo>→</mo>
                <mo>id</mo>
            </math>
            <em>这里的id表示一个终结符,类比于java中的一个变量</em>
        </li>
    </ol>
    <p>那么对于输入a+b+c,可以得到两颗不同的语法树</p>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 210.75 100.07" style="height: 300px;"><text
            transform="translate(23.02 90.63)"
            style="font-size:12px;fill:#231815;font-family:AdobeSongStd-Light-GBpc-EUC-H, Adobe Song Std">a</text><text
            transform="translate(131.62 68.67)"
            style="font-size:12px;fill:#231815;font-family:AdobeSongStd-Light-GBpc-EUC-H, Adobe Song Std">a</text><text
            transform="translate(63.13 90.63)"
            style="font-size:12px;fill:#231815;font-family:AdobeSongStd-Light-GBpc-EUC-H, Adobe Song Std">b</text><text
            transform="translate(162.53 93.03)"
            style="font-size:12px;fill:#231815;font-family:AdobeSongStd-Light-GBpc-EUC-H, Adobe Song Std">b</text><text
            transform="translate(22.53 70.03)"
            style="font-size:12px;fill:#231815;font-family:AdobeSongStd-Light-GBpc-EUC-H, Adobe Song Std">E</text><text
            transform="translate(42.65 47.5)"
            style="font-size:12px;fill:#231815;font-family:AdobeSongStd-Light-GBpc-EUC-H, Adobe Song Std">E</text><text
            transform="translate(66.52 20.06)"
            style="font-size:12px;fill:#231815;font-family:AdobeSongStd-Light-GBpc-EUC-H, Adobe Song Std">E</text><text
            transform="translate(87.83 47.5)"
            style="font-size:12px;fill:#231815;font-family:AdobeSongStd-Light-GBpc-EUC-H, Adobe Song Std">E</text><text
            transform="translate(174.39 49.01)"
            style="font-size:12px;fill:#231815;font-family:AdobeSongStd-Light-GBpc-EUC-H, Adobe Song Std">E</text><text
            transform="translate(62.77 70.03)"
            style="font-size:12px;fill:#231815;font-family:AdobeSongStd-Light-GBpc-EUC-H, Adobe Song Std">E</text><text
            transform="translate(89.46 70.03)"
            style="font-size:12px;fill:#231815;font-family:AdobeSongStd-Light-GBpc-EUC-H, Adobe Song Std">c</text><text
            transform="translate(186.19 92.14)"
            style="font-size:12px;fill:#231815;font-family:AdobeSongStd-Light-GBpc-EUC-H, Adobe Song Std">c</text>
        <line x1="25.52" y1="73.07" x2="25.52" y2="80.07"
            style="fill:none;stroke:#231815;stroke-miterlimit:10;stroke-width:0.25px" />
        <line x1="46.07" y1="52.2" x2="46.07" y2="59.2"
            style="fill:none;stroke:#231815;stroke-miterlimit:10;stroke-width:0.25px" />
        <line x1="66.14" y1="73.07" x2="66.14" y2="80.07"
            style="fill:none;stroke:#231815;stroke-miterlimit:10;stroke-width:0.25px" /><text
            transform="translate(131.24 50.7)"
            style="font-size:12px;fill:#231815;font-family:AdobeSongStd-Light-GBpc-EUC-H, Adobe Song Std">E</text>
        <line x1="134.62" y1="53.74" x2="134.62" y2="60.74"
            style="fill:none;stroke:#231815;stroke-miterlimit:10;stroke-width:0.25px" /><text
            transform="translate(160.84 69.45)"
            style="font-size:12px;fill:#231815;font-family:AdobeSongStd-Light-GBpc-EUC-H, Adobe Song Std">E</text>
        <line x1="164.22" y1="72.5" x2="164.22" y2="79.5"
            style="fill:none;stroke:#231815;stroke-miterlimit:10;stroke-width:0.25px" /><text
            transform="translate(185.69 70.05)"
            style="font-size:12px;fill:#231815;font-family:AdobeSongStd-Light-GBpc-EUC-H, Adobe Song Std">E</text>
        <line x1="189.07" y1="73.1" x2="189.07" y2="80.1"
            style="fill:none;stroke:#231815;stroke-miterlimit:10;stroke-width:0.25px" /><text
            transform="translate(42.4 68.64)"
            style="font-size:12px;fill:#231815;font-family:AdobeSongStd-Light-GBpc-EUC-H, Adobe Song Std">+</text><text
            transform="translate(66.9 45.86)"
            style="font-size:12px;fill:#231815;font-family:AdobeSongStd-Light-GBpc-EUC-H, Adobe Song Std">+</text><text
            transform="translate(150.7 49.9)"
            style="font-size:12px;fill:#231815;font-family:AdobeSongStd-Light-GBpc-EUC-H, Adobe Song Std">+</text><text
            transform="translate(173.71 68.67)"
            style="font-size:12px;fill:#231815;font-family:AdobeSongStd-Light-GBpc-EUC-H, Adobe Song Std">+</text>
        <line x1="35.75" y1="51" x2="29.84" y2="58"
            style="fill:none;stroke:#231815;stroke-miterlimit:10;stroke-width:0.25px" />
        <line x1="53.92" y1="27.14" x2="48" y2="34.09"
            style="fill:none;stroke:#231815;stroke-miterlimit:10;stroke-width:0.25px" />
        <line x1="70.2" y1="25.63" x2="70.4" y2="34.76"
            style="fill:none;stroke:#231815;stroke-miterlimit:10;stroke-width:0.25px" />
        <line x1="91.66" y1="49.94" x2="91.86" y2="59.06"
            style="fill:none;stroke:#231815;stroke-miterlimit:10;stroke-width:0.25px" />
        <line x1="52.61" y1="50.9" x2="60.47" y2="57.9"
            style="fill:none;stroke:#231815;stroke-miterlimit:10;stroke-width:0.25px" />
        <line x1="177.46" y1="51.57" x2="177.46" y2="58.57"
            style="fill:none;stroke:#231815;stroke-miterlimit:10;stroke-width:0.25px" />
        <line x1="167.14" y1="50.37" x2="161.23" y2="57.37"
            style="fill:none;stroke:#231815;stroke-miterlimit:10;stroke-width:0.25px" />
        <line x1="184" y1="50.27" x2="191.86" y2="57.27"
            style="fill:none;stroke:#231815;stroke-miterlimit:10;stroke-width:0.25px" />
        <line x1="83.9" y1="27.55" x2="91.76" y2="36.28"
            style="fill:none;stroke:#231815;stroke-miterlimit:10;stroke-width:0.25px" /><text
            transform="translate(153.93 21.41)"
            style="font-size:12px;fill:#231815;font-family:AdobeSongStd-Light-GBpc-EUC-H, Adobe Song Std">E</text>
        <line x1="141.32" y1="28.5" x2="135.41" y2="35.44"
            style="fill:none;stroke:#231815;stroke-miterlimit:10;stroke-width:0.25px" />
        <line x1="157.61" y1="26.99" x2="157.81" y2="36.11"
            style="fill:none;stroke:#231815;stroke-miterlimit:10;stroke-width:0.25px" />
        <line x1="171.31" y1="28.91" x2="179.16" y2="37.64"
            style="fill:none;stroke:#231815;stroke-miterlimit:10;stroke-width:0.25px" />
        <rect x="0.25" y="0.25" width="99.57" height="99.57"
            style="fill:none;stroke:#231815;stroke-miterlimit:10;stroke-width:0.5px" />
        <rect x="118.46" y="0.25" width="92.03" height="99.57"
            style="fill:none;stroke:#231815;stroke-miterlimit:10;stroke-width:0.5px" /><text
            transform="translate(3.67 13.9)"
            style="font-size:12px;fill:#231815;font-family:AdobeSongStd-Light-GBpc-EUC-H, Adobe Song Std">语法树1</text><text
            transform="translate(167.28 12.55)"
            style="font-size:12px;fill:#231815;font-family:AdobeSongStd-Light-GBpc-EUC-H, Adobe Song Std">语法树2</text>
    </svg>
    <p>或者对于下面这种文法,有个经典的if-else二义性</p>
    <ol>
        <li>
            <math>
                <mi>stmt</mi>
                <mo>→</mo>
                <mi>if</mi>
                <mo>(</mo>
                <mi>exp</mi>
                <mo>)</mo>
                <mi>stmt</mi>
            </math>
        </li>
        <li>
            <math>
                <mi>stmt</mi>
                <mo>→</mo>
                <mi>if</mi>
                <mo>(</mo>
                <mi>exp</mi>
                <mo>)</mo>
                <mi>stmt</mi>
                <mo>else</mo>
                <mi>stmt</mi>
            </math>
        </li>
    </ol>
    <p>这种文法对于输入:</p>
    <div>if (E1)</div>
    <div>&nbsp;&nbsp;if (E2)</div>
    <div>&nbsp;&nbsp;&nbsp;&nbsp;stmt1</div>
    <div>&nbsp;&nbsp;<em>else</em></div>
    <div>&nbsp;&nbsp;&nbsp;&nbsp;<em>stmt2</em></div>
    <p>对于上述输入的else应该和E1的if语句匹配还是和E2的语句匹配都符合我们的文法,主流的编程语言都会让else和最近的if语句匹配,所以上述文法很明显做不到这一点。所以我们设计文法的时候就不能设计出上面这种二义性文法(或者我们在分析的时候做一些特殊处理,比如yacc遇到shift-reduce
        conflict的时候默认选择shift动作,刚好解决了if-else二义性问题)。</p>
    <h2>LL(k)文法分析器</h2>
    <p>LL是left to right,leftmost derivation的缩写,表示我们从左往右读取源代码,自顶向下构造AST,括号中的K指的是我们需要从源码中提前读取K个符号就能进行文法分析工作</p>
    <h3>LL(1)</h3>
    <p>
        目前很多编程语言是作者手写递归下降文法解析器,比如GCC、Go(GCC开始是用bison生成的LALR自顶向上分析器,后来改手写了<em>忘了OpenJDK是不是了)</em>。有的前端用的是LR(k)自底向上分析器,比如MySQL的SQL解析器、Linux的Bash
        shell就是用bison生成的LALR分析器--
        <q cite="https://en.wikipedia.org/wiki/GNU_Bison#Use"><a href="https://en.wikipedia.org/wiki/GNU_Bison#Use">GNU
                Bison</a></q>
        ,其实从GCC和Go改用手写文法解析器可以看出,做一个编译器前端并不是那么难。我个人认为他们改成手写解析器的一个原因是因为Bison不太方便扩展,如果要加一些定制功能,可能用bison更不容易开发,比如一些错误代码的提示和兼容,尤其是MySQL,如果一段很长的SQL报错,错误提示真的让人头大。而且为什么手写文法解析器都采用LL分析模式,而不用LR分析模式,我觉得是因为LR的分析模式状态数量太多了,人脑可能无法处理这么多状态。接下来就说明一下LL(1)文法分析器的工作流程。
    </p>
    <p>首先给定一个文法G,然后我们根据这个文法生成一个预测分析表,能正确生成这个分表的文法我们就称之为LL(1)文法。假设我们有一个文法G如下:</p>
    <ol>
        <li>
            <math>
                <mi>E</mi>
                <mo>→</mo>
                <mi>E</mi>
                <mo>+</mo>
                <mi>E</mi>
            </math>
        </li>
        <li>
            <math>
                <mi>E</mi>
                <mo>→</mo>
                <mo>(</mo>
                <mi>E</mi>
                <mo>)</mo>
            </math>
            <em>这里的n表示一个数字</em>
        </li>
        <li>
            <math>
                <mi>E</mi>
                <mo>→</mo>
                <mi>n</mi>
            </math>
        </li>
    </ol>
    <p>我们把上述文法稍做改造,改成这样(<em>LL(1)分析器不能处理左递归文法,我们通过改造消除了左递归,但是仍然没有消除二义性,但是并不影响我们的课程,后面我会对这个文法改造一下,变成无二义性的文法)</em>):</p>
    <ol>
        <li>
            <math>
                <mi>E</mi>
                <mo>→</mo>
                <mo>(</mo>
                <mi>E</mi>
                <mo>)</mo>
                <mi>E'</mi>
            </math>
        </li>
        <li>
            <math>
                <mi>E</mi>
                <mo>→</mo>
                <mo>n</mo>
                <mi>E'</mi>
            </math>
        </li>
        <li>
            <math>
                <mi>E'</mi>
                <mo>→</mo>
                <mo>+</mo>
                <mi>E</mi>
                <mo>E'</mo>
            </math>
        </li>
        <li>
            <math>
                <mi>E'</mi>
                <mo>→</mo>
                <mi>ε</mi>
            </math>
        </li>
    </ol>
    <p>然后我们用如下规则对文法G构造一个预测分析表:</p>
    <div>
        <span>我们对文法G中的每个产生式<math>
                <mi>A</mi>
                <mo>→</mo>
                <mi>α</mi>
            </math>进行如下处理</span>
        <ol>
            <li>对于first(α)中的每个终结符号a,将<math>
                    <mi>A</mi>
                    <mo>→</mo>
                    <mi>α</mi>
                </math>加入到<math>
                    <mi>M</mi>
                    <mo>[</mo>
                    <mi>A</mi>
                    <mo>,</mo>
                    <mi>a</mi>
                    <mo>]</mo>
                </math>中</li>
            <li>如果first(α)含有符号ε,则对follow(A)中的每个符号b,将<math>
                    <mi>A</mi>
                    <mo>→</mo>
                    <mi>α</mi>
                </math>加入到<math>
                    <mi>M</mi>
                    <mo>[</mo>
                    <mi>A</mi>
                    <mo>,</mo>
                    <mi>b</mi>
                    <mo>]</mo>
                </math>中</li>
        </ol>
    </div>
    <p>我们从头来一遍,生成一个预测分析表</p>
    <ol>
        <li>
            <span>first集</span>
            <table>
                <tbody>
                    <tr>
                        <td>first(E)</td>
                        <td>(</td>
                        <td>n</td>
                    </tr>
                    <tr>
                        <td>first(E')</td>
                        <td>+</td>
                        <td>ε</td>
                    </tr>
                </tbody>
            </table>
        </li>
        <li>
            <span>follow集,因为产生式3对E'有右递归,所以在计算follow(E')的时候被忽略,然后E'仅仅出现在产生式1、2的末尾,所以follow(E')=follow(E)</span>
            <table>
                <tbody>
                    <tr>
                        <td>follow(E)</td>
                        <td>+</td>
                        <td>)</td>
                        <td>$</td>
                    </tr>
                    <tr>
                        <td>follow(E')</td>
                        <td>+</td>
                        <td>)</td>
                        <td>$</td>
                    </tr>
                </tbody>
            </table>
        </li>
        <li>
            分析表:
            <table>
                <thead>
                    <tr>
                        <td rowspan="2">非终结符</td>
                        <td colspan="5">输入符号</td>
                    </tr>
                    <tr>
                        <td>(</td>
                        <td>)</td>
                        <td>n</td>
                        <td>+</td>
                        <td>$</td>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>E</td>
                        <td>E → ( E ) E'</td>
                        <td></td>
                        <td>E → n E'</td>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>E'</td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td>E' → + E E'<br />E' → ε<br />(根据规则first(α)含有符号ε,则添加follow(A))</td>
                        <td>E' → ε<br />(根据规则first(α)含有符号ε,则添加follow(A))</td>
                    </tr>
                </tbody>
            </table>
        </li>
        <li>
            预测分析表中的每一行的每个格子表示假设遇到这一列对应的终结符输入时,应该选择哪个产生式进行展开,空白表示语法错误,无法展开。而一个格子有多条产生式时,表示这个文法有二义性,不是一个合法的LL(1)文法。<em>上面这个文法因为前面说的二义性,有个格子包含了两条产生式</em><br />
            接下来我们就可以用这个分析表做编译器的parser了(需要注意的是我们说过了LL(1)不能处理二义性文法,这个文法目前仍然是有二义性的),预测分析表用法如下:
        </li>
    </ol>
    <h3>LL(1)分析器工作流程</h3>
    <p>有了预测分析表之后,就可以使用这个预测分析表驱动LL(1)分析器对源码进行解析。预测分析表的作用是:如果当前希望把源码输入的部分串规约成一个AST子树(每个AST子树都对应了一个非终结符),则这个非终结符面对不同的源码输入时,应该如何选择对应的产生式进行展开(replace)。我们使用符号栈表示<em>期待的符号</em>,每次解析初始化的时候,格局(中文龙书把configuration翻译成格局)如下:
    </p>
    <div style="display: flex;">
        <table>
            <thead>
                <tr>
                    <th colspan="3">栈</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>$</td>
                    <td>S</td>
                    <td></td>
                </tr>
            </tbody>
        </table>
        <div style="width: 1rem;"></div>
        <table>
            <thead>
                <tr>
                    <th colspan="6">输入</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>1</td>
                    <td>+</td>
                    <td>2</td>
                    <td>+</td>
                    <td>3</td>
                    <td>$</td>
                </tr>
            </tbody>
        </table>
    </div>
    <p>S表示每个文法的起始符号,$表示源码结束标识,然后按照如下流程处理源码</p>
    <ol>
        <li>
            <span id="ll1_1">从栈中弹出一个符号A(如果栈为空,则表示整个源码已经解析完毕),然后从输入中读取一个符号b</span>
            <ol type="a" style="color: inherit;">
                <li>
                    <span id="ll1_1_a_1">如果A是一个非终结符,则读取预测表中的<math>
                            <mi>M</mi>
                            <mo>[</mo>
                            <mi>A</mi>
                            <mo>,</mo>
                            <mi>b</mi>
                            <mo>]</mo>
                            <mo>=</mo>
                            <mi>A</mi>
                            <mo>→</mo>
                            <msub>
                                <mi>X</mi>
                                <mn>1</mn>
                            </msub>
                            <msub>
                                <mi>X</mi>
                                <mn>2</mn>
                            </msub>
                            <msub>
                                <mi>X</mi>
                                <mn>3</mn>
                            </msub>
                        </math>,然后把<math>
                            <msub>
                                <mi>X</mi>
                                <mn>3</mn>
                            </msub>
                            <msub>
                                <mi>X</mi>
                                <mn>2</mn>
                            </msub>
                            <msub>
                                <mi>X</mi>
                                <mn>1</mn>
                            </msub>
                        </math>(注意这里是逆序)压栈,</span><span id="ll1_1_a_2">并且回退输入符号b</span>。如果<math>
                        <mi>M</mi>
                        <mo>[</mo>
                        <mi>A</mi>
                        <mo>,</mo>
                        <mi>b</mi>
                        <mo>]</mo>
                    </math>是一个空白单元格,则语法错误
                </li>
                <li id="ll1_1_b">如果A是一个终结符,如果A=b,则回到步骤1,否则报语法错误</li>
            </ol>
        </li>
    </ol>
    <p>我们在执行上述循环的时候,已经在构建AST了,<em>从栈中弹出符号时,表示我们正在以这个符号作为root构造子树,条件a的压栈操作则表示我们已经用这个产生式构造出了root的所有下一层子节点</em></p>
    <p>前面说过这个文法有二义性,不能正确生成预测分析表,所以我重新设计了一个文法,并用这个文法演示AST的生成,可以在下面观看动画</p>
    <div style="display: flex;">
        <div>
            <ol>
                <li>文法:
                    <ol>
                        <li>
                            <math>
                                <mn>E</mn>
                                <mo>→</mo>
                                <mn>E</mn>
                                <mo>+</mo>
                                <mn>T</mn>
                            </math>
                        </li>
                        <li>
                            <math>
                                <mn>E</mn>
                                <mo>→</mo>
                                <mn>T</mn>
                            </math>
                        </li>
                        <li>
                            <math>
                                <mn>T</mn>
                                <mo>→</mo>
                                <mn>id</mn>
                            </math>
                        </li>
                    </ol>
                </li>
                <li>
                    消除左递归:
                    <ol>
                        <li>
                            <math>
                                <mn>E</mn>
                                <mo>→</mo>
                                <mo>T</mo>
                                <mn>E'</mn>
                            </math>
                        </li>
                        <li>
                            <math>
                                <mn>E'</mn>
                                <mo>→</mo>
                                <mo>+</mo>
                                <mo>T</mo>
                                <mo>E'</mo>
                            </math>
                        </li>
                        <li>
                            <math>
                                <mn>E'</mn>
                                <mo>→</mo>
                                <mo>ε</mo>
                            </math>
                        </li>
                        <li>
                            <math>
                                <mn>T</mn>
                                <mo>→</mo>
                                <mo>id</mo>
                            </math>
                        </li>
                    </ol>
                </li>
                <li>
                    <ol>
                        <li>first集:
                            <table>
                                <tbody>
                                    <tr>
                                        <td>first(E)</td>
                                        <td colspan="2">id</td>
                                    </tr>
                                    <tr>
                                        <td>first(E')</td>
                                        <td>+</td>
                                        <td>ε</td>
                                    </tr>
                                    <tr>
                                        <td>first(T)</td>
                                        <td colspan="2">id</td>
                                    </tr>
                                </tbody>
                            </table>
                        </li>
                        <li>follow集:
                            <table>
                                <tbody>
                                    <tr>
                                        <td>follow(E)</td>
                                        <td>$</td>
                                    </tr>
                                    <tr>
                                        <td>follow(E')</td>
                                        <td>$</td>
                                    </tr>
                                    <tr>
                                        <td>follow(T)</td>
                                        <td>$</td>
                                    </tr>
                                </tbody>
                            </table>
                        </li>
                    </ol>
                </li>
                <li>
                    预测分析表:
                    <table>
                        <tbody id="ll1_table">
                            <tr>
                                <td rowspan="2">非终结符</td>
                                <td colspan="3">输入符号</td>
                            </tr>
                            <tr>
                                <td>id</td>
                                <td>+</td>
                                <td>$</td>
                            </tr>
                            <tr>
                                <td>E</td>
                                <td>
                                    <math>
                                        <mn>E</mn>
                                        <mo>→</mo>
                                        <mo>T</mo>
                                        <mn>E'</mn>
                                    </math>
                                </td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>E'</td>
                                <td></td>
                                <td>
                                    <math>
                                        <mn>E'</mn>
                                        <mo>→</mo>
                                        <mo>+</mo>
                                        <mo>T</mo>
                                        <mo>E'</mo>
                                    </math>
                                </td>
                                <td>
                                    <math>
                                        <mn>E'</mn>
                                        <mo>→</mo>
                                        <mo>ε</mo>
                                    </math>
                                </td>
                            </tr>
                            <tr>
                                <td>T</td>
                                <td>
                                    <math>
                                        <mn>T</mn>
                                        <mo>→</mo>
                                        <mo>id</mo>
                                    </math>
                                </td>
                                <td></td>
                                <td></td>
                            </tr>
                        </tbody>
                    </table>
                </li>
            </ol>
        </div>
        <div>
            <span>动画演示:</span><button id="ll1_next">下一步</button>
            <ol>
                <li>格局(假设1+2+3已经被词法分析器解析成id(1)+id(2)+id(3)):
                    <ul>
                        <li>输入:
                            <span id="ll1_input">
                                <span>id(1)</span>
                                <span>+</span>
                                <span>id(2)</span>
                                <span>+</span>
                                <span>id(3)</span>
                                <span>$</span>
                            </span>
                        </li>
                        <li>栈:<span id="ll1_stack">
                                <span>$</span>
                                <span>E</span>
                            </span></li>
                        <li>
                            <span>A:</span><span id="ll1_A" style="color: red;"></span>
                        </li>
                        <li>
                            <span>b:</span><span id="ll1_b" style="color: red;"></span>
                        </li>
                    </ul>
                </li>
                <li>
                    <span>AST:</span>
                    <div style="width: 450pt;">
                        <svg id="ll1_svg" style="visibility:hidden;" xmlns="http://www.w3.org/2000/svg"
                            viewBox="0 0 250 205">
                            <g id="id2" style="display:none;">
                                <text transform="translate(94.25 151.26)" style="font-family: DengXian, DengXian;">
                                    <tspan x="0" y="0" style="fill: #000; font-size: 12px;">id</tspan>
                                    <tspan x="9.57" y="0" style="fill: red; font-size: 6px;">(2)</tspan>
                                </text>
                                <path
                                    d="M102.5,136c6.34,0,11.5,5.16,11.5,11.5s-5.16,11.5-11.5,11.5-11.5-5.16-11.5-11.5,5.16-11.5,11.5-11.5M102.5,135c-6.9,0-12.5,5.6-12.5,12.5s5.6,12.5,12.5,12.5,12.5-5.6,12.5-12.5-5.6-12.5-12.5-12.5h0Z"
                                    style="fill: #000; stroke-width: 0px;" />
                            </g>
                            <g id="id3" style="display: none;">
                                <text transform="translate(184.25 196.26)" style="font-family: DengXian, DengXian;">
                                    <tspan x="0" y="0" style="fill: #000; font-size: 12px;">id</tspan>
                                    <tspan x="9.57" y="0" style="fill: red; font-size: 6px;">(3)</tspan>
                                </text>
                                <path
                                    d="M192.5,181c6.34,0,11.5,5.16,11.5,11.5s-5.16,11.5-11.5,11.5-11.5-5.16-11.5-11.5,5.16-11.5,11.5-11.5M192.5,180c-6.9,0-12.5,5.6-12.5,12.5s5.6,12.5,12.5,12.5,12.5-5.6,12.5-12.5-5.6-12.5-12.5-12.5h0Z"
                                    style="fill: #000; stroke-width: 0px;" />
                            </g>
                            <g id="epsilon" style="display: none;">
                                <text transform="translate(234.87 196.26)"
                                    style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                                    <tspan x="0" y="0">ε</tspan>
                                </text>
                                <path
                                    d="M237.5,181c6.34,0,11.5,5.16,11.5,11.5s-5.16,11.5-11.5,11.5-11.5-5.16-11.5-11.5,5.16-11.5,11.5-11.5M237.5,180c-6.9,0-12.5,5.6-12.5,12.5s5.6,12.5,12.5,12.5,12.5-5.6,12.5-12.5-5.6-12.5-12.5-12.5h0Z"
                                    style="fill: #000; stroke-width: 0px;" />
                            </g>
                            <g id="id1" style="display: none;">
                                <text transform="translate(4.25 106.26)" style="font-family: DengXian, DengXian;">
                                    <tspan x="0" y="0" style="fill: #000; font-size: 12px;">id</tspan>
                                    <tspan x="9.57" y="0" style="fill: red; font-size: 6px;">(1)</tspan>
                                </text>
                                <path
                                    d="M12.5,91c6.34,0,11.5,5.16,11.5,11.5s-5.16,11.5-11.5,11.5-11.5-5.16-11.5-11.5,5.16-11.5,11.5-11.5M12.5,90c-6.9,0-12.5,5.6-12.5,12.5s5.6,12.5,12.5,12.5,12.5-5.6,12.5-12.5-5.6-12.5-12.5-12.5h0Z"
                                    style="fill: #000; stroke-width: 0px;" />
                            </g>
                            <g id="E1">
                                <text transform="translate(54.12 16.26)"
                                    style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                                    <tspan x="0" y="0">E</tspan>
                                </text>
                                <path
                                    d="M57.5,1c6.34,0,11.5,5.16,11.5,11.5s-5.16,11.5-11.5,11.5-11.5-5.16-11.5-11.5S51.16,1,57.5,1M57.5,0c-6.9,0-12.5,5.6-12.5,12.5s5.6,12.5,12.5,12.5,12.5-5.6,12.5-12.5S64.4,0,57.5,0h0Z"
                                    style="fill: #000; stroke-width: 0px;" />
                            </g>
                            <g id="add1" style="display: none;">
                                <text transform="translate(53.87 106.26)"
                                    style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                                    <tspan x="0" y="0">+</tspan>
                                </text>
                                <path
                                    d="M57.5,91c6.34,0,11.5,5.16,11.5,11.5s-5.16,11.5-11.5,11.5-11.5-5.16-11.5-11.5,5.16-11.5,11.5-11.5M57.5,90c-6.9,0-12.5,5.6-12.5,12.5s5.6,12.5,12.5,12.5,12.5-5.6,12.5-12.5-5.6-12.5-12.5-12.5h0Z"
                                    style="fill: #000; stroke-width: 0px;" />
                            </g>
                            <g id="T1" style="display: none;">
                                <text transform="translate(9.12 61.26)"
                                    style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                                    <tspan x="0" y="0">T</tspan>
                                </text>
                                <path
                                    d="M12.5,46c6.34,0,11.5,5.16,11.5,11.5s-5.16,11.5-11.5,11.5S1,63.84,1,57.5s5.16-11.5,11.5-11.5M12.5,45c-6.9,0-12.5,5.6-12.5,12.5s5.6,12.5,12.5,12.5,12.5-5.6,12.5-12.5-5.6-12.5-12.5-12.5h0Z"
                                    style="fill: #000; stroke-width: 0px;" />
                            </g>
                            <g id="T2" style="display: none;">
                                <text transform="translate(99.12 106.26)"
                                    style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                                    <tspan x="0" y="0">T</tspan>
                                </text>
                                <path
                                    d="M102.5,91c6.34,0,11.5,5.16,11.5,11.5s-5.16,11.5-11.5,11.5-11.5-5.16-11.5-11.5,5.16-11.5,11.5-11.5M102.5,90c-6.9,0-12.5,5.6-12.5,12.5s5.6,12.5,12.5,12.5,12.5-5.6,12.5-12.5-5.6-12.5-12.5-12.5h0Z"
                                    style="fill: #000; stroke-width: 0px;" />
                            </g>
                            <g id="Ep1" style="display: none;">
                                <text transform="translate(99.12 61.26)"
                                    style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                                    <tspan x="0" y="0">E’</tspan>
                                </text>
                                <path
                                    d="M102.5,46c6.34,0,11.5,5.16,11.5,11.5s-5.16,11.5-11.5,11.5-11.5-5.16-11.5-11.5,5.16-11.5,11.5-11.5M102.5,45c-6.9,0-12.5,5.6-12.5,12.5s5.6,12.5,12.5,12.5,12.5-5.6,12.5-12.5-5.6-12.5-12.5-12.5h0Z"
                                    style="fill: #000; stroke-width: 0px;" />
                            </g>
                            <g id="Ep2" style="display: none;">
                                <text transform="translate(189.12 106.26)"
                                    style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                                    <tspan x="0" y="0">E’</tspan>
                                </text>
                                <path
                                    d="M192.5,91c6.34,0,11.5,5.16,11.5,11.5s-5.16,11.5-11.5,11.5-11.5-5.16-11.5-11.5,5.16-11.5,11.5-11.5M192.5,90c-6.9,0-12.5,5.6-12.5,12.5s5.6,12.5,12.5,12.5,12.5-5.6,12.5-12.5-5.6-12.5-12.5-12.5h0Z"
                                    style="fill: #000; stroke-width: 0px;" />
                            </g>
                            <g id="add2" style="display: none;">
                                <text transform="translate(143.87 151.26)"
                                    style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                                    <tspan x="0" y="0">+</tspan>
                                </text>
                                <path
                                    d="M147.5,136c6.34,0,11.5,5.16,11.5,11.5s-5.16,11.5-11.5,11.5-11.5-5.16-11.5-11.5,5.16-11.5,11.5-11.5M147.5,135c-6.9,0-12.5,5.6-12.5,12.5s5.6,12.5,12.5,12.5,12.5-5.6,12.5-12.5-5.6-12.5-12.5-12.5h0Z"
                                    style="fill: #000; stroke-width: 0px;" />
                            </g>
                            <g id="T3" data-name="T2" style="display: none;">
                                <text transform="translate(189.12 151.26)"
                                    style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                                    <tspan x="0" y="0">T</tspan>
                                </text>
                                <path
                                    d="M192.5,136c6.34,0,11.5,5.16,11.5,11.5s-5.16,11.5-11.5,11.5-11.5-5.16-11.5-11.5,5.16-11.5,11.5-11.5M192.5,135c-6.9,0-12.5,5.6-12.5,12.5s5.6,12.5,12.5,12.5,12.5-5.6,12.5-12.5-5.6-12.5-12.5-12.5h0Z"
                                    style="fill: #000; stroke-width: 0px;" />
                            </g>
                            <g id="Ep3" style="display: none;">
                                <text transform="translate(234.12 151.26)"
                                    style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                                    <tspan x="0" y="0">E’</tspan>
                                </text>
                                <path
                                    d="M237.5,136c6.34,0,11.5,5.16,11.5,11.5s-5.16,11.5-11.5,11.5-11.5-5.16-11.5-11.5,5.16-11.5,11.5-11.5M237.5,135c-6.9,0-12.5,5.6-12.5,12.5s5.6,12.5,12.5,12.5,12.5-5.6,12.5-12.5-5.6-12.5-12.5-12.5h0Z"
                                    style="fill: #000; stroke-width: 0px;" />
                            </g>
                            <line id="l41" x1="192.5" y1="162.5" x2="192.5" y2="177.5"
                                style="fill: none; stroke: #000; stroke-miterlimit: 10;display: none;" />
                            <line id="l31" x1="102.5" y1="117.5" x2="102.5" y2="132.5"
                                style="fill: none; stroke: #000; stroke-miterlimit: 10;display: none;" />
                            <line id="l33" x1="192.5" y1="117.5" x2="192.5" y2="132.5"
                                style="fill: none; stroke: #000; stroke-miterlimit: 10;display: none;" />
                            <line id="l23" x1="102.5" y1="72.5" x2="102.5" y2="87.5"
                                style="fill: none; stroke: #000; stroke-miterlimit: 10;display: none;" />
                            <line id="l42" x1="237.5" y1="162.5" x2="237.5" y2="177.5"
                                style="fill: none; stroke: #000; stroke-miterlimit: 10;display: none;" />
                            <line id="l21" x1="12.5" y1="72.5" x2="12.5" y2="87.5"
                                style="fill: none; stroke: #000; stroke-miterlimit: 10;display: none;" />
                            <line id="l32" x1="186.25" y1="117.5" x2="147.5" y2="132.5"
                                style="fill: none; stroke: #000; stroke-miterlimit: 10;display: none;" />
                            <line id="l34" x1="198.75" y1="117.5" x2="237.5" y2="132.2"
                                style="fill: none; stroke: #000; stroke-miterlimit: 10;display: none;" />
                            <line id="l22" x1="57.5" y1="87.5" x2="96.25" y2="72.5"
                                style="fill: none; stroke: #000; stroke-miterlimit: 10;display: none;" />
                            <line id="l24" x1="108.75" y1="72.5" x2="192.5" y2="87.5"
                                style="fill: none; stroke: #000; stroke-miterlimit: 10;display: none;" />
                            <line id="l11" x1="51.25" y1="27.5" x2="12.5" y2="42.5"
                                style="fill: none; stroke: #000; stroke-miterlimit: 10;display: none;" />
                            <line id="l12" x1="63.75" y1="27.5" x2="102.5" y2="42.5"
                                style="fill: none; stroke: #000; stroke-miterlimit: 10;display: none;" />
                        </svg>
                    </div>
            </ol>
        </div>
    </div>
    <p>通过上面演示,可以发现LL分析器总是自顶向下构造AST(left to right,leftmost derivation)。</p>
    <h2>LR分析器</h2>
    <p>有了LL分析技术还不够,LL分析一个很明显的问题就是不能处理左递归文法,这使得我们设计一门编程语言时必须很小心的设计其文法,下面就介绍一种自底向上的文法分析技术。和LL概念类似,LR技术中的R表示rightmost
        derivation。</p>
    <p>为了能说明情况,我们先从LR(0)分析技术说起,假设我们有如下文法:</p>
    <table>
        <thead>
            <tr>
                <th colspan="2">文法-LR章节1</th>
            </tr>
            <tr>
                <th>产生式</th>
                <th>作用</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><math>
                        <mi>E</mi>
                        <mo>→</mo>
                        <mi>E</mi>
                        <mo>+</mo>
                        <mi>E</mi>
                    </math></td>
                <td>表达式+表达式还是一个表达式</td>
            </tr>
            <tr>
                <td><math>
                        <mi>E</mi>
                        <mo>→</mo>
                        <mi>id</mi>
                    </math></td>
                <td>单个数字或者变量也是一个表达式</td>
            </tr>
        </tbody>
    </table>
    <p>为了能顺利使用LR技术分析上述文法,我们对文法-LR章节1做一个扩展,生成其<em>增广文法</em>,规则很简单:如果文法G是以S作为开始符号的文法,那么我们就在G中增加一个产生式<math>
            <mi>S'</mi>
            <mo>→</mo>
            <mi>S</mi>
        </math>(千万不要固执的认为符号名一定是S'和S,只要你记住这个产生式是我们额外添加的就行),这是为了使我们知道什么时候解析完毕,当我们最终把源码规约成<math>
            <mi>S'</mi>
            <mo>→</mo>
            <mi>S</mi>
        </math>的时候,就表示所有输入已经被成功解析成AST。</p>
    <p>为了能说明情况,我们先从LR(0)分析技术说起,假设我们有如下文法:</p>
    <table>
        <thead>
            <tr>
                <th colspan="2">文法-LR章节2</th>
            </tr>
            <tr>
                <th>产生式</th>
                <th>作用</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><math>
                        <mi>S'</mi>
                        <mo>→</mo>
                        <mi>E</mi>
                    </math></td>
                <td>增广文法新增的一个产生式</td>
            </tr>
            <tr>
                <td><math>
                        <mi>E</mi>
                        <mo>→</mo>
                        <mi>E</mi>
                        <mo>+</mo>
                        <mi>E</mi>
                    </math></td>
                <td>表达式+表达式还是一个表达式</td>
            </tr>
            <tr>
                <td><math>
                        <mi>E</mi>
                        <mo>→</mo>
                        <mi>id</mi>
                    </math></td>
                <td>单个数字或者变量也是一个表达式</td>
            </tr>
        </tbody>
    </table>
    <p>可以看到,一个满足LR(0)的文法更容易比LL型文法容易写出来。</p>
    <p>
        接下来再介绍三个简单的概念:<em>项</em>、<em>项集</em>、<em>项集族</em>。LR分析器通过维护一些状态表明当前可能使用了哪些产生式以及这些产生式期待的输入串。
    </p>
    <ul>
        <li><span>项：</span><span>使用一个圆点和产生式表示项,一个项可以这样表示：<math>
                    <mi>E</mi>
                    <mo>→</mo>
                    <mo>.</mo>
                    <mi>E</mi>
                    <mo>+</mo>
                    <mi>E</mi>
                </math></span>,这表示对于当前这个产生式,我们期待接下来的输入串是{E + E}</li>
        <li><span>项集：</span><span>一堆项放在一起就叫做项集,比如：</span><br />
            <div style="border: 1px solid black;display:inline-block;">
                <math>
                    <mi>E</mi>
                    <mo>→</mo>
                    <mi>.</mi>
                    <mi>E</mi>
                    <mo>+</mo>
                    <mi>E</mi>
                </math>
                <br />
                <math>
                    <mi>E</mi>
                    <mo>→</mo>
                    <mo>.</mo>
                    <mi>id</mi>
                </math>
            </div><br />
            这就是一个项集了
        </li>
        <li>项集族:一系列的项集就组成了项集族,比如:<br />
            <div style="border: 2px solid black;display:inline-block;padding: 5px;">
                <div style="text-align: center;">这是一个项集族</div>
                <div style="border: 1px solid black;display:inline-block;">
                    <math>
                        <mi>S'</mi>
                        <mo>→</mo>
                        <mi>.</mi>
                        <mi>E</mi>
                    </math>
                    <br />
                    <math>
                        <mi>E</mi>
                        <mo>→</mo>
                        <mo>.</mo>
                        <mi>E</mi>
                        <mo>+</mo>
                        <mi>E</mi>
                    </math>
                </div>
                <div style="border: 1px solid black;display:inline-block;">
                    <math>
                        <mi>E</mi>
                        <mo>→</mo>
                        <mi>.</mi>
                        <mi>E</mi>
                        <mo>+</mo>
                        <mi>E</mi>
                    </math>
                    <br />
                    <math>
                        <mi>E</mi>
                        <mo>→</mo>
                        <mo>.</mo>
                        <mi>id</mi>
                    </math>
                </div>
            </div>
        </li>
    </ul>
    <p>LR分析器通过维护一个状态机,表明当前状态期待什么串输入,使用一个项集表示一个状态(这是LR分析技术规定的,不要问为什么,后续我会详细介绍这种分析原理)</p>
    <p>假设当前分析器处于这样一个状态:</p>
    <div style="border: 1px solid black;display:inline-block;">
        <math>
            <mi>S'</mi>
            <mo>→</mo>
            <mi>.</mi>
            <mi>E</mi>
        </math>
    </div>
    <p>就说明分析器希望下接下来的输入串是{E},但是这样还不够,我们知道对于{id + id}是可以规约成E的,所以当前状态除了期待{E},还期待{id +
        id},同样的这个状态也期待{id}这样的输入串,因为{id}也可以规约成E。所以我们在往项集中添加一些项之后,可以计算一下这个项的闭包,找出项集所有期待的输入串。下面介绍一下项集的构造方法(<math>
            <mi>Closure</mi>
            <mo>(</mo>
            <mi>I</mi>
            <mo>)</mo>
        </math>):</p>
    <ol>
        <li>往项集<math>
                <mi>I</mi>
            </math>中添加形如:<math>
                <mi>A</mi>
                <mo>→</mo>
                <mi>α</mi>
                <mo>.</mo>
                <mi>ε</mi>
                <mi>β</mi>
            </math>这样的项时,如果点后面的符号是终结符ε,则将点的位置后移,直到点后面不是ε或者移动到产生式的末尾。前面这个项变成<math>
                <mi>A</mi>
                <mo>→</mo>
                <mi>α</mi>
                <mi>ε</mi>
                <mo>.</mo>
                <mi>β</mi>
            </math></li>
        <li>for <math>
                <mi>I</mi>
            </math> 中的每一个项
            <ol type="a">
                <li>如果点后面的符号是一个非终结符B,则找到所有以B作为头的产生式<math>
                        <mi>B</mi>
                        <mo>→</mo>
                        <msub>
                            <mi>β</mi>
                            <mn>1</mn>
                        </msub>
                    </math> , <math>
                        <mi>B</mi>
                        <mo>→</mo>
                        <msub>
                            <mi>β</mi>
                            <mn>2</mn>
                        </msub>
                    </math> , <math>
                        <mi>B</mi>
                        <mo>→</mo>
                        <msub>
                            <mi>β</mi>
                            <mn>n</mn>
                        </msub>
                    </math> , <math>
                        <mi>B</mi>
                        <mo>→</mo>
                        <msub>
                            <mi>β</mi>
                            <mn>i</mn>
                        </msub>
                    </math>做如下判断和处理:
                    <ol type="i">
                        <li>如果项<math>
                                <mi>B</mi>
                                <mo>→</mo>
                                <mo>.</mo>
                                <msub>
                                    <mi>β</mi>
                                    <mn>i</mn>
                                </msub>
                            </math>没有出现在项集<math>
                                <mi>I</mi>
                            </math>中,则往<math>
                                <mi>I</mi>
                            </math>中按照规则1添加进去</li>
                    </ol>
                </li>
            </ol>
        </li>
    </ol>
    <p>至此,我们可以轻松得到分析器当前状态期待的所有后续输入串了。前面说过项集是编译器(分析器)一个状态,状态机需要在不同的状态之间跳转,我们如何生成这个状态机(项集族G)呢?我们按照下面的规则定义一个函数<math>
            <mi>Goto</mi>
            <mo>(</mo>
            <mi>I</mi>
            <mo>,</mo>
            <mi>b</mi>
            <mo>)</mo>
        </math>表示项集<math>
            <mi>I</mi>
        </math>在接受一个符号s之后跳转到的目标项集</p>
    <ol>
        <li>先准备一个空项集result</li>
        <li>for <math>
                <mi>I</mi>
            </math> 中的每一个项<math>
                <mi>A</mi>
                <mo>→</mo>
                <mi>a</mi>
                <mo>.</mo>
                <mi>b</mi>
                <mi>c</mi>
                <mi>d</mi>
            </math>
            <ol>
                <li>如果项中圆点后面的符号是b,则把<math>
                        <mi>A</mi>
                        <mo>→</mo>
                        <mi>a</mi>
                        <mi>b</mi>
                        <mo>.</mo>
                        <mi>c</mi>
                        <mi>d</mi>
                    </math>(这里圆点后移了一位)添加到result中</li>
            </ol>
        </li>
        <li>计算<math>
                <msub>
                    <mi>I</mi>
                    <mi>b</mi>
                </msub>
                <mo>=</mo>
                <mi>Clousre</mi>
                <mo>(</mo>
                <mi>result</mi>
                <mo>)</mo>
            </math>,如果<math>
                <msub>
                    <mi>I</mi>
                    <mi>b</mi>
                </msub>
            </math>和项集族G中的每一个项集都不相等(就是<math>
                <msub>
                    <mi>I</mi>
                    <mi>b</mi>
                </msub>
            </math>没有在项集族G中出现过),则把项集<math>
                <msub>
                    <mi>I</mi>
                    <mi>b</mi>
                </msub>
            </math>添加到项集族G中,并创建这样的一条边<math style="vertical-align:middle;">
                <mover>
                    <mrow>
                        <mover>
                            <mrow>
                                <mi>I</mi>
                                <mspace width="3rem"></mspace>
                                <msub>
                                    <mi>I</mi>
                                    <mi>b</mi>
                                </msub>
                            </mrow>
                            <mrow>
                                <mo>→</mo>
                            </mrow>
                        </mover>
                    </mrow>
                    <mi>b</mi>
                </mover>
            </math>，如果项集族已经存在目标项集，我们可以直接用边连接。(<em>集合A中的每一个元素都在集合B中出现,且集合B中的每一个元素都在集合A中出现则说明两个集合相等,和顺序无关</em>)
        </li>
    </ol>
    <p>我们先找到项集<math>
            <mi>I</mi>
        </math>中的每一个圆点不在最后的项,然后提取出圆点后面的符号<math>
            <msub>
                <mi>s</mi>
                <mi>i</mi>
            </msub>
        </math>依次执行<math>
            <mi>Goto</mi>
            <mo>(</mo>
            <mi>I</mi>
            <mo>,</mo>
            <msub>
                <mi>s</mi>
                <mi>i</mi>
            </msub>
            <mo>)</mo>
        </math>，就能得到项集(状态)<math>
            <mi>I</mi>
        </math>的所有后继个状态<math>
            <msub>
                <mi>I</mi>
                <mi>next</mi>
            </msub>
        </math>和跳转条件<math>
            <msub>
                <mi>s</mi>
                <mi>i</mi>
            </msub>
        </math></p>
    <p>接下来我们只要构造出这个文法的项集族，就能愉快的使用LR(0)分析器做我们编译器的前端了。<em>先创建一个项集，这个项集中只有一项:增广文法新增的这个产生式，并且把圆点放在这个产生式体的最前面,计算这个项集的闭包之后添加到项集族G中。然后找到到这个项集的所有后继项集，添加到项集族G中，直到G没有新的项集可以添加。</em>
    </p>
    <p>假设我们有如下文法</p>
    <table>
        <thead>
            <tr>
                <th>产生式</th>
                <th>作用</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><math>
                        <mi>S'</mi>
                        <mo>→</mo>
                        <mi>E</mi>
                    </math></td>
                <td>增广文法新增的一个产生式</td>
            </tr>
            <tr>
                <td><math>
                        <mi>E</mi>
                        <mo>→</mo>
                        <mi>E</mi>
                        <mo>+</mo>
                        <mi>E</mi>
                    </math></td>
                <td>表达式+表达式还是一个表达式</td>
            </tr>
            <tr>
                <td><math>
                        <mi>E</mi>
                        <mo>→</mo>
                        <mi>id</mi>
                    </math></td>
                <td>单个数字或者变量也是一个表达式</td>
            </tr>
        </tbody>
    </table>
    <p>我们可以得到这样的一个项集族：</p>
    <svg id="LR_0_状态图" style="width: 600px;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 303.16 209.39">
        <text transform="translate(89.28 28.01)" style="fill: #000; font-family: SimSun, SimSun; font-size: 10px;">
            <tspan x="0" y="0">E</tspan>
        </text>
        <text transform="translate(209.28 145.67)" style="fill: #000; font-family: SimSun, SimSun; font-size: 10px;">
            <tspan x="0" y="0">E</tspan>
        </text>
        <text transform="translate(34.66 102.17)" style="fill: #000; font-family: SimSun, SimSun; font-size: 10px;">
            <tspan x="0" y="0">id</tspan>
        </text>
        <text transform="translate(154.66 88.56)" style="fill: #000; font-family: SimSun, SimSun; font-size: 10px;">
            <tspan x="0" y="0">+</tspan>
        </text>
        <text transform="translate(209.03 206.09)" style="fill: #000; font-family: SimSun, SimSun; font-size: 10px;">
            <tspan x="0" y="0">+</tspan>
        </text>
        <text transform="translate(88.04 145.67)" style="fill: #000; font-family: SimSun, SimSun; font-size: 10px;">
            <tspan x="0" y="0">id</tspan>
        </text>
        <text transform="translate(7.66 33.06)" style="fill: #000; font-size: 10px;">
            <tspan x="0" y="0" style="font-family: SimSun, SimSun;">S</tspan>
            <tspan x="5" y="0" style="font-family: DengXian, DengXian;">’</tspan>
            <tspan x="7.21" y="0" style="font-family: SimSun, SimSun;">→.E</tspan>
        </text>
        <text transform="translate(7.66 46.76)" style="fill: red; font-family: SimSun, SimSun; font-size: 10px;">
            <tspan x="0" y="0">E→.E + E</tspan>
        </text>
        <text transform="translate(7.66 60.37)" style="fill: red; font-family: SimSun, SimSun; font-size: 10px;">
            <tspan x="0" y="0">E→.id</tspan>
        </text>
        <path d="M2.66,62.06c0,3.51,2.67,6.36,5.97,6.36h48.06c3.3,0,5.97-2.85,5.97-6.36V17.5H2.66v44.56Z"
            style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
        <path d="M56.69.5H8.63C5.33.5,2.66,3.19,2.66,6.51v10.99h60V6.51c0-3.32-2.67-6.01-5.97-6.01Z"
            style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
        <text id="s0" transform="translate(26.11 12.57)"
            style="fill: #000; font-family: SimSun, SimSun; font-size: 10px;">
            <tspan x="0" y="0">S0</tspan>
        </text>
        <text transform="translate(127.66 33.06)" style="fill: #000; font-size: 10px;">
            <tspan x="0" y="0" style="font-family: SimSun, SimSun;">S</tspan>
            <tspan x="5" y="0" style="font-family: DengXian, DengXian;">’</tspan>
            <tspan x="7.21" y="0" style="font-family: SimSun, SimSun;">→E.</tspan>
        </text>
        <text transform="translate(127.66 46.76)" style="fill: #000; font-family: SimSun, SimSun; font-size: 10px;">
            <tspan x="0" y="0">E→E .+ E</tspan>
        </text>
        <path d="M122.66,50.15c0,2.57,2.67,4.66,5.97,4.66h48.06c3.3,0,5.97-2.09,5.97-4.66V17.5h-60v32.65Z"
            style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
        <path d="M176.69.5h-48.06c-3.3,0-5.97,2.69-5.97,6.01v10.99h60V6.51c0-3.32-2.67-6.01-5.97-6.01Z"
            style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
        <text id="s1" transform="translate(146.11 12.57)"
            style="fill: #000; font-family: SimSun, SimSun; font-size: 10px;">
            <tspan x="0" y="0">S1</tspan>
        </text>
        <text transform="translate(127.66 147.37)" style="fill: #000; font-family: SimSun, SimSun; font-size: 10px;">
            <tspan x="0" y="0">E→E + .E</tspan>
        </text>
        <text transform="translate(127.66 160.98)" style="fill: red; font-family: SimSun, SimSun; font-size: 10px;">
            <tspan x="0" y="0">E→.E + E</tspan>
        </text>
        <text transform="translate(128.05 174.58)" style="fill: red; font-family: SimSun, SimSun; font-size: 10px;">
            <tspan x="0" y="0">E→.id</tspan>
        </text>
        <path d="M122.66,176.28c0,3.51,2.67,6.35,5.97,6.35h48.06c3.3,0,5.97-2.84,5.97-6.35v-44.47h-60v44.47Z"
            style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
        <path d="M176.69,114.81h-48.06c-3.3,0-5.97,2.69-5.97,6.01v10.99h60v-10.99c0-3.32-2.67-6.01-5.97-6.01Z"
            style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
        <text id="s3" transform="translate(146.11 126.87)"
            style="fill: #000; font-family: SimSun, SimSun; font-size: 10px;">
            <tspan x="0" y="0">S3</tspan>
        </text>
        <text transform="translate(247.66 147.37)" style="fill: #000; font-family: SimSun, SimSun; font-size: 10px;">
            <tspan x="0" y="0">E→E + E.</tspan>
        </text>
        <text transform="translate(247.66 160.98)" style="fill: #000; font-family: SimSun, SimSun; font-size: 10px;">
            <tspan x="0" y="0">E→E .+ E</tspan>
        </text>
        <path d="M242.66,164.38c0,2.57,2.67,4.65,5.97,4.65h48.06c3.3,0,5.97-2.08,5.97-4.65v-32.57h-60v32.57Z"
            style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
        <path d="M296.69,114.81h-48.06c-3.3,0-5.97,2.69-5.97,6.01v10.99h60v-10.99c0-3.32-2.67-6.01-5.97-6.01Z"
            style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
        <text id="s4" transform="translate(266.11 126.87)"
            style="fill: #000; font-family: SimSun, SimSun; font-size: 10px;">
            <tspan x="0" y="0">S4</tspan>
        </text>
        <text transform="translate(5.5 160.98)" style="fill: #000; font-family: SimSun, SimSun; font-size: 10px;">
            <tspan x="0" y="0">E→id.</tspan>
        </text>
        <path d="M.5,166.08c0,1.63,2.67,2.95,5.97,2.95h48.06c3.3,0,5.97-1.32,5.97-2.95v-20.66H.5v20.66Z"
            style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
        <path d="M54.53,128.42H6.47c-3.3,0-5.97,2.69-5.97,6.01v10.99h60v-10.99c0-3.32-2.67-6.01-5.97-6.01Z"
            style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
        <text id="s2" transform="translate(23.94 140.48)"
            style="fill: #000; font-family: SimSun, SimSun; font-size: 10px;">
            <tspan x="0" y="0">S2</tspan>
        </text>
        <polygon id="s0_1"
            points="117.66 31.06 112.24 29.6 112.24 30.81 67.66 30.81 67.66 31.31 112.24 31.31 112.24 32.51 117.66 31.06"
            style="fill: #000; stroke-width: 0px;" />
        <polygon id="s3_4"
            points="237.66 148.72 232.24 147.27 232.24 148.47 187.66 148.47 187.66 148.97 232.24 148.97 232.24 150.17 237.66 148.72"
            style="fill: #000; stroke-width: 0px;" />
        <polygon id="s3_2"
            points="117.66 148.47 73.08 148.47 73.08 147.27 67.66 148.72 73.08 150.17 73.08 148.97 117.66 148.97 117.66 148.47"
            style="fill: #000; stroke-width: 0px;" />
        <polygon id="s0_2"
            points="32.91 118 32.91 73.42 32.41 73.42 32.41 118 31.21 118 32.66 123.42 34.11 118 32.91 118"
            style="fill: #000; stroke-width: 0px;" />
        <polygon id="s1_3"
            points="152.91 104.39 152.91 59.81 152.41 59.81 152.41 104.39 151.21 104.39 152.66 109.81 154.11 104.39 152.91 104.39"
            style="fill: #000; stroke-width: 0px;" />
        <path id="s4_3"
            d="M272.41,174.72v29.43c0,2.62-2.13,4.75-4.75,4.75h-110c-2.62,0-4.75-2.13-4.75-4.75v-11.09h1.2l-1.45-5.42-1.45,5.42h1.2v11.09c0,2.9,2.35,5.25,5.25,5.25h110c2.9,0,5.25-2.35,5.25-5.25v-29.43h-.5Z"
            style="fill: #000; stroke-width: 0px;" />
    </svg>
    <p>和LL分析器类似，LR分析器也需要一个输入队列、状态栈，并且状态栈每个元素除了记录状态，还会记录移入操作时移入的符号信息,在编译原理中叫做语法制导定义(Syntax-Directed
        Definition),作为分析器的格局，我们按照如下流程处理源码：</p>
    <ol>
        <li>栈中先压入一个元素S0,</li>
        <li><span id="lr_0_step_2">假设输入队列的第一个元素为符号A(此时还没有把A读出来)，然后结合分析器的栈顶元素<math>
                    <msub>
                        <mi>S</mi>
                        <mi>i</mi>
                    </msub>
                </math>做如下判断：</span>
            <ol type="a">
                <li><span id="lr_0_step_2_a">如果项集族中的某一项<math>
                            <msub>
                                <mi>S</mi>
                                <mi>i</mi>
                            </msub>
                        </math>能接受A，则将边A的目标状态<math>
                            <msub>
                                <mi>S</mi>
                                <mi>next</mi>
                            </msub>
                        </math>压入状态栈中，同时在压入的这个元素挂载符号A对应的子树(对于终结符就是一个单节点)，并且从输入队列中移除符号A</span></li>
                <li><span id="lr_0_step_2_b">如果不能接受符号A，则判断状态<math>
                            <msub>
                                <mi>S</mi>
                                <mi>i</mi>
                            </msub>
                        </math>是否存在某个项<math>
                            <msub>
                                <mi>I</mi>
                                <mi>k</mi>
                            </msub>
                        </math>的圆点在产生式末尾</span>
                    <ol type="i">
                        <li id="lr_0_step_2_b_1">
                            如果存在，则从状态栈中弹出对应产生式体符号数量的状态，并且把产生式头H退回输入队列，同时构造一颗子树，根节点是H，各个子节点是从栈中弹出的节点(按照弹出顺序从子树的最右节点开始创建)。如果规约的是增广文法添加的产生式,且下一个输入是$，则分析结束
                        </li>
                        <li id="lr_0_step_2_b_2">如不不存在，则报语法错误</li>
                    </ol>
                </li>
            </ol>
        </li>
    </ol>
    <p>根据条件(2.a.i),我们可以发现一个LR(0)项集最多只允许存在一个项的圆点在最后面，凡是我们在构造项集族时发现<em>一个项集有多个圆点在最后面</em>，我们就可以说这个文法不能用LR(0)分析器进行分析。</p>
    <p>下面又到演示时间了，依旧是熟悉的"1+2+3"，弄动画实在是太累了，下面就列个表演示吧</p>
    <table id="lr_0_table">
        <thead>
            <tr>
                <th>步骤</th>
                <th>栈</th>
                <th>输入</th>
                <th>动作</th>
                <th>AST</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>1</td>
                <td>s0(nil)</td>
                <td>1(id) + 2(id) + 3(id)</td>
                <td>S0可以通过id移入S2，输入移除一个元素，状态栈压入s2，把id挂入栈顶</td>
                <td></td>
            </tr>
            <tr>
                <td>2</td>
                <td>s0(nil) s2(1)</td>
                <td>+ 2(id) + 3(id)</td>
                <td>S2对于输入符号'+'，使用产生式'E→id'规约,栈弹出一个元素,生成AST的一个子树</td>
                <td><svg style="width: 30px;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 21.7 57">
                        <text transform="translate(8.42 50.26)"
                            style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                            <tspan x="0" y="0">1</tspan>
                        </text>
                        <circle cx="11.2" cy="46.5" r="10" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <text transform="translate(7.12 14.26)"
                            style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                            <tspan x="0" y="0">E</tspan>
                        </text>
                        <circle cx="10.5" cy="10.5" r="10" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <line x1="10.5" y1="23.5" x2="10.5" y2="33.5"
                            style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                    </svg></td>
            </tr>
            <tr>
                <td>3</td>
                <td>s0(nil)</td>
                <td>E + 2(id) + 3(id)</td>
                <td>移入S1</td>
                <td></td>
            </tr>
            <tr>
                <td>4</td>
                <td>s0(nil) s1(E)</td>
                <td>+ 2(id) + 3(id)</td>
                <td>移入s3</td>
                <td></td>
            </tr>
            <tr>
                <td>5</td>
                <td>s0(nil) s1(E) s3(+)</td>
                <td>2(id) + 3(id)</td>
                <td>移入s2</td>
                <td></td>
            </tr>
            <tr>
                <td>6</td>
                <td>s0(nil) s1(E) s3(+) s2(2)</td>
                <td>+ 3(id)</td>
                <td>规约</td>
                <td><svg style="width: 30px;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 21.7 57">
                        <text transform="translate(8.42 50.26)"
                            style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                            <tspan x="0" y="0">2</tspan>
                        </text>
                        <circle cx="11.2" cy="46.5" r="10" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <text transform="translate(7.12 14.26)"
                            style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                            <tspan x="0" y="0">E</tspan>
                        </text>
                        <circle cx="10.5" cy="10.5" r="10" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <line x1="11.2" y1="23.5" x2="11.2" y2="33.5"
                            style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                    </svg></td>
            </tr>
            <tr>
                <td>7</td>
                <td>s0(nil) s1(E) s3(+)</td>
                <td>E + 3(id)</td>
                <td>移入s4</td>
                <td></td>
            </tr>
            <tr>
                <td>8</td>
                <td>s0(nil) s1(E1) s3(+) s4(E2)</td>
                <td>+ 3(id)</td>
                <td>移入s3</td>
                <td></td>
            </tr>
            <tr>
                <td>9</td>
                <td>s0(nil) s1(E1) s3(+) s4(E2) s3(+)</td>
                <td>3(id)</td>
                <td>移入s2</td>
                <td></td>
            </tr>
            <tr>
                <td>10</td>
                <td>s0(nil) s1(E1) s3(+) s4(E2) s3(+) s2(3)</td>
                <td>$(后面没有输入了，按照惯例用这个符号表示末尾)</td>
                <td>规约</td>
                <td><svg style="width: 30px;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 21 57">
                        <text transform="translate(7.12 14.26)"
                            style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                            <tspan x="0" y="0">E</tspan>
                        </text>
                        <circle cx="10.5" cy="10.5" r="10" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <circle cx="10.5" cy="46.5" r="10" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <text transform="translate(7.73 50.26)"
                            style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                            <tspan x="0" y="0">3</tspan>
                        </text>
                        <line x1="10.5" y1="23.5" x2="10.5" y2="33.5"
                            style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                    </svg></td>
            </tr>
            <tr>
                <td>11</td>
                <td>s0(nil) s1(E1) s3(+) s4(E2) s3(+)</td>
                <td>E</td>
                <td>移入s4</td>
                <td></td>
            </tr>
            <tr>
                <td>12</td>
                <td>s0(nil) s1(E1) s3(+) s4(E2) s3(+) s4(E3)</td>
                <td>$</td>
                <td>规约</td>
                <td><svg style="width: 100px;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 84.62 97.32">
                        <text transform="translate(37.29 14.26)"
                            style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                            <tspan x="0" y="0">E</tspan>
                        </text>
                        <circle cx="40.66" cy="10.5" r="10" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <text transform="translate(7.73 90.57)"
                            style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                            <tspan x="0" y="0">2</tspan>
                        </text>
                        <circle cx="10.5" cy="86.82" r="10" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <line x1="10.5" y1="63.82" x2="10.5" y2="73.82"
                            style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <text transform="translate(7.12 53.87)"
                            style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                            <tspan x="0" y="0">E</tspan>
                        </text>
                        <circle cx="10.5" cy="50.11" r="10" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <text transform="translate(36.69 53.87)"
                            style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                            <tspan x="0" y="0">+</tspan>
                        </text>
                        <circle cx="40.32" cy="50.11" r="10" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <text transform="translate(70.74 53.26)"
                            style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                            <tspan x="0" y="0">E</tspan>
                        </text>
                        <circle cx="74.12" cy="49.5" r="10" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <circle cx="74.12" cy="85.5" r="10" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <text transform="translate(71.34 89.26)"
                            style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                            <tspan x="0" y="0">3</tspan>
                        </text>
                        <line x1="74.12" y1="62.5" x2="74.12" y2="72.5"
                            style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <line x1="50.32" y1="23.5" x2="70.17" y2="36.5"
                            style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <line x1="40.32" y1="26.5" x2="40.32" y2="36.5"
                            style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <line x1="30.32" y1="23.5" x2="11.16" y2="36.5"
                            style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                    </svg></td>
            </tr>
            <tr>
                <td>13</td>
                <td>s0(nil) s1(E1) s3(+)</td>
                <td>E</td>
                <td>移入s4</td>
                <td></td>
            </tr>
            <tr>
                <td>14</td>
                <td>s0(nil) s1(E1) s3(+) s4(E)</td>
                <td>$</td>
                <td>规约</td>
                <td><svg style="width: 200px;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 155.06 134.02">
                        <text transform="translate(8.42 86.96)"
                            style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                            <tspan x="0" y="0">1</tspan>
                        </text>
                        <circle cx="11.2" cy="83.2" r="10" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <text transform="translate(7.12 50.96)"
                            style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                            <tspan x="0" y="0">E</tspan>
                        </text>
                        <circle cx="10.5" cy="47.2" r="10" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <line x1="10.5" y1="60.2" x2="10.5" y2="70.2"
                            style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <text transform="translate(107.73 50.96)"
                            style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                            <tspan x="0" y="0">E</tspan>
                        </text>
                        <circle cx="111.11" cy="47.2" r="10" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <text transform="translate(57.35 50.96)"
                            style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                            <tspan x="0" y="0">+</tspan>
                        </text>
                        <circle cx="60.98" cy="47.2" r="10" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <text transform="translate(78.17 127.28)"
                            style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                            <tspan x="0" y="0">2</tspan>
                        </text>
                        <circle cx="80.95" cy="123.52" r="10"
                            style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <line x1="80.95" y1="100.52" x2="80.95" y2="110.52"
                            style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <text transform="translate(77.57 90.57)"
                            style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                            <tspan x="0" y="0">E</tspan>
                        </text>
                        <circle cx="80.95" cy="86.82" r="10" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <text transform="translate(107.13 90.57)"
                            style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                            <tspan x="0" y="0">+</tspan>
                        </text>
                        <circle cx="110.76" cy="86.82" r="10"
                            style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <text transform="translate(141.19 89.96)"
                            style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                            <tspan x="0" y="0">E</tspan>
                        </text>
                        <circle cx="144.56" cy="86.2" r="10" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <circle cx="144.56" cy="122.2" r="10"
                            style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <text transform="translate(141.79 125.96)"
                            style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                            <tspan x="0" y="0">3</tspan>
                        </text>
                        <line x1="144.56" y1="99.2" x2="144.56" y2="109.2"
                            style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <text transform="translate(57.6 14.26)"
                            style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                            <tspan x="0" y="0">E</tspan>
                        </text>
                        <circle cx="60.98" cy="10.5" r="10" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <line x1="120.76" y1="60.2" x2="140.61" y2="73.2"
                            style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <line x1="110.76" y1="63.2" x2="110.76" y2="73.2"
                            style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <line x1="100.76" y1="60.2" x2="81.6" y2="73.2"
                            style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <line x1="60.98" y1="23.5" x2="60.98" y2="33.5"
                            style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <line x1="50.98" y1="20.5" x2="10.85" y2="33.5"
                            style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <line x1="70.98" y1="20.5" x2="111.11" y2="33.5"
                            style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                    </svg></td>
            </tr>
            <tr>
                <td>15</td>
                <td>s0(nil)</td>
                <td>E</td>
                <td>移入s1</td>
                <td></td>
            </tr>
            <tr>
                <td>16</td>
                <td>s0(nil) s1(E)</td>
                <td>$</td>
                <td>规约</td>
                <td><svg style="width: 200px;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 155.06 170.02">
                        <text transform="translate(8.42 122.96)"
                            style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                            <tspan x="0" y="0">1</tspan>
                        </text>
                        <circle cx="11.2" cy="119.2" r="10" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <text transform="translate(7.12 86.96)"
                            style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                            <tspan x="0" y="0">E</tspan>
                        </text>
                        <circle cx="10.5" cy="83.2" r="10" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <line x1="10.5" y1="96.2" x2="10.5" y2="106.2"
                            style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <text transform="translate(107.73 86.96)"
                            style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                            <tspan x="0" y="0">E</tspan>
                        </text>
                        <circle cx="111.11" cy="83.2" r="10" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <text transform="translate(57.35 86.96)"
                            style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                            <tspan x="0" y="0">+</tspan>
                        </text>
                        <circle cx="60.98" cy="83.2" r="10" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <text transform="translate(78.17 163.28)"
                            style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                            <tspan x="0" y="0">2</tspan>
                        </text>
                        <circle cx="80.95" cy="159.52" r="10"
                            style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <line x1="80.95" y1="136.52" x2="80.95" y2="146.52"
                            style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <text transform="translate(77.57 126.57)"
                            style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                            <tspan x="0" y="0">E</tspan>
                        </text>
                        <circle cx="80.95" cy="122.82" r="10"
                            style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <text transform="translate(107.13 126.57)"
                            style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                            <tspan x="0" y="0">+</tspan>
                        </text>
                        <circle cx="110.76" cy="122.82" r="10"
                            style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <text transform="translate(141.19 125.96)"
                            style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                            <tspan x="0" y="0">E</tspan>
                        </text>
                        <circle cx="144.56" cy="122.2" r="10"
                            style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <circle cx="144.56" cy="158.2" r="10"
                            style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <text transform="translate(141.79 161.96)"
                            style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                            <tspan x="0" y="0">3</tspan>
                        </text>
                        <line x1="144.56" y1="135.2" x2="144.56" y2="145.2"
                            style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <text transform="translate(57.6 14.26)"
                            style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                            <tspan x="0" y="0">S’</tspan>
                        </text>
                        <circle cx="60.98" cy="10.5" r="10" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <text transform="translate(57.6 50.26)"
                            style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                            <tspan x="0" y="0">E</tspan>
                        </text>
                        <circle cx="60.98" cy="46.5" r="10" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <line x1="60.98" y1="23.5" x2="60.98" y2="33.5"
                            style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <line x1="120.76" y1="96.2" x2="140.61" y2="109.2"
                            style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <line x1="110.76" y1="99.2" x2="110.76" y2="109.2"
                            style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <line x1="100.76" y1="96.2" x2="81.6" y2="109.2"
                            style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <line x1="60.98" y1="59.5" x2="60.98" y2="69.5"
                            style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <line x1="50.98" y1="56.5" x2="10.85" y2="69.5"
                            style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <line x1="70.98" y1="56.5" x2="111.11" y2="69.5"
                            style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                    </svg></td>
            </tr>
            <tr>
                <td colspan="5">结束</td>
            </tr>
        </tbody>
    </table>
    <p>大家应该可以发现，这个文法其实是有二义性的，但是刚好我们定的这个LR(0)文法分析器是能移入就移入，所以碰巧解决了这个问题，因为我们定义的这个文法对于输入"1+2+3"可以生成这样的两棵树：</p>
    <svg style="width: 500px;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 396.14 170.02">
        <g>
            <text transform="translate(8.42 158.96)"
                style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                <tspan x="0" y="0">1</tspan>
            </text>
            <circle cx="11.2" cy="155.2" r="10" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
            <text transform="translate(7.12 122.96)"
                style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                <tspan x="0" y="0">E</tspan>
            </text>
            <circle cx="10.5" cy="119.2" r="10" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
            <line x1="10.5" y1="132.2" x2="10.5" y2="142.2" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
            <text transform="translate(66.74 158.96)"
                style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                <tspan x="0" y="0">2</tspan>
            </text>
            <circle cx="69.51" cy="155.2" r="10" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
            <text transform="translate(65.44 122.96)"
                style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                <tspan x="0" y="0">E</tspan>
            </text>
            <circle cx="68.81" cy="119.2" r="10" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
            <line x1="69.51" y1="132.2" x2="69.51" y2="142.2"
                style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
            <line x1="49.66" y1="93.2" x2="69.51" y2="106.2" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
            <text transform="translate(36.03 122.96)"
                style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                <tspan x="0" y="0">+</tspan>
            </text>
            <circle cx="39.66" cy="119.2" r="10" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
            <text transform="translate(36.28 86.96)"
                style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                <tspan x="0" y="0">E</tspan>
            </text>
            <circle cx="39.66" cy="83.2" r="10" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
            <text transform="translate(86.16 86.26)"
                style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                <tspan x="0" y="0">+</tspan>
            </text>
            <circle cx="89.79" cy="82.5" r="10" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
            <text transform="translate(136.54 86.96)"
                style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                <tspan x="0" y="0">E</tspan>
            </text>
            <circle cx="139.92" cy="83.2" r="10" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
            <circle cx="139.92" cy="119.2" r="10" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
            <text transform="translate(137.15 118.9)"
                style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                <tspan x="0" y="0">3</tspan>
            </text>
            <line x1="139.92" y1="96.2" x2="139.92" y2="106.2"
                style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
            <text transform="translate(86.41 14.26)"
                style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                <tspan x="0" y="0">S’</tspan>
            </text>
            <circle cx="89.79" cy="10.5" r="10" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
            <text transform="translate(86.41 50.26)"
                style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                <tspan x="0" y="0">E</tspan>
            </text>
            <circle cx="89.79" cy="46.5" r="10" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
            <line x1="39.66" y1="96.2" x2="39.66" y2="106.2" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
            <line x1="89.79" y1="59.5" x2="89.79" y2="69.5" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
            <line x1="89.79" y1="23.5" x2="89.79" y2="33.5" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
            <line x1="29.66" y1="93.2" x2="10.5" y2="106.2" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
            <line x1="79.79" y1="56.5" x2="39.66" y2="69.5" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
            <line x1="99.79" y1="56.5" x2="139.92" y2="69.5" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
        </g>
        <g>
            <text transform="translate(249.5 122.96)"
                style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                <tspan x="0" y="0">1</tspan>
            </text>
            <circle cx="252.28" cy="119.2" r="10" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
            <text transform="translate(248.2 86.96)"
                style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                <tspan x="0" y="0">E</tspan>
            </text>
            <circle cx="251.58" cy="83.2" r="10" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
            <line x1="251.58" y1="96.2" x2="251.58" y2="106.2"
                style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
            <text transform="translate(348.81 86.96)"
                style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                <tspan x="0" y="0">E</tspan>
            </text>
            <circle cx="352.19" cy="83.2" r="10" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
            <text transform="translate(298.43 86.96)"
                style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                <tspan x="0" y="0">+</tspan>
            </text>
            <circle cx="302.06" cy="83.2" r="10" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
            <text transform="translate(319.26 163.28)"
                style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                <tspan x="0" y="0">2</tspan>
            </text>
            <circle cx="322.03" cy="159.52" r="10" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
            <line x1="322.03" y1="136.52" x2="322.03" y2="146.52"
                style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
            <text transform="translate(318.65 126.57)"
                style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                <tspan x="0" y="0">E</tspan>
            </text>
            <circle cx="322.03" cy="122.82" r="10" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
            <text transform="translate(348.21 126.57)"
                style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                <tspan x="0" y="0">+</tspan>
            </text>
            <circle cx="351.84" cy="122.82" r="10" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
            <text transform="translate(382.27 125.96)"
                style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                <tspan x="0" y="0">E</tspan>
            </text>
            <circle cx="385.64" cy="122.2" r="10" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
            <circle cx="385.64" cy="158.2" r="10" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
            <text transform="translate(382.87 161.96)"
                style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                <tspan x="0" y="0">3</tspan>
            </text>
            <line x1="385.64" y1="135.2" x2="385.64" y2="145.2"
                style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
            <text transform="translate(298.68 14.26)"
                style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                <tspan x="0" y="0">S’</tspan>
            </text>
            <circle cx="302.06" cy="10.5" r="10" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
            <text transform="translate(298.68 50.26)"
                style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                <tspan x="0" y="0">E</tspan>
            </text>
            <circle cx="302.06" cy="46.5" r="10" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
            <line x1="302.06" y1="23.5" x2="302.06" y2="33.5"
                style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
            <line x1="361.84" y1="96.2" x2="381.7" y2="109.2"
                style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
            <line x1="351.84" y1="99.2" x2="351.84" y2="109.2"
                style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
            <line x1="341.84" y1="96.2" x2="322.69" y2="109.2"
                style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
            <line x1="302.06" y1="59.5" x2="302.06" y2="69.5"
                style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
            <line x1="292.06" y1="56.5" x2="251.93" y2="69.5"
                style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
            <line x1="312.06" y1="56.5" x2="352.19" y2="69.5"
                style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
        </g>
    </svg>
    <h3>LR(1)分析器</h3>
    <p>接下来就介绍前端的最后一个内容LR(1)分析器。因为LR(0)分析器不允许一个项集中有一个规约项，所以很多文法写出来没什么问题，但是一上到LR(0)分析器就报各种错误，所以LR(1)分析器闪亮登场</p>
    <p>通过前面LR(0)的说明，我们知道一个项中的圆点表示这个项期待的后续输入串，LR(1)则对项进行了升级：<span style="border: solid 1px;padding: 0 1rem;"><math>
                <mi>E</mi>
                <mo>→</mo>
                <mi>E</mi>
                <mo>+</mo>
                <mo>.</mo>
                <mi>E</mi>
                <mo>,</mo>
                <mi>id</mi>
            </math></span>多了一个逗号和逗号后面的终结符，在规约的时候和LR(0)略有不同，当圆点在产生式末尾且输入串中的下一个符号是id时，才选择规约。老规矩，介绍LR(1)项集计算方法(<math>
            <mi>Closure</mi>
            <mo>(</mo>
            <mi>I</mi>
            <mo>)</mo>
        </math>)</p>
    <ol>
        <li>往项集<math>
                <mi>I</mi>
            </math>中添加形如:<math>
                <mi>A</mi>
                <mo>→</mo>
                <mi>α</mi>
                <mo>.</mo>
                <mi>ε</mi>
                <mi>β</mi>
                <mo>,</mo>
                <mi>s</mi>
            </math>这样的项时,如果点后面的符号是终结符ε,则将点的位置后移,直到点后面不是ε或者移动到产生式的末尾。前面这个项变成<math>
                <mi>A</mi>
                <mo>→</mo>
                <mi>α</mi>
                <mi>ε</mi>
                <mo>.</mo>
                <mi>β</mi>
                <mo>,</mo>
                <mi>s</mi>
            </math></li>
        <li>for <math>
                <mi>I</mi>
            </math> 中的每一个项
            <ol type="a">
                <li>如果点后面的符号是一个非终结符B(形如这样的项<math>
                        <mi>A</mi>
                        <mo>→</mo>
                        <mi>α</mi>
                        <mo>.</mo>
                        <mi>B</mi>
                        <mi>β</mi>
                        <mo>,</mo>
                        <mi>s</mi>
                    </math>),先找到所有以B作为头的产生式<math>
                        <mi>B</mi>
                        <mo>→</mo>
                        <msub>
                            <mi>β</mi>
                            <mn>1</mn>
                        </msub>
                    </math> , <math>
                        <mi>B</mi>
                        <mo>→</mo>
                        <msub>
                            <mi>β</mi>
                            <mn>2</mn>
                        </msub>
                    </math> , <math>
                        <mi>B</mi>
                        <mo>→</mo>
                        <msub>
                            <mi>β</mi>
                            <mn>n</mn>
                        </msub>
                    </math> , <math>
                        <mi>B</mi>
                        <mo>→</mo>
                        <msub>
                            <mi>β</mi>
                            <mn>i</mn>
                        </msub>
                    </math>，然后计算<math>
                        <mo>[</mo>
                        <msub>
                            <mi>x</mi>
                            <mn>1</mn>
                        </msub>
                        <mo>,</mo>
                        <msub>
                            <mi>x</mi>
                            <mn>2</mn>
                        </msub>
                        <mo>,</mo>
                        <mo>...</mo>
                        <mo>,</mo>
                        <msub>
                            <mi>x</mi>
                            <mn>j</mn>
                        </msub>
                        <mo>]</mo>
                        <mo>=</mo>
                        <mi>first</mi>
                        <mo>(</mo>
                        <mi>β</mi>
                        <mi>s</mi>
                        <mo>)</mo>
                    </math>后做如下判断和处理:
                    <ol type="i">
                        <li>如果项<span style="border: solid 1px;padding: 0 1rem;"><math>
                                    <mi>B</mi>
                                    <mo>→</mo>
                                    <mo>.</mo>
                                    <msub>
                                        <mi>β</mi>
                                        <mn>i</mn>
                                    </msub>
                                    <mo>,</mo>
                                    <msub>
                                        <mi>x</mi>
                                        <mn>j</mn>
                                    </msub>
                                </math></span>没有出现在项集<math>
                                <mi>I</mi>
                            </math>中,则往<math>
                                <mi>I</mi>
                            </math>中按照规则1添加进去(注意，这里我们需要判断<math>
                                <mn>i</mn>
                                <mo>×</mo>
                                <mi>j</mi>
                            </math>次)</li>
                    </ol>
                </li>
            </ol>
        </li>
    </ol>
    <p>因为对于一个项<math>
            <mi>A</mi>
            <mo>→</mo>
            <mi>α</mi>
            <mo>.</mo>
            <mi>B</mi>
            <mi>β</mi>
            <mo>,</mo>
            <mi>s</mi>
        </math>来说，我们期待一个输入串是<math>
            <mo>[</mo>
            <mi>B</mi>
            <mi>β</mi>
            <mo>,</mo>
            <mi>s</mi>
            <mo>]</mo>
        </math>，那么展开B之后自然希望遇到<math>
            <mi>first</mi>
            <mo>(</mo>
            <mi>β</mi>
            <mo>)</mo>
        </math>就先规约成<math>
            <mi>B</mi>
        </math>，并且如果<math>
            <mi>β</mi>
        </math>是一个空串,那么就是在遇到<math>
            <mi>s</mi>
        </math>就进行规约，如下图所示：</p>
    <svg style="width: 10rem;margin: 0 auto;display: block;" xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 57.92 41.01">
        <path
            d="M10.57,5.06l-1.64,3.12c-.04.09-.07.16-.09.22-.02.07-.01.13.02.16.03.04.12.06.25.07l.73.07-.05.22c-.13-.02-.57-.03-1.31-.03s-1.18,0-1.32.03l.05-.22.69-.07c.24-.03.45-.19.62-.5L12.97,0h.31l.35,8.03c.01.15.03.26.06.31.03.05.1.1.2.15l.53.23-.05.2c-.36-.03-.82-.04-1.39-.04s-1.04.01-1.41.04l.05-.2.74-.13c.14-.03.24-.06.31-.09.06-.04.1-.09.12-.16.01-.05.02-.14.01-.27l-.11-3h-2.11ZM12.67,4.76l-.12-3.47-1.81,3.47h1.94Z"
            style="fill: #000; stroke-width: 0px;" />
        <path d="M25.67,4.92l-3.61,2.11-.04-.19,2.29-1.71h-8.38l.11-.44h8.38l-1.44-1.71.14-.17,2.53,2.11Z"
            style="fill: #000; stroke-width: 0px;" />
        <path
            d="M29.02,5.75l1.08-1.76c.12-.19.21-.3.26-.33.05-.03.13-.05.23-.05.18,0,.3.01.36.03.06.02.08.06.07.13-.01.05-.07.15-.16.28l-1.79,2.68c-.02.54,0,.94.06,1.2.06.26.19.39.37.39.21,0,.45-.16.72-.47l.09.08c-.21.4-.39.69-.56.87-.17.19-.34.28-.51.28-.19,0-.32-.12-.39-.37-.07-.25-.11-.74-.11-1.47-.4.74-.73,1.23-.98,1.47-.26.25-.54.37-.84.37-.44,0-.73-.23-.87-.69-.14-.46-.12-1.1.09-1.9.21-.82.53-1.53.98-2.11s.87-.87,1.28-.87c.31,0,.51.18.59.55.08.37.1.93.04,1.69ZM28.76,6.2c0-.52-.03-.91-.08-1.16-.05-.26-.12-.42-.21-.5-.09-.08-.21-.11-.37-.11-.34,0-.67.21-1,.63-.33.42-.58.95-.73,1.57-.13.53-.15.96-.04,1.3.1.34.28.5.53.5.19,0,.36-.08.52-.23.16-.15.42-.5.76-1.04l.62-.97Z"
            style="fill: #000; stroke-width: 0px;" />
        <path
            d="M31.48,9.09c-.16,0-.27-.07-.35-.2-.07-.13-.09-.3-.04-.5.05-.2.15-.36.29-.5.14-.13.29-.2.45-.2s.27.07.35.2c.07.13.08.3.03.5-.05.2-.15.36-.29.5-.14.13-.29.2-.45.2Z"
            style="fill: #000; stroke-width: 0px;" />
        <path
            d="M34.88.74l.06-.23.64-.04c1.37-.09,2.16-.13,2.39-.13.8,0,1.37.17,1.7.52.33.35.42.84.26,1.49-.17.68-.7,1.24-1.58,1.67,1.01.38,1.36,1.15,1.07,2.33-.12.48-.36.93-.71,1.34-.35.41-.77.71-1.25.91-.48.2-.98.3-1.51.3h-2.23s-.76-.01-.76-.01l.05-.21.72-.16c.14-.04.26-.1.34-.19.08-.09.15-.27.22-.53l1.64-6.51c.04-.14.04-.25.02-.31-.02-.06-.15-.11-.39-.13l-.68-.08ZM36,4.49l-.76,3.01c-.17.68.16,1.02,1,1.02.46,0,.91-.2,1.35-.6s.73-.86.86-1.38c.18-.72.14-1.25-.13-1.59s-.76-.52-1.49-.52c-.25,0-.52.02-.83.05ZM36.1,4.09c.11.03.39.04.82.04.51,0,.96-.17,1.35-.52.39-.34.66-.81.81-1.39.12-.49.07-.88-.15-1.15-.22-.27-.61-.41-1.16-.41-.28,0-.56.04-.83.12l-.83,3.31Z"
            style="fill: #000; stroke-width: 0px;" />
        <path
            d="M40.81,7.73c-.24,1.19-.38,2.12-.42,2.77-.03.45-.08.8-.15,1.06-.12.47-.31.7-.59.7-.19,0-.3-.07-.31-.19-.02-.13,0-.33.08-.6.07-.26.18-.62.33-1.08.47-1.37.83-2.59,1.09-3.66l.79-3.27c.18-.76.43-1.38.73-1.85.3-.47.65-.8,1.04-1,.39-.19.76-.29,1.08-.29.37,0,.65.17.83.52.18.35.21.78.08,1.28-.2.81-.76,1.47-1.67,1.98.35.16.63.47.84.93.22.46.25,1,.08,1.64-.14.56-.41,1.1-.81,1.62s-.89.79-1.48.79c-.77,0-1.29-.45-1.55-1.36ZM40.95,7.22c.29.7.71,1.05,1.26,1.05.45,0,.88-.24,1.28-.71.4-.47.66-.94.77-1.38.11-.42.07-.78-.12-1.07s-.44-.44-.77-.44l-.52.07c-.11,0-.2-.05-.25-.15-.05-.1-.07-.21-.03-.34.03-.12.09-.21.18-.29.09-.08.2-.11.32-.11.13,0,.26.04.41.13.13,0,.38-.24.73-.72.35-.48.58-.94.69-1.38.09-.35.09-.61.01-.77-.08-.17-.25-.25-.51-.25-.54,0-1.07.39-1.59,1.16-.53.78-.96,1.81-1.3,3.1l-.55,2.1Z"
            style="fill: #000; stroke-width: 0px;" />
        <path
            d="M44.52,11.21l.07-.3c.34-.15.63-.37.88-.65s.4-.53.45-.73c.04-.16.04-.28-.01-.34-.05-.07-.18-.1-.4-.1-.13,0-.22-.05-.28-.15-.06-.1-.07-.22-.03-.38.04-.16.13-.3.28-.42.14-.12.28-.18.42-.18.26,0,.45.11.59.34.13.23.16.5.08.83-.11.45-.38.89-.81,1.32-.43.43-.84.69-1.25.77Z"
            style="fill: #000; stroke-width: 0px;" />
        <path
            d="M50.87,5c.01-.3-.06-.58-.22-.82-.16-.24-.33-.36-.5-.36-.52,0-.86.3-1.01.9-.06.24-.03.45.1.61.13.17.35.33.66.49.71.39.98.93.8,1.64-.12.47-.36.85-.72,1.16-.36.31-.76.46-1.18.46-.51,0-.91-.12-1.18-.35l.27-1.52h.18c-.02.48.06.86.24,1.15.18.29.41.44.69.44.23,0,.44-.09.65-.28.2-.18.34-.41.41-.69.13-.51-.1-.92-.7-1.24-.42-.22-.69-.46-.83-.71-.14-.25-.17-.55-.08-.91.11-.46.34-.82.68-1.08.34-.26.74-.4,1.19-.4.41,0,.73.11.97.32l-.23,1.17h-.2Z"
            style="fill: #000; stroke-width: 0px;" />
        <text transform="translate(16.46 20.55) scale(.77 .97) skewX(-17.52)"
            style="fill: #000; font-family: STSong, STSong; font-size: 6.3px;">
            <tspan x="0" y="0">B→</tspan>
        </text>
        <text transform="translate(24.32 20.55) scale(.77 .97) skewX(-17.59)"
            style="fill: #000; font-family: STSong, STSong; font-size: 6.32px;">
            <tspan x="0" y="0">γδ</tspan>
        </text>
        <path
            d="M3.48,33.38l-1.7,3.12c-.05.09-.08.16-.09.21-.02.07-.01.13.02.16.03.04.12.06.25.07l.73.07-.06.22c-.13-.02-.57-.03-1.31-.03s-1.18,0-1.32.03l.06-.22.69-.07c.24-.03.45-.19.63-.5l4.58-8.12h.31l.21,8.03c0,.15.03.26.06.31.03.05.09.1.2.15l.53.23-.05.2c-.36-.03-.82-.04-1.39-.04s-1.04.01-1.41.04l.05-.2.74-.14c.14-.03.25-.06.31-.09.06-.04.1-.09.12-.16.01-.05.02-.14.02-.27l-.06-3h-2.11ZM5.58,33.08l-.06-3.47-1.88,3.47h1.94Z"
            style="fill: #000; stroke-width: 0px;" />
        <path d="M18.57,33.25l-3.64,2.11-.04-.19,2.32-1.71h-8.38l.12-.44h8.38l-1.41-1.71.14-.17,2.5,2.11Z"
            style="fill: #000; stroke-width: 0px;" />
        <path
            d="M21.91,34.08l1.11-1.76c.12-.19.21-.3.26-.33s.13-.05.23-.05c.18,0,.3.01.36.03.06.02.08.06.07.13-.01.05-.07.15-.16.28l-1.83,2.68c-.03.54-.02.94.04,1.2.06.26.18.39.37.39.21,0,.45-.16.73-.47l.09.08c-.21.39-.41.69-.58.87-.17.19-.34.28-.52.28-.19,0-.32-.12-.39-.37-.07-.25-.09-.74-.08-1.47-.41.73-.75,1.23-1.01,1.47-.26.25-.54.37-.85.37-.44,0-.72-.23-.86-.69-.14-.46-.1-1.1.12-1.9.22-.82.56-1.53,1.01-2.11.45-.58.88-.87,1.29-.87.31,0,.51.18.58.55s.08.93.01,1.69ZM21.64,34.52c0-.52-.02-.91-.06-1.16-.05-.26-.11-.42-.2-.5-.09-.08-.21-.11-.37-.11-.34,0-.67.21-1.01.63-.34.42-.59.95-.76,1.57-.14.53-.16.96-.06,1.3.1.34.27.5.52.5.19,0,.36-.08.53-.23.17-.15.42-.5.78-1.04l.63-.97Z"
            style="fill: #000; stroke-width: 0px;" />
        <path
            d="M24.31,37.41c-.16,0-.27-.07-.34-.2-.07-.13-.08-.3-.03-.5.05-.2.15-.36.29-.5.14-.13.29-.2.45-.2s.27.07.34.2c.07.14.08.3.03.5-.05.2-.15.36-.29.5-.14.13-.29.2-.45.2Z"
            style="fill: #000; stroke-width: 0px;" />
        <path
            d="M32.13,33.22l-.08-.09c.51-.86.9-1.29,1.16-1.29.49,0,.56,1.65.2,4.94.96-1.3,1.54-2.33,1.75-3.11.06-.21.1-.46.14-.76.04-.3.06-.46.07-.49.04-.16.12-.3.24-.41.12-.11.24-.17.37-.17.14,0,.24.09.28.26.04.17.03.4-.05.68-.2.74-1.14,2.21-2.83,4.44l-.09.63c-.09.63-.18,1.12-.28,1.48-.22.81-.47,1.21-.76,1.21s-.34-.36-.15-1.08c.17-.65.51-1.38,1-2.19.16-1.49.22-2.59.17-3.31-.05-.72-.2-1.08-.44-1.08-.15,0-.38.11-.68.34Z"
            style="fill: #000; stroke-width: 0px;" />
        <path
            d="M39.14,32.17c-.34-.39-.58-.7-.72-.93-.14-.23-.22-.43-.23-.6,0-.17.02-.36.08-.58.11-.41.3-.75.57-1.01.27-.26.57-.39.89-.39.26,0,.48.05.65.15.18.1.41.38.68.84.27.46.39.75.36.89-.02.08-.11.18-.26.29-.16.11-.26.17-.32.17-.06,0-.12-.08-.18-.24-.2-.59-.38-1.03-.55-1.31-.17-.28-.37-.42-.59-.42-.2,0-.38.08-.55.24-.17.16-.28.37-.35.63-.09.33-.04.63.13.9s.46.57.86.91c.51.45.85.93,1.02,1.43.17.51.18,1.08,0,1.71-.19.7-.55,1.3-1.08,1.8-.53.5-1.11.75-1.73.75s-1.06-.27-1.31-.8c-.25-.53-.28-1.17-.08-1.92.19-.7.52-1.27.99-1.72.47-.45,1.04-.72,1.72-.81ZM39.34,32.39c-.55.21-1.04.57-1.46,1.1-.43.53-.73,1.12-.91,1.79-.15.56-.15.99.01,1.31.16.32.45.48.88.48.45,0,.85-.22,1.21-.65.36-.43.64-1.03.85-1.8.26-.96.06-1.7-.58-2.23Z"
            style="fill: #000; stroke-width: 0px;" />
        <path
            d="M47.36,36.06c-.26,1.19-.41,2.12-.47,2.77-.04.45-.1.8-.17,1.06-.12.47-.33.7-.6.7-.19,0-.3-.06-.31-.19-.02-.13.01-.33.09-.6.07-.26.19-.62.35-1.08.49-1.37.87-2.59,1.15-3.66l.85-3.27c.2-.76.45-1.38.76-1.85.31-.47.66-.8,1.06-1,.4-.19.76-.29,1.09-.29.37,0,.65.17.82.52.18.35.2.78.06,1.28-.22.81-.79,1.47-1.71,1.98.34.16.62.47.83.93.21.46.23,1,.06,1.64-.15.56-.43,1.1-.84,1.62-.41.52-.91.79-1.49.79-.77,0-1.28-.45-1.53-1.36ZM47.51,35.55c.28.7.69,1.05,1.24,1.05.45,0,.88-.24,1.29-.71.41-.48.67-.94.8-1.39.11-.42.08-.78-.1-1.07s-.43-.44-.76-.44l-.52.07c-.11,0-.2-.05-.25-.15-.05-.1-.06-.21-.03-.34.03-.12.09-.21.19-.29.09-.08.2-.11.32-.11.13,0,.26.04.4.13.13,0,.38-.24.74-.72.36-.48.6-.94.71-1.38.09-.35.1-.61.03-.77-.08-.17-.24-.25-.5-.25-.54,0-1.07.39-1.61,1.16-.54.78-.99,1.81-1.35,3.1l-.59,2.1Z"
            style="fill: #000; stroke-width: 0px;" />
        <path
            d="M51.01,39.54l.08-.3c.34-.15.64-.37.89-.65.25-.28.41-.53.47-.73.04-.16.04-.28,0-.34s-.18-.1-.4-.1c-.13,0-.22-.05-.28-.15-.06-.1-.06-.22-.02-.38.04-.16.14-.3.29-.42.15-.12.29-.18.42-.18.26,0,.45.12.58.34.13.23.15.5.07.83-.12.45-.4.89-.83,1.32-.43.43-.85.69-1.26.77Z"
            style="fill: #000; stroke-width: 0px;" />
        <path
            d="M57.47,33.33c.02-.3-.05-.58-.21-.82-.16-.24-.32-.36-.49-.36-.52,0-.86.3-1.02.9-.07.24-.04.45.09.61.13.17.34.33.65.49.7.39.96.93.77,1.64-.12.47-.37.85-.74,1.16-.37.31-.76.46-1.19.46-.51,0-.9-.12-1.17-.35l.3-1.52h.18c-.03.48.04.86.22,1.15.17.29.4.44.69.44.23,0,.45-.09.65-.28.21-.18.35-.41.42-.69.14-.51-.09-.92-.67-1.24-.41-.22-.69-.46-.82-.71-.14-.25-.16-.55-.06-.91.12-.46.36-.82.7-1.08.34-.26.74-.4,1.2-.4.41,0,.73.11.96.32l-.25,1.17h-.2Z"
            style="fill: #000; stroke-width: 0px;" />
        <rect x="29.15" y="27.33" width="15.02" height="13.63"
            style="fill: none; stroke: #000; stroke-miterlimit: 10; stroke-width: .1px;" />
        <polyline points="44.18 27.33 38.9 9.28 33.24 9.28 29.15 27.33"
            style="fill: none; stroke: #000; stroke-miterlimit: 10; stroke-width: .1px;" />
    </svg>
    <p>我们此时希望串<math>
            <mo>[</mo>
            <mn>γ</mn>
            <mn>δ</mn>
            <mo>]</mo>
        </math>的下一个符号是<math>
            <mi>first</mi>
            <mo>(</mo>
            <mi>β</mi>
            <mi>s</mi>
            <mo>)</mo>
        </math></p>
    <p>LR(1)项集族在构造时是往S0添加这样一项：<em>增广文法新增的这个产生式，圆点在最前面，逗号后面是输入结束终结符'$'</em>，后续方法和LR(0)一模一样,这里我就不多说了</p>
    <p>这次我们有这样一个文法:(前面LR(0)演示的文法有二义性，所以这里对文法做了一丢丢的改造)</p>
    <table>
        <thead>
            <tr>
                <th>产生式</th>
                <th>作用</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><math>
                        <mi>S'</mi>
                        <mo>→</mo>
                        <mi>E</mi>
                    </math></td>
                <td>增广文法新增的一个产生式</td>
            </tr>
            <tr>
                <td><math>
                        <mi>E</mi>
                        <mo>→</mo>
                        <mo>(</mo>
                        <mi>E</mi>
                        <mo>+</mo>
                        <mi>E</mi>
                        <mo>)</mo>
                    </math></td>
                <td>表达式+表达式还是一个表达式，而且必须用括号包裹，避免用户写"1+2+3"，只能写成"((1+2)+3)"或者"(1+(2+3))"，这样就不用纠结到底先算"1+2"还是"2+3"了</td>
            </tr>
            <tr>
                <td><math>
                        <mi>E</mi>
                        <mo>→</mo>
                        <mi>id</mi>
                    </math></td>
                <td>单个数字或者变量也是一个表达式</td>
            </tr>
        </tbody>
    </table>
    <p>我们构造一个LR(1)项集族:</p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
    <!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
    <!-- 由 Microsoft Visio, SVG Export 生成 绘图.svg 页-1 -->
    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
        xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:v="http://schemas.microsoft.com/visio/2003/SVGExtensions/"
        width="10.5334in" height="6.8543in" viewBox="0 0 758.407 493.51" xml:space="preserve"
        color-interpolation-filters="sRGB" class="st13">
        <style type="text/css">
            .st1 {
                fill: #ffffff;
                stroke: #000000;
                stroke-linecap: round;
                stroke-linejoin: round;
                stroke-width: 0.75
            }

            .st2 {
                fill: #000000;
                font-family: 宋体;
                font-size: 1.00001em
            }

            .st3 {
                font-family: Calibri;
                font-size: 1em
            }

            .st4 {
                fill: #000000;
                font-family: 等线;
                font-size: 1.00001em
            }

            .st5 {
                font-size: 1em
            }

            .st6 {
                fill: #ff0000;
                font-size: 1em
            }

            .st7 {
                marker-end: url(#mrkr4-20);
                stroke: #000000;
                stroke-linecap: round;
                stroke-linejoin: round;
                stroke-width: 0.75
            }

            .st8 {
                fill: #000000;
                fill-opacity: 1;
                stroke: #000000;
                stroke-opacity: 1;
                stroke-width: 0.22935779816514
            }

            .st9 {
                fill: #ffffff;
                stroke: none;
                stroke-linecap: butt
            }

            .st10 {
                fill: #000000;
                font-family: 宋体;
                font-size: 0.666664em
            }

            .st11 {
                fill: #ffffff;
                stroke: none;
                stroke-linecap: butt;
                stroke-width: 7.2
            }

            .st12 {
                marker-end: url(#mrkr4-218);
                stroke: #000000;
                stroke-linecap: round;
                stroke-linejoin: round;
                stroke-width: 0.75
            }

            .st13 {
                fill: none;
                fill-rule: evenodd;
                font-size: 12px;
                overflow: visible;
                stroke-linecap: square;
                stroke-miterlimit: 3
            }
        </style>
        <defs id="Markers">
            <g id="lend4">
                <path d="M 2 1 L 0 0 L 2 -1 L 2 1 " style="stroke:none" />
            </g>
            <marker id="mrkr4-20" class="st8" v:arrowType="4" v:arrowSize="2" v:setback="8.72" refX="-8.72"
                orient="auto" markerUnits="strokeWidth" overflow="visible">
                <use xlink:href="#lend4" transform="scale(-4.36,-4.36) " />
            </marker>
            <marker id="mrkr4-218" class="st8" v:arrowType="4" v:arrowSize="2" v:setback="0" refX="-0" orient="auto"
                markerUnits="strokeWidth" overflow="visible">
                <use xlink:href="#lend4" transform="scale(-4.36,-4.36) " />
            </marker>
        </defs>
        <g v:mID="0" v:index="1" v:groupContext="foregroundPage">
            <title>页-1</title>
            <g id="shape47-1" v:mID="47" v:groupContext="shape" transform="translate(61.7017,-461.714)">
                <title>工作表.47</title>
                <desc>S0</desc>
                <rect x="0" y="481.037" width="66.6142" height="12.4724" class="st1" />
                <text x="27.27" y="491.27" class="st2" v:langID="2052">
                    S<tspan class="st3" v:langID="1033">0</tspan>
                </text>
            </g>
            <g id="shape48-5" v:mID="48" v:groupContext="shape" transform="translate(61.7017,-411.824)">
                <title>工作表.48</title>
                <desc>S&#39;→.E,$ E→.(E+E),$ E→.id,$</desc>
                <rect x="0" y="443.62" width="66.6142" height="49.8898" class="st1" />
                <text x="4" y="457.76" class="st4" v:langID="1033">
                    S&#39;<tspan class="st5" v:langID="2052">→</tspan>.E,$
                    <tspan x="4" dy="1.2em" class="st6">E</tspan>
                    <tspan class="st6" v:langID="2052">→</tspan>
                    <tspan class="st6">.(E+E),$
                    </tspan>
                    <tspan x="4" dy="1.2em" class="st6">E</tspan>
                    <tspan class="st6" v:langID="2052">→</tspan>
                    <tspan class="st6">.id,$</tspan>
                </text>
            </g>
            <g id="shape56-15" v:mID="56" v:groupContext="shape" v:layerMember="0"
                transform="translate(128.316,-451.863)">
                <title>动态连接线</title>
                <desc>E</desc>
                <path d="M0 486.42 C14.95 486.42 43.11 486.42 61.14 486.42" class="st7" />
                <rect v:rectContext="textBkgnd" x="5.08662" y="475.458" width="4.00012" height="9.59985" class="st9" />
                <text x="5.09" y="482.66" class="st10" v:langID="1033">
                    E
                </text>
            </g>
            <g id="shape68-23" v:mID="68" v:groupContext="shape" v:layerMember="0"
                transform="translate(87.9222,-411.824)">
                <title>动态连接线.68</title>
                <desc>(</desc>
                <path d="M7.09 493.51 L7.09 545.93" class="st7" />
                <rect v:rectContext="textBkgnd" x="11.9606" y="518.049" width="4.00012" height="9.59985" class="st11" />
                <text x="11.96" y="525.25" class="st10" v:langID="1033">(
                </text>
            </g>
            <g id="shape53-30" v:mID="53" v:groupContext="shape" transform="translate(195.993,-461.714)">
                <title>工作表.53</title>
                <desc>S1</desc>
                <rect x="0" y="481.037" width="66.6142" height="12.4724" class="st1" />
                <text x="27.27" y="491.27" class="st2" v:langID="2052">S<tspan class="st3" v:langID="1033">1</tspan>
                </text>
            </g>
            <g id="shape54-34" v:mID="54" v:groupContext="shape" transform="translate(195.993,-443.714)">
                <title>工作表.54</title>
                <desc>S&#39;→E.,$</desc>
                <rect x="0" y="475.51" width="66.6142" height="18" class="st1" />
                <text x="4" y="488.11" class="st4" v:langID="1033">
                    S&#39;<tspan class="st5" v:langID="2052">→</tspan>E.,$
                </text>
            </g>
            <g id="shape57-38" v:mID="57" v:groupContext="shape" transform="translate(61.7017,-340.391)">
                <title>工作表.57</title>
                <desc>S2</desc>
                <rect x="0" y="481.037" width="66.6142" height="12.4724" class="st1" />
                <text x="27.27" y="491.27" class="st2" v:langID="2052">
                    S<tspan class="st3" v:langID="1033">2</tspan>
                </text>
            </g>
            <g id="shape58-42" v:mID="58" v:groupContext="shape" transform="translate(61.7017,-292.06)">
                <title>工作表.58</title>
                <desc>E→(.E+E),$ E→.(E+E),+ E→.id,+</desc>
                <rect x="0" y="445.179" width="66.6142" height="48.3307" class="st1" />
                <text x="4" y="458.54" class="st4" v:langID="1033">
                    E<tspan class="st5" v:langID="2052">→</tspan>(.E+E),$
                    <tspan x="4" dy="1.2em" class="st6">E</tspan>
                    <tspan class="st6" v:langID="2052">→</tspan>
                    <tspan class="st6">.(E+E),+
                    </tspan>
                    <tspan x="4" dy="1.2em" class="st6">E</tspan>
                    <tspan class="st6" v:langID="2052">→</tspan>
                    <tspan class="st6">.id,+</tspan>
                </text>
            </g>
            <g id="shape79-52" v:mID="79" v:groupContext="shape" v:layerMember="0"
                transform="translate(128.316,-310.627)">
                <title>动态连接线.79</title>
                <desc>E</desc>
                <path d="M0 486.42 L61.14 486.42" class="st7" />
                <rect v:rectContext="textBkgnd" x="5.08662" y="473.119" width="4.00012" height="9.59985" class="st9" />
                <text x="5.09" y="480.32" class="st10" v:langID="1033">
                    E
                </text>
            </g>
            <g id="shape76-59" v:mID="76" v:groupContext="shape" transform="translate(195.993,-329.194)">
                <title>工作表.76</title>
                <desc>S5</desc>
                <rect x="0" y="481.037" width="66.6142" height="12.4724" class="st1" />
                <text x="27.27" y="491.27" class="st2" v:langID="2052">
                    S<tspan class="st3" v:langID="1033">5</tspan>
                </text>
            </g>
            <g id="shape77-63" v:mID="77" v:groupContext="shape" transform="translate(195.993,-306.233)">
                <title>工作表.77</title>
                <desc>E→(E.+E),$</desc>
                <rect x="0" y="470.549" width="66.6142" height="22.9606" class="st1" />
                <text x="4" y="485.63" class="st4" v:langID="1033">
                    E<tspan class="st5" v:langID="2052">→</tspan>(E<tspan class="st5" v:langID="2052">.
                    </tspan>+E),$
                </text>
            </g>
            <g id="shape69-68" v:mID="69" v:groupContext="shape" transform="translate(195.993,-392.973)">
                <title>工作表.69</title>
                <desc>S3</desc>
                <rect x="0" y="481.037" width="66.6142" height="12.4724" class="st1" />
                <text x="27.27" y="491.27" class="st2" v:langID="2052">
                    S<tspan class="st3" v:langID="1033">3</tspan>
                </text>
            </g>
            <g id="shape70-72" v:mID="70" v:groupContext="shape" transform="translate(195.993,-374.973)">
                <title>工作表.70</title>
                <desc>E→id.,$</desc>
                <rect x="0" y="475.51" width="66.6142" height="18" class="st1" />
                <text x="4" y="488.11" class="st4" v:langID="1033">
                    E<tspan class="st5" v:langID="2052">→</tspan>id.,$
                </text>
            </g>
            <g id="shape83-76" v:mID="83" v:groupContext="shape" v:layerMember="0"
                transform="translate(128.316,-434.501)">
                <title>动态连接线.83</title>
                <desc>id</desc>
                <path d="M0 493.51 L93.37 493.51 A8.50394 8.50394 0 0 1 101.87 502.01 L101.87 516.02" class="st7" />
                <rect v:rectContext="textBkgnd" x="2.51963" y="495.513" width="8.00024" height="9.59985" class="st11" />
                <text x="2.52" y="502.71" class="st10" v:langID="1033">
                    id
                </text>
            </g>
            <g id="shape85-83" v:mID="85" v:groupContext="shape" transform="translate(325.678,-341.879)">
                <title>工作表.85</title>
                <desc>S8</desc>
                <rect x="0" y="481.037" width="66.6142" height="12.4724" class="st1" />
                <text x="27.27" y="491.27" class="st2" v:langID="2052">
                    S<tspan class="st3" v:langID="1033">8</tspan>
                </text>
            </g>
            <g id="shape86-87" v:mID="86" v:groupContext="shape" transform="translate(325.678,-293.548)">
                <title>工作表.86</title>
                <desc>E→(E+.E),$ E→.(E+E),) E→.id,)</desc>
                <rect x="0" y="445.179" width="66.6142" height="48.3307" class="st1" />
                <text x="4" y="458.54" class="st4" v:langID="1033">
                    E<tspan class="st5" v:langID="2052">→</tspan>(E+.E),$
                    <tspan x="4" dy="1.2em" class="st6">E</tspan>
                    <tspan class="st6" v:langID="2052">→</tspan>
                    <tspan class="st6">.(E+E),)
                    </tspan>
                    <tspan x="4" dy="1.2em" class="st6">E</tspan>
                    <tspan class="st6" v:langID="2052">→</tspan>
                    <tspan class="st6">.id,)</tspan>
                </text>
            </g>
            <g id="shape91-97" v:mID="91" v:groupContext="shape" v:layerMember="0"
                transform="translate(262.607,-310.627)">
                <title>动态连接线.91</title>
                <desc>+</desc>
                <path d="M0 486.42 L8.27 486.42 A2.3622 2.3622 0 1 1 12.99 486.42 L56.53 486.42" class="st7" />
                <rect v:rectContext="textBkgnd" x="27.1969" y="476.096" width="4.00012" height="9.59985" class="st11" />
                <text x="27.2" y="483.3" class="st10" v:langID="1033">
                    +
                </text>
            </g>
            <g id="shape94-104" v:mID="94" v:groupContext="shape" transform="translate(61.7017,-224.95)">
                <title>工作表.94</title>
                <desc>S4</desc>
                <rect x="0" y="481.037" width="66.6142" height="12.4724" class="st1" />
                <text x="27.27" y="491.27" class="st2" v:langID="2052">
                    S<tspan class="st3" v:langID="1033">4</tspan>
                </text>
            </g>
            <g id="shape95-108" v:mID="95" v:groupContext="shape" transform="translate(61.7017,-176.619)">
                <title>工作表.95</title>
                <desc>E→(.E+E),+ E→.(E+E),+ E→.id,+</desc>
                <rect x="0" y="445.179" width="66.6142" height="48.3307" class="st1" />
                <text x="4" y="458.54" class="st4" v:langID="1033">
                    E<tspan class="st5" v:langID="2052">→</tspan>(.E+E),+
                    <tspan x="4" dy="1.2em" class="st6">E</tspan>
                    <tspan class="st6" v:langID="2052">→</tspan>
                    <tspan class="st6">.(E+E),+
                    </tspan>
                    <tspan x="4" dy="1.2em" class="st6">E</tspan>
                    <tspan class="st6" v:langID="2052">→</tspan>
                    <tspan class="st6">.id,+</tspan>
                </text>
            </g>
            <g id="shape96-118" v:mID="96" v:groupContext="shape" v:layerMember="0"
                transform="translate(85.0285,-292.06)">
                <title>动态连接线.96</title>
                <desc>(</desc>
                <path d="M7.09 493.51 L7.09 541.61" class="st7" />
                <rect v:rectContext="textBkgnd" x="-1.23228" y="501.891" width="4.00012" height="9.59985"
                    class="st11" />
                <text x="-1.23" y="509.09" class="st10" v:langID="1033">
                    (
                </text>
            </g>
            <g id="shape98-125" v:mID="98" v:groupContext="shape" transform="translate(195.993,-260.454)">
                <title>工作表.98</title>
                <desc>S6</desc>
                <rect x="0" y="481.037" width="66.6142" height="12.4724" class="st1" />
                <text x="27.27" y="491.27" class="st2" v:langID="2052">
                    S<tspan class="st3" v:langID="1033">6</tspan>
                </text>
            </g>
            <g id="shape99-129" v:mID="99" v:groupContext="shape" transform="translate(195.993,-242.454)">
                <title>工作表.99</title>
                <desc>E→id.,+</desc>
                <rect x="0" y="475.51" width="66.6142" height="18" class="st1" />
                <text x="4" y="488.11" class="st4" v:langID="1033">
                    E<tspan class="st5" v:langID="2052">→</tspan>id.,+
                </text>
            </g>
            <g id="shape103-133" v:mID="103" v:groupContext="shape" v:layerMember="0"
                transform="translate(111.662,-292.06)">
                <title>动态连接线.103</title>
                <desc>id</desc>
                <path d="M0 493.51 L0 525.61 A8.50394 8.50394 -180 0 0 8.5 534.12 L77.79 534.12" class="st7" />
                <rect v:rectContext="textBkgnd" x="2.73222" y="494.805" width="8.00024" height="9.59985" class="st11" />
                <text x="2.73" y="502" class="st10" v:langID="1033">
                    id
                </text>
            </g>
            <g id="shape104-140" v:mID="104" v:groupContext="shape" transform="translate(195.993,-203.548)">
                <title>工作表.104</title>
                <desc>S7</desc>
                <rect x="0" y="481.037" width="66.6142" height="12.4724" class="st1" />
                <text x="27.27" y="491.27" class="st2" v:langID="2052">
                    S<tspan class="st3" v:langID="1033">7</tspan>
                </text>
            </g>
            <g id="shape105-144" v:mID="105" v:groupContext="shape" transform="translate(195.993,-185.548)">
                <title>工作表.105</title>
                <desc>E→(E.+E),+</desc>
                <rect x="0" y="475.51" width="66.6142" height="18" class="st1" />
                <text x="4" y="488.11" class="st4" v:langID="1033">
                    E<tspan class="st5" v:langID="2052">→</tspan>(E.+E),+
                </text>
            </g>
            <g id="shape107-148" v:mID="107" v:groupContext="shape" v:layerMember="0"
                transform="translate(128.316,-187.462)">
                <title>动态连接线.107</title>
                <desc>E</desc>
                <path d="M0 486.42 L61.14 486.42" class="st7" />
                <rect v:rectContext="textBkgnd" x="32.2284" y="476.238" width="4.00012" height="9.59985" class="st11" />
                <text x="32.23" y="483.44" class="st10" v:langID="1033">
                    E
                </text>
            </g>
            <g id="shape114-155" v:mID="114" v:groupContext="shape" v:layerMember="0"
                transform="translate(54.6151,-214.107)">
                <title>动态连接线.114</title>
                <desc>(</desc>
                <path d="M7.09 493.51 L-38.8 493.51 A8.50394 8.50394 -180 0 0 -47.3 502.01 L-47.3 510.1 A8.50394 8.50394 -180 0 0 -38.8
                             518.61 L0.55 518.61" class="st7" />
                <rect v:rectContext="textBkgnd" x="-21.6299" y="481.623" width="4.00012" height="9.59985"
                    class="st11" />
                <text x="-21.63" y="488.82" class="st10" v:langID="1033">
                    (
                </text>
            </g>
            <g id="shape115-162" v:mID="115" v:groupContext="shape" transform="translate(325.678,-246.21)">
                <title>工作表.115</title>
                <desc>S11</desc>
                <rect x="0" y="481.037" width="66.6142" height="12.4724" class="st1" />
                <text x="24.23" y="491.27" class="st2" v:langID="2052">
                    S<tspan class="st3" v:langID="1033">11</tspan>
                </text>
            </g>
            <g id="shape116-166" v:mID="116" v:groupContext="shape" transform="translate(325.678,-223.249)">
                <title>工作表.116</title>
                <desc>E→(E+E.),$</desc>
                <rect x="0" y="470.549" width="66.6142" height="22.9606" class="st1" />
                <text x="4" y="485.63" class="st4" v:langID="1033">
                    E<tspan class="st5" v:langID="2052">→</tspan>(E+E.),$
                </text>
            </g>
            <g id="shape119-170" v:mID="119" v:groupContext="shape" v:layerMember="0"
                transform="translate(351.899,-293.548)">
                <title>动态连接线.119</title>
                <desc>E</desc>
                <path d="M7.09 493.51 L7.09 521.84" class="st7" />
                <rect v:rectContext="textBkgnd" x="12.1732" y="507.206" width="4.00012" height="9.59985" class="st11" />
                <text x="12.17" y="514.41" class="st10" v:langID="1033">
                    E
                </text>
            </g>
            <g id="shape120-177" v:mID="120" v:groupContext="shape" transform="translate(458.906,-341.879)">
                <title>工作表.120</title>
                <desc>S10</desc>
                <rect x="0" y="481.037" width="66.6142" height="12.4724" class="st1" />
                <text x="24.23" y="491.27" class="st2" v:langID="2052">
                    S<tspan class="st3" v:langID="1033">10</tspan>
                </text>
            </g>
            <g id="shape121-181" v:mID="121" v:groupContext="shape" transform="translate(458.906,-293.548)">
                <title>工作表.121</title>
                <desc>E→(.E+E),) E→.(E+E),+ E→.id,+</desc>
                <rect x="0" y="445.179" width="66.6142" height="48.3307" class="st1" />
                <text x="4" y="458.54" class="st4" v:langID="1033">
                    E<tspan class="st5" v:langID="2052">→</tspan>(.E+E),)
                    <tspan x="4" dy="1.2em" class="st6">E</tspan>
                    <tspan class="st6" v:langID="2052">→</tspan>
                    <tspan class="st6">.(E+E),+
                    </tspan>
                    <tspan x="4" dy="1.2em" class="st6">E</tspan>
                    <tspan class="st6" v:langID="2052">→</tspan>
                    <tspan class="st6">.id,+</tspan>
                </text>
            </g>
            <g id="shape124-191" v:mID="124" v:groupContext="shape" v:layerMember="0"
                transform="translate(392.292,-318.44)">
                <title>动态连接线.124</title>
                <desc>(</desc>
                <path d="M0 486.42 L60.07 486.42" class="st7" />
                <rect v:rectContext="textBkgnd" x="31.3071" y="474.679" width="4.00012" height="9.59985" class="st11" />
                <text x="31.31" y="481.88" class="st10" v:langID="1033">
                    (
                </text>
            </g>
            <g id="shape125-198" v:mID="125" v:groupContext="shape" transform="translate(458.906,-239.194)">
                <title>工作表.125</title>
                <desc>S12</desc>
                <rect x="0" y="481.037" width="66.6142" height="12.4724" class="st1" />
                <text x="24.23" y="491.27" class="st2" v:langID="2052">
                    S<tspan class="st3" v:langID="1033">12</tspan>
                </text>
            </g>
            <g id="shape126-202" v:mID="126" v:groupContext="shape" transform="translate(458.906,-221.194)">
                <title>工作表.126</title>
                <desc>E→id.,)</desc>
                <rect x="0" y="475.51" width="66.6142" height="18" class="st1" />
                <text x="4" y="488.11" class="st4" v:langID="1033">
                    E<tspan class="st5" v:langID="2052">→</tspan>id.,)
                </text>
            </g>
            <g id="shape128-206" v:mID="128" v:groupContext="shape" v:layerMember="0"
                transform="translate(392.292,-305.631)">
                <title>动态连接线.128</title>
                <desc>id</desc>
                <path d="M0 493.51 L21.97 493.51 A8.50394 8.50394 0 0 1 30.47 502.01 L30.47 560.44 A8.50394 8.50394 -180 0 0 38.98 568.95
                             L60.07 568.95" class="st7" />
                <rect v:rectContext="textBkgnd" x="33.559" y="530.627" width="8.00024" height="9.59985" class="st11" />
                <text x="33.56" y="537.83" class="st10" v:langID="1033">
                    id
                </text>
            </g>
            <g id="shape130-213" v:mID="130" v:groupContext="shape" v:layerMember="0"
                transform="translate(128.316,-229.733)">
                <title>动态连接线.130</title>
                <desc>id</desc>
                <path d="M0 492.06 L95.35 492.06 A5.63386 5.63386 -180 0 0 100.98 486.42 L100.98 480.79" class="st12" />
                <rect v:rectContext="textBkgnd" x="49.5039" y="478.824" width="8.00024" height="9.59985" class="st9" />
                <text x="49.5" y="486.02" class="st10" v:langID="1033">
                    id
                </text>
            </g>
            <g id="shape131-221" v:mID="131" v:groupContext="shape" transform="translate(325.678,-162.658)">
                <title>工作表.131</title>
                <desc>S15</desc>
                <rect x="0" y="481.037" width="66.6142" height="12.4724" class="st1" />
                <text x="24.23" y="491.27" class="st2" v:langID="2052">
                    S<tspan class="st3" v:langID="1033">15</tspan>
                </text>
            </g>
            <g id="shape132-225" v:mID="132" v:groupContext="shape" transform="translate(325.678,-139.698)">
                <title>工作表.132</title>
                <desc>E→(E+E).,$</desc>
                <rect x="0" y="470.549" width="66.6142" height="22.9606" class="st1" />
                <text x="4" y="485.63" class="st4" v:langID="1033">
                    E<tspan class="st5" v:langID="2052">→</tspan>(E+E).,$
                </text>
            </g>
            <g id="shape134-229" v:mID="134" v:groupContext="shape" v:layerMember="0"
                transform="translate(351.899,-223.249)">
                <title>动态连接线.134</title>
                <desc>)</desc>
                <path d="M7.09 493.51 L7.09 535.09" class="st7" />
                <rect v:rectContext="textBkgnd" x="15.0079" y="514.86" width="4.00012" height="9.59985" class="st11" />
                <text x="15.01" y="522.06" class="st10" v:langID="1033">
                    )
                </text>
            </g>
            <g id="shape135-236" v:mID="135" v:groupContext="shape" transform="translate(195.993,-120.706)">
                <title>工作表.135</title>
                <desc>S9</desc>
                <rect x="0" y="481.037" width="66.6142" height="12.4724" class="st1" />
                <text x="27.27" y="491.27" class="st2" v:langID="2052">
                    S<tspan class="st3" v:langID="1033">9</tspan>
                </text>
            </g>
            <g id="shape136-240" v:mID="136" v:groupContext="shape" transform="translate(195.993,-72.375)">
                <title>工作表.136</title>
                <desc>E→(E+.E),+ E→.(E+E),) E→.id,)</desc>
                <rect x="0" y="445.179" width="66.6142" height="48.3307" class="st1" />
                <text x="4" y="458.54" class="st4" v:langID="1033">
                    E<tspan class="st5" v:langID="2052">→</tspan>(E+.E),+
                    <tspan x="4" dy="1.2em" class="st6">E</tspan>
                    <tspan class="st6" v:langID="2052">→</tspan>
                    <tspan class="st6">.(E+E),)
                    </tspan>
                    <tspan x="4" dy="1.2em" class="st6">E</tspan>
                    <tspan class="st6" v:langID="2052">→</tspan>
                    <tspan class="st6">.id,)</tspan>
                </text>
            </g>
            <g id="shape138-250" v:mID="138" v:groupContext="shape" v:layerMember="0"
                transform="translate(222.214,-185.548)">
                <title>动态连接线.138</title>
                <desc>+</desc>
                <path d="M7.09 493.51 L7.09 539.34" class="st7" />
                <rect v:rectContext="textBkgnd" x="14.2992" y="514.009" width="4.00012" height="9.59985" class="st11" />
                <text x="14.3" y="521.21" class="st10" v:langID="1033">
                    +
                </text>
            </g>
            <g id="shape161-257" v:mID="161" v:groupContext="shape" v:layerMember="0"
                transform="translate(492.993,-354.351)">
                <title>动态连接线.161</title>
                <desc>(</desc>
                <path d="M0 493.51 L0 370.17 A8.50394 8.50394 -180 0 0 -8.5 361.66 L-474.52 361.66 A8.50394 8.50394 -180 0 0 -483.02
                             370.17 L-483.02 608.88 A8.50394 8.50394 -180 0 0 -474.52 617.38 L-437.83 617.38"
                    class="st7" />
                <rect v:rectContext="textBkgnd" x="3.95274" y="439.45" width="4.00012" height="9.59985" class="st11" />
                <text x="3.95" y="446.65" class="st10" v:langID="1033">
                    (
                </text>
            </g>
            <g id="shape163-264" v:mID="163" v:groupContext="shape" v:layerMember="0"
                transform="translate(479.387,-354.351)">
                <title>动态连接线.163</title>
                <desc>id</desc>
                <path d="M0 493.51 L0 464.38 A8.50394 8.50394 -180 0 0 -8.5 455.88 L-197.65 455.88 A8.50394 8.50394 -180 0 0 -206.15
                             464.38 L-206.15 591.09 A5.31496 5.31496 0 0 1 -211.46 596.41 L-216.78 596.41"
                    class="st12" />
                <rect v:rectContext="textBkgnd" x="-14.2048" y="472.34" width="8.00024" height="9.59985" class="st9" />
                <text x="-14.2" y="479.54" class="st10" v:langID="1033">
                    id
                </text>
            </g>
            <g id="shape170-271" v:mID="170" v:groupContext="shape" v:layerMember="0"
                transform="translate(195.993,-83.2175)">
                <title>动态连接线.170</title>
                <desc>E</desc>
                <path d="M0 486.42 L-61.14 486.42" class="st7" />
                <rect v:rectContext="textBkgnd" x="-35.0782" y="489.915" width="4.00012" height="9.59985"
                    class="st11" />
                <text x="-35.08" y="497.11" class="st10" v:langID="1033">
                    E
                </text>
            </g>
            <g id="shape181-278" v:mID="181" v:groupContext="shape" v:layerMember="0"
                transform="translate(262.607,-96.5403)">
                <title>动态连接线.181</title>
                <desc>id</desc>
                <path d="M0 493.51 L221.1 493.51 A8.50394 8.50394 -180 0 0 229.61 485.01 L229.61 375.4" class="st7" />
                <rect v:rectContext="textBkgnd" x="20.4264" y="499.234" width="8.00024" height="9.59985" class="st11" />
                <text x="20.43" y="506.43" class="st10" v:langID="1033">
                    id
                </text>
            </g>
            <g id="shape182-285" v:mID="182" v:groupContext="shape" v:layerMember="0"
                transform="translate(228.662,-72.375)">
                <title>动态连接线.182</title>
                <desc>(</desc>
                <path d="M0 493.51 L0 507.64 A8.50394 8.50394 -180 0 0 8.5 516.14 L324.73 516.14 A8.50394 8.50394 -180 0 0 333.24 507.64
                             L333.24 268.58 A8.50394 8.50394 -180 0 0 324.73 260.08 L303.4 260.08" class="st7" />
                <rect v:rectContext="textBkgnd" x="-13.0551" y="501.276" width="4.00012" height="9.59985" class="st9" />
                <text x="-13.06" y="508.48" class="st10" v:langID="1033">
                    (
                </text>
            </g>
            <g id="shape183-292" v:mID="183" v:groupContext="shape" v:layerMember="0"
                transform="translate(525.521,-309.068)">
                <title>动态连接线.183</title>
                <desc>E</desc>
                <path d="M0 486.42 L49.09 486.42" class="st7" />
                <rect v:rectContext="textBkgnd" x="5.32462" y="470.852" width="4.00012" height="9.59985" class="st11" />
                <text x="5.32" y="478.05" class="st10" v:langID="1033">
                    E
                </text>
            </g>
            <g id="shape165-299" v:mID="165" v:groupContext="shape" transform="translate(61.7017,-99.3041)">
                <title>工作表.165</title>
                <desc>S13</desc>
                <rect x="0" y="481.037" width="66.6142" height="12.4724" class="st1" />
                <text x="24.23" y="491.27" class="st2" v:langID="2052">
                    S<tspan class="st3" v:langID="1033">13</tspan>
                </text>
            </g>
            <g id="shape166-303" v:mID="166" v:groupContext="shape" transform="translate(61.7017,-81.3041)">
                <title>工作表.166</title>
                <desc>E→(E+E.),+</desc>
                <rect x="0" y="475.51" width="66.6142" height="18" class="st1" />
                <text x="4" y="488.11" class="st4" v:langID="1033">
                    E<tspan class="st5" v:langID="2052">→</tspan>(E+E.),+
                </text>
            </g>
            <g id="shape187-307" v:mID="187" v:groupContext="shape" transform="translate(61.7017,-18.375)">
                <title>工作表.187</title>
                <desc>S16</desc>
                <rect x="0" y="481.037" width="66.6142" height="12.4724" class="st1" />
                <text x="24.23" y="491.27" class="st2" v:langID="2052">
                    S<tspan class="st3" v:langID="1033">16</tspan>
                </text>
            </g>
            <g id="shape188-311" v:mID="188" v:groupContext="shape" transform="translate(61.7017,-0.375)">
                <title>工作表.188</title>
                <desc>E→(E+E).,+</desc>
                <rect x="0" y="475.51" width="66.6142" height="18" class="st1" />
                <text x="4" y="488.11" class="st4" v:langID="1033">
                    E<tspan class="st5" v:langID="2052">→</tspan>(E+E).,+
                </text>
            </g>
            <g id="shape189-315" v:mID="189" v:groupContext="shape" v:layerMember="0"
                transform="translate(87.9222,-81.3041)">
                <title>动态连接线.189</title>
                <desc>)</desc>
                <path d="M7.09 493.51 L7.09 537.43" class="st7" />
                <rect v:rectContext="textBkgnd" x="14.2992" y="510.82" width="4.00012" height="9.59985" class="st11" />
                <text x="14.3" y="518.02" class="st10" v:langID="1033">
                    )
                </text>
            </g>
            <g id="shape190-322" v:mID="190" v:groupContext="shape" transform="translate(581.151,-239.194)">
                <title>工作表.190</title>
                <desc>S17</desc>
                <rect x="0" y="481.037" width="66.6142" height="12.4724" class="st1" />
                <text x="24.23" y="491.27" class="st2" v:langID="2052">
                    S<tspan class="st3" v:langID="1033">17</tspan>
                </text>
            </g>
            <g id="shape191-326" v:mID="191" v:groupContext="shape" transform="translate(581.151,-190.863)">
                <title>工作表.191</title>
                <desc>E→(E+.E),) E→.(E+E),) E→.id,)</desc>
                <rect x="0" y="445.179" width="66.6142" height="48.3307" class="st1" />
                <text x="4" y="458.54" class="st4" v:langID="1033">
                    E→(E+.E),)
                    <tspan x="4" dy="1.2em" class="st6">E</tspan>
                    <tspan class="st6">→.(</tspan>
                    <tspan class="st6">E+E),)
                    </tspan>
                    <tspan x="4" dy="1.2em" class="st6">E</tspan>
                    <tspan class="st6">→.</tspan>
                    <tspan class="st6">id,)</tspan>
                </text>
            </g>
            <g id="shape193-335" v:mID="193" v:groupContext="shape" v:layerMember="0"
                transform="translate(607.371,-299.997)">
                <title>动态连接线.193</title>
                <desc>+</desc>
                <path d="M7.09 493.51 L7.09 535.3" class="st7" />
                <rect v:rectContext="textBkgnd" x="10.7559" y="514.08" width="4.00012" height="9.59985" class="st11" />
                <text x="10.76" y="521.28" class="st10" v:langID="1033">
                    +
                </text>
            </g>
            <g id="shape140-342" v:mID="140" v:groupContext="shape" transform="translate(581.151,-322.958)">
                <title>工作表.140</title>
                <desc>S14</desc>
                <rect x="0" y="481.037" width="66.6142" height="12.4724" class="st1" />
                <text x="24.23" y="491.27" class="st2" v:langID="2052">
                    S<tspan class="st3" v:langID="1033">14</tspan>
                </text>
            </g>
            <g id="shape141-346" v:mID="141" v:groupContext="shape" transform="translate(581.151,-299.997)">
                <title>工作表.141</title>
                <desc>E→(E.+E),)</desc>
                <rect x="0" y="470.549" width="66.6142" height="22.9606" class="st1" />
                <text x="4" y="485.63" class="st4" v:langID="1033">
                    E<tspan class="st5" v:langID="2052">→</tspan>(E.+E),)
                </text>
            </g>
            <g id="shape197-350" v:mID="197" v:groupContext="shape" transform="translate(581.151,-110.501)">
                <title>工作表.197</title>
                <desc>S19</desc>
                <rect x="0" y="481.037" width="66.6142" height="12.4724" class="st1" />
                <text x="24.23" y="491.27" class="st2" v:langID="2052">
                    S<tspan class="st3" v:langID="1033">19</tspan>
                </text>
            </g>
            <g id="shape198-354" v:mID="198" v:groupContext="shape" transform="translate(581.151,-87.5404)">
                <title>工作表.198</title>
                <desc>E→(E+E).,)</desc>
                <rect x="0" y="470.549" width="66.6142" height="22.9606" class="st1" />
                <text x="4" y="485.63" class="st4" v:langID="1033">
                    E→(E+E).,)
                </text>
            </g>
            <g id="shape200-357" v:mID="200" v:groupContext="shape" transform="translate(691.418,-226.721)">
                <title>工作表.200</title>
                <desc>S18</desc>
                <rect x="0" y="481.037" width="66.6142" height="12.4724" class="st1" />
                <text x="24.23" y="491.27" class="st2" v:langID="2052">
                    S<tspan class="st3" v:langID="1033">18</tspan>
                </text>
            </g>
            <g id="shape201-361" v:mID="201" v:groupContext="shape" transform="translate(691.418,-203.761)">
                <title>工作表.201</title>
                <desc>E→(E+E.),)</desc>
                <rect x="0" y="470.549" width="66.6142" height="22.9606" class="st1" />
                <text x="4" y="485.63" class="st4" v:langID="1033">
                    E→(E+E.),)
                </text>
            </g>
            <g id="shape202-364" v:mID="202" v:groupContext="shape" v:layerMember="0"
                transform="translate(647.765,-208.155)">
                <title>动态连接线.202</title>
                <desc>E</desc>
                <path d="M0 486.42 L37.11 486.42" class="st7" />
                <rect v:rectContext="textBkgnd" x="21.3858" y="474.679" width="4.00012" height="9.59985" class="st11" />
                <text x="21.39" y="481.88" class="st10" v:langID="1033">
                    E
                </text>
            </g>
            <g id="shape203-371" v:mID="203" v:groupContext="shape" v:layerMember="0"
                transform="translate(607.371,-190.863)">
                <title>动态连接线.203</title>
                <desc>)</desc>
                <path d="M7.09 493.51 L7.09 554.86" class="st7" />
                <rect v:rectContext="textBkgnd" x="12.1732" y="524.001" width="4.00012" height="9.59985" class="st11" />
                <text x="12.17" y="531.2" class="st10" v:langID="1033">
                    )
                </text>
            </g>
        </g>
    </svg>
    <p>LR(1)项集族使用方法和LR(0)几乎一致，唯一不同点就是LR(0)是圆点在产生式最后面则直接规约，LR(1)则新增一个一个要求，变成这样</p>
    <ol>
        <li>圆点在产生式的最后面</li>
        <li>且输入队列的下一个符号是项中逗号后面的这个符号</li>
    </ol>
    <p>接下来我们就分析一下:"(1+2)"是怎么生成语法树的，输入串太长手写很累，就缩短一些了</p>
    <table id="lr_0_table">
        <thead>
            <tr>
                <th>步骤</th>
                <th>栈</th>
                <th>输入</th>
                <th>动作</th>
                <th>AST</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>1</td>
                <td>s0(nil)</td>
                <td>( 1(id) + 2(id) )</td>
                <td>S0可以通过(移入S2，输入移除一个元素，状态栈压入s2，把(挂入栈顶</td>
                <td></td>
            </tr>

            <tr>
                <td>2</td>
                <td>s0(nil) s2('(')</td>
                <td>1(id) + 2(id) )</td>
                <td>S2可以通过id移入S6，输入移除一个元素，状态栈压入s6，把id挂入栈顶</td>
                <td></td>
            </tr>
            <tr>
                <td>3</td>
                <td>s0(nil) s2('(') s6(1)</td>
                <td> + 2(id) )</td>
                <td>S6遇到符号'+'，进行规约，并且把规约出来的这个符号退回输入队列</td>
                <td><svg style="width: 30px;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 21.7 57">
                        <text transform="translate(8.42 50.26)"
                            style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                            <tspan x="0" y="0">1</tspan>
                        </text>
                        <circle cx="11.2" cy="46.5" r="10" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <text transform="translate(7.12 14.26)"
                            style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                            <tspan x="0" y="0">E</tspan>
                        </text>
                        <circle cx="10.5" cy="10.5" r="10" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <line x1="10.5" y1="23.5" x2="10.5" y2="33.5"
                            style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                    </svg></td>
            </tr>
            <tr>
                <td>4</td>
                <td>s0(nil) s2('(')</td>
                <td>E + 2(id) )</td>
                <td>移入S5</td>
                <td></td>
            </tr>
            <tr>
                <td>5</td>
                <td>s0(nil) s2('(') s5(E1)</td>
                <td> + 2(id) )</td>
                <td>sS8(后面就用s表示shift,r表示reduce)</td>
                <td></td>
            </tr>
            <tr>
                <td>6</td>
                <td>s0(nil) s2('(') s5(E1) s8(+)</td>
                <td>2(id) )</td>
                <td>sS12</td>
                <td></td>
            </tr>
            <tr>
                <td>7</td>
                <td>s0(nil) s2('(') s5(E1) s8(+) s12(2)</td>
                <td>)</td>
                <td>r(E→id)</td>
                <td><svg style="width: 30px;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 21.7 57">
                        <text transform="translate(8.42 50.26)"
                            style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                            <tspan x="0" y="0">2</tspan>
                        </text>
                        <circle cx="11.2" cy="46.5" r="10" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <text transform="translate(7.12 14.26)"
                            style="fill: #000; font-family: DengXian, DengXian; font-size: 12px;">
                            <tspan x="0" y="0">E</tspan>
                        </text>
                        <circle cx="10.5" cy="10.5" r="10" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <line x1="10.5" y1="23.5" x2="10.5" y2="33.5"
                            style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                    </svg></td>
            </tr>
            <tr>
                <td>8</td>
                <td>s0(nil) s2('(') s5(E1) s8(+)</td>
                <td>E(2) )</td>
                <td>sS11</td>
                <td></td>
            </tr>
            <tr>
                <td>9</td>
                <td>s0(nil) s2('(') s5(E1) s8(+) s11(E2)</td>
                <td>)</td>
                <td>sS15</td>
                <td></td>
            </tr>
            <tr>
                <td>10</td>
                <td>s0(nil) s2('(') s5(E1) s8(+) s11(E2) s15(')')</td>
                <td>$</td>
                <td>r(E→(E+E))</td>
                <td><svg style="width: 200px;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 139.31 129">
                        <text transform="translate(38.42 86.26)"
                            style="font-family: DengXian, DengXian; font-size: 12px;">
                            <tspan x="0" y="0">1</tspan>
                        </text>
                        <circle cx="41.2" cy="82.5" r="10" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <text transform="translate(37.12 50.26)"
                            style="font-family: DengXian, DengXian; font-size: 12px;">
                            <tspan x="0" y="0">E</tspan>
                        </text>
                        <circle cx="40.5" cy="46.5" r="10" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <text transform="translate(7.12 50.26)"
                            style="font-family: DengXian, DengXian; font-size: 12px;">
                            <tspan x="0" y="0">(</tspan>
                        </text>
                        <circle cx="10.5" cy="46.5" r="10" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <text transform="translate(125.44 50.26)"
                            style="font-family: DengXian, DengXian; font-size: 12px;">
                            <tspan x="0" y="0">)</tspan>
                        </text>
                        <circle cx="128.81" cy="46.5" r="10" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <line x1="40.5" y1="59.5" x2="40.5" y2="69.5"
                            style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <text transform="translate(96.74 86.26)"
                            style="font-family: DengXian, DengXian; font-size: 12px;">
                            <tspan x="0" y="0">2</tspan>
                        </text>
                        <circle cx="99.51" cy="82.5" r="10" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <text transform="translate(95.44 50.26)"
                            style="font-family: DengXian, DengXian; font-size: 12px;">
                            <tspan x="0" y="0">E</tspan>
                        </text>
                        <circle cx="98.81" cy="46.5" r="10" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <line x1="99.51" y1="59.5" x2="99.51" y2="69.5"
                            style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <line x1="79.66" y1="20.5" x2="99.51" y2="33.5"
                            style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <text transform="translate(66.03 50.26)"
                            style="font-family: DengXian, DengXian; font-size: 12px;">
                            <tspan x="0" y="0">+</tspan>
                        </text>
                        <circle cx="69.66" cy="46.5" r="10" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <text transform="translate(66.28 14.26)"
                            style="font-family: DengXian, DengXian; font-size: 12px;">
                            <tspan x="0" y="0">E</tspan>
                        </text>
                        <circle cx="69.66" cy="10.5" r="10" style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <line x1="69.66" y1="23.5" x2="69.66" y2="33.5"
                            style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <line x1="59.66" y1="20.5" x2="40.5" y2="33.5"
                            style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <line x1="55.51" y1="14.72" x2="10.5" y2="33.5"
                            style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                        <line x1="82.86" y1="14.72" x2="128.81" y2="33.5"
                            style="fill: none; stroke: #000; stroke-miterlimit: 10;" />
                    </svg></td>
            </tr>
            <tr>
                <td>11</td>
                <td>s0(nil)</td>
                <td>E</td>
                <td>sS1</td>
                <td></td>
            </tr>
            <tr>
                <td>12</td>
                <td>s0(nil) s1(E)</td>
                <td>$</td>
                <td>r(S'→E)</td>
                <td></td>
            </tr>
            <tr>
                <td colspan="5">结束</td>
            </tr>
        </tbody>
    </table>
    <p>著名的if-else二义性：假设我们有如下文法</p>
    <ol>
        <li>if ( condition ) stmts</li>
        <li>if ( condition ) stmts else stmts</li>
    </ol>
    <p>那么对于输入:</p>
    <div class="code-area" style="display: inline-block; border: solid 1px">
        <code>
          <div>
            <span class="key-word">if </span>
            <span>(</span>
            <span class="variable">条件1</span>
            <span>)</span>
          </div>
          <div>
            <span class="key-word">if </span>
            <span>(</span>
            <span class="variable">条件2</span>
            <span>)</span>
          </div>
          <div>
            语句1
          </div>
          <div>
            <span class="key-word">else</span>
          </div>
          <div>
            语句2
          </div>
        </code>
    </div>
    <p>我们可以解析出这样两种结构:</p>
    <div>
        <div class="code-area" style="display: inline-block; border: solid 1px">
            <code>
              <div>
                <span class="key-word">if </span>
                <span>(</span>
                <span class="variable">条件1</span>
                <span>)</span>
              </div>
              <div>
                <span class="key-word">&nbsp;if </span>
                <span>(</span>
                <span class="variable">条件2</span>
                <span>)</span>
              </div>
              <div>
                &nbsp;&nbsp;语句1
              </div>
              <div>
                <span class="key-word">&nbsp;else</span>
              </div>
              <div>
                &nbsp;&nbsp;语句2
              </div>
            </code>
        </div>
        <div class="code-area" style="display: inline-block; border: solid 1px">
            <code>
              <div>
                <span class="key-word">if </span>
                <span>(</span>
                <span class="variable">条件1</span>
                <span>)</span>
              </div>
              <div>
                <span class="key-word">&nbsp;if </span>
                <span>(</span>
                <span class="variable">条件2</span>
                <span>)</span>
              </div>
              <div>
                &nbsp;&nbsp;语句1
              </div>
              <div>
                <span class="key-word">else</span>
              </div>
              <div>
                &nbsp;语句2
              </div>
            </code>
        </div>
    </div>
    <p>类似E→E+E这种文法二义性产生移入-规约和规约-规约冲突，龙书上面详细介绍类似YACC的处理机制，对于冲突我们可以定义符号的结合性和优先级处理，比如E+E导致的冲突，我们定义+号为左结合，凡是项集中因为这个产生式导致的冲突选择规约操作，而由E+E和E*E导致的冲突，我们定义*号比+号优先级高，凡是冲突由这两个产生式导致，我们就选择优先级高的产生式进行规约。对于if-else导致的冲突，我们定义else的优先级比if高，这样当分析器遇到else这个符号时，选择移入操作(本质上就是让这个符号之前的输入禁止规约，优先把这些符号和else组合，比如1+2*3，当读到'*'号时，可以让*号优先级高一些，这样1+2就必须放弃规约成E→1+2)
    </p>
    <p>LR(1)相比LR(0)来说，我们可以更轻松的设计文法，其实不难发现LL(1)、LR(0)、LR(1)他们的文法设计难度是逐渐降低的，但是任意的LR(k)分析器都有局限性，所以有一个LR分析方法叫做通用LR分析技术(GLR)，就是在移入、规约的时候同时选择移入和规约步骤，尝试所有可能的路线，这种分析方法理论上能处理所有的CFG(龙书说的)，就是开销很大
    </p>
    <p>这里展示一个简单语言的文法:</p>
    <ul>
        <li>program->stmts</li>
        <li>stmts->stmts stmt</li>
        <li>stmts->ε</li>
        <li>stmt->express ;</li>
        <li>stmt->assign ;</li>
        <li>stmt->if ( express ) { stmts }</li>
        <li>stmt->for ( assign ; express ; loop_step ) { stmts }</li>
        <li>loop_step->inc</li>
        <li>assign->id = express</li>
        <li>inc->id ++</li>
        <li>express->id</li>
        <li>express->express + express</li>
        <li>express->express - express</li>
        <li>express->express * express</li>
        <li>express->express / express</li>
        <li>express->express == express</li>
        <li>express->express &lt; express</li>
        <li>express->express &gt; express</li>
    </ul>
    <p>上面这个文法单单用LR(1)无法分析，会遇到上面说的E+E冲突和if-else冲突，需要设计的时候定义好各个符号的优先级和接合性，实际上主流编程语言都会定义操作符的优先级和结合性，比如Java的，赋值操作符'='的结合性是从右到左，这意味着
        'a = b = c' 会被解释为'a = (b = c)'，而不是(a = b) = c</p>
    </p>
    <h1>后端</h1>
    <p>前面讲了这么多前端内容，现在我们开始进入编译器后端知识，编译器前端有很成熟的理论支撑，后端就不同，有着一个个的NP-C问题待解决，也就是不管你的编译器多厉害，我都可以写出烂代码击溃他</p>
    <h2>有向无环图(Directed Acyclic Graph)优化</h2>
    <h2>窥孔优化</h2>
    <h2>基于栈的机器(java)和基于寄存器的机器</h2>
    <h2>寄存器分配</h2>
    <h2>静态单赋值()</h2>
    <h2>解释执行、AOT、JIT</h2>
    <h1>完!</h1>
</body>
<style>
    .code-area {
        background-color: #f2f2f2;
        margin-top: 0;
        margin-bottom: 0;
        padding: 5px 10px;
    }

    .code-header {
        background-color: #e8e6df;
    }

    .code-header>* {
        padding: 2px 16px;
        color: #161616;
    }

    .console {
        background-color: black;
        color: white;
    }

    .key-word {
        color: #0101fd;
    }

    .variable {
        color: #006881;
    }

    .string {
        color: #a31515;
    }

    .comment {
        color: green;
    }

    .emphasis {
        color: #006881;
    }

    .vertical-line {
        width: 1px;
        background-color: red;
        margin: 0 5px;
    }
</style>
<script type="module" src="./js/NFA-1.js">
</script>
<script type="module" src="./js/NFA-2-DFA.js">
</script>
<script type="module" src="./js/LL(1).js">
</script>
<script type="module" src="./js/LR(0).js">
</script>

</html>